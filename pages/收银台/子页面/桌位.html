<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¡Œä½ç®¡ç† - æ”¶é“¶å°</title>
    <link rel="stylesheet" href="../../../css/Main.css">
    <link rel="stylesheet" href="../../../css/ç‚¹å•.css">
    <style>
        .table-mgmt-body { margin: 0; padding: 0; background: var(--color-neutral-50); min-height: 100vh; }
        .table-mgmt-container { max-width: 1200px; margin: 0 auto; padding: var(--spacing-lg); padding-bottom: 100px; }

        .table-mgmt-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-md);
        }
        .table-mgmt-title-wrap { display: flex; align-items: center; gap: var(--spacing-md); flex-wrap: wrap; }
        .table-mgmt-title { font-size: var(--font-size-2xl); font-weight: var(--font-weight-bold); color: var(--color-text-primary); margin: 0; }
        .table-mgmt-search-wrap {
            display: flex;
            align-items: center;
            border: 1px solid var(--color-neutral-300);
            border-radius: var(--radius-md);
            overflow: hidden;
            background: #fff;
            width: 220px;
        }
        .table-mgmt-search-wrap input {
            flex: 1;
            border: none;
            padding: 8px 12px;
            font-size: var(--font-size-sm);
        }
        .table-mgmt-search-wrap input::placeholder { color: #999; }
        .table-mgmt-search-wrap span { padding: 8px 12px; color: #999; font-size: 14px; }
        .table-mgmt-pending {
            font-size: var(--font-size-sm);
            color: #ff4d4f;
            margin-right: var(--spacing-sm);
        }
        .table-mgmt-bell {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: 1px solid var(--color-neutral-200);
            background: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
        }

        .table-mgmt-filters {
            display: flex;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-lg);
        }
        .table-mgmt-filter-btn {
            padding: 8px 20px;
            border: 1px solid var(--color-neutral-300);
            border-radius: var(--radius-md);
            background: #fff;
            color: var(--color-text-secondary);
            font-size: var(--font-size-sm);
            cursor: pointer;
        }
        .table-mgmt-filter-btn.active {
            background: #52c41a;
            border-color: #52c41a;
            color: #fff;
        }

        .table-mgmt-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: var(--spacing-md);
        }
        .table-mgmt-card {
            background: #fff;
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            box-shadow: var(--shadow-card);
            border: 1px solid var(--color-neutral-100);
            text-align: center;
            cursor: pointer;
            transition: box-shadow 0.2s;
        }
        .table-mgmt-card:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .table-mgmt-card-code { font-size: 22px; font-weight: bold; color: var(--color-text-primary); margin-bottom: 8px; }
        .table-mgmt-card-status { font-size: var(--font-size-sm); color: var(--color-text-secondary); margin-bottom: 6px; }
        .table-mgmt-card-capacity { font-size: var(--font-size-sm); color: #666; }
        .table-mgmt-card-timer { font-size: var(--font-size-xs); color: #ff7a45; margin-top: 4px; }

        .table-mgmt-card.status-empty { }
        .table-mgmt-card.status-wait-order { background: #fff7e6; border-color: #ffd591; }
        .table-mgmt-card.status-wait-order .table-mgmt-card-status { color: #fa8c16; }
        .table-mgmt-card.status-wait-pay { border-color: #ffccc7; background: #fff2f0; }
        .table-mgmt-card.status-wait-pay .table-mgmt-card-status { color: #ff4d4f; }
        .table-mgmt-card.status-pre-settled { border-color: #b7eb8f; background: #f6ffed; }
        .table-mgmt-card.status-pre-settled .table-mgmt-card-status { color: #52c41a; }
        .table-mgmt-card.status-wait-clear { border-color: #91d5ff; background: #e6f7ff; }
        .table-mgmt-card.status-wait-clear .table-mgmt-card-status { color: #1890ff; }
        .table-mgmt-card.status-wait-dish { border-color: #d3adf7; background: #f9f0ff; }
        .table-mgmt-card.status-wait-dish .table-mgmt-card-status { color: #722ed1; }
        .table-mgmt-card-badge {
            display: inline-block;
            margin-top: 6px;
            padding: 2px 8px;
            border-radius: var(--radius-sm);
            font-size: var(--font-size-xs);
            background: #1890ff;
            color: #fff;
        }

        .table-mgmt-bottom-bar {
            position: fixed;
            left: 0;
            right: 0;
            bottom: 0;
            background: #fff;
            border-top: 1px solid var(--color-neutral-200);
            padding: var(--spacing-md) var(--spacing-lg);
            box-shadow: 0 -2px 12px rgba(0,0,0,0.06);
            z-index: 100;
        }
        .table-mgmt-summary {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            gap: var(--spacing-md) var(--spacing-lg);
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            margin-top: var(--spacing-md);
        }
        .table-mgmt-summary-item { display: flex; align-items: center; gap: 6px; }
        .table-mgmt-summary-dot { width: 8px; height: 8px; border-radius: 50%; }
        .table-mgmt-summary-dot.all { background: #333; }
        .table-mgmt-summary-dot.empty { background: #d9d9d9; }
        .table-mgmt-summary-dot.wait-order { background: #fa8c16; }
        .table-mgmt-summary-dot.wait-pay { background: #ff4d4f; }
        .table-mgmt-summary-dot.pre-settled { background: #52c41a; }
        .table-mgmt-summary-dot.wait-clear { background: #1890ff; }
        .table-mgmt-summary-dot.wait-dish { background: #722ed1; }
        .table-mgmt-summary-dot.has-order { background: #1890ff; }

        .table-mgmt-clear-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 24px;
            border: none;
            border-radius: var(--radius-md);
            background: #52c41a;
            color: #fff;
            font-size: var(--font-size-base);
            cursor: pointer;
            margin: 0 auto;
        }
        .table-mgmt-clear-btn:hover { background: #73d13d; }

        .table-mgmt-fab {
            position: fixed;
            right: 24px;
            bottom: 140px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: #1890ff;
            color: #fff;
            border: none;
            box-shadow: 0 4px 12px rgba(24,144,255,0.4);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            z-index: 101;
        }
        .table-mgmt-fab-badge {
            position: absolute;
            top: -4px;
            right: -4px;
            min-width: 18px;
            height: 18px;
            padding: 0 4px;
            border-radius: 9px;
            background: #ff4d4f;
            color: #fff;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        /* ç‚¹æ¡Œå°åå‡ºç°çš„ç‚¹å•ç•Œé¢ï¼ˆå…¨å±æµ®å±‚ï¼‰ */
        .table-order-overlay {
            position: fixed;
            inset: 0;
            z-index: 300;
            background: #fff;
            display: none;
            flex-direction: column;
        }
        .table-order-overlay.is-open { display: flex; }
        .table-order-overlay .order-page-container { flex: 1; min-height: 0; }
        .table-order-back-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--spacing-sm) var(--spacing-lg);
            background: linear-gradient(135deg, #e6f7ff 0%, #bae7ff 100%);
            border-bottom: 1px solid var(--color-neutral-200);
            flex-shrink: 0;
        }
        .table-order-back-bar .order-table-value { font-weight: bold; color: var(--color-primary); }
    </style>
</head>
<body class="table-mgmt-body">
    <div class="table-mgmt-container">
        <header class="table-mgmt-header">
            <div class="table-mgmt-title-wrap">
                <h1 class="table-mgmt-title">æ¡Œä½ç®¡ç†</h1>
                <div class="table-mgmt-search-wrap">
                    <span>Q</span>
                    <input type="text" id="tableSearch" placeholder="æ¡Œå°åç§°">
                </div>
            </div>
            <div style="display:flex;align-items:center;">
                <span class="table-mgmt-pending" id="pendingSummary">å¾…ç»“è´¦: 0æ¡Œ | 0äºº | Â¥0.00</span>
                <button type="button" class="table-mgmt-bell" title="é€šçŸ¥">ğŸ””</button>
            </div>
        </header>

        <div class="table-mgmt-filters">
            <button type="button" class="table-mgmt-filter-btn active" data-area="all">å…¨éƒ¨</button>
            <button type="button" class="table-mgmt-filter-btn" data-area="AåŒº">AåŒº</button>
            <button type="button" class="table-mgmt-filter-btn" data-area="BåŒº">BåŒº</button>
        </div>

        <div class="table-mgmt-grid" id="tableGrid"></div>
    </div>

    <div class="table-mgmt-bottom-bar">
        <div style="text-align:center;">
            <button type="button" class="table-mgmt-clear-btn" id="btnClearAll">âœ“ ä¸€é”®æ¸…å°</button>
        </div>
        <div class="table-mgmt-summary" id="summaryBar"></div>
    </div>

    <button type="button" class="table-mgmt-fab" id="btnCallService" title="å‘¼å«æœåŠ¡">
        ğŸ“¢
        <span class="table-mgmt-fab-badge" id="callServiceBadge">0</span>
    </button>

    <!-- ç‚¹æ¡Œå°åå‡ºç°çš„ç‚¹å•ç•Œé¢ï¼ˆå‚è€ƒç‚¹å•é¡µè¦ç´ æ•´åˆï¼‰ -->
    <div class="table-order-overlay" id="tableOrderOverlay">
        <div class="order-page-container">
            <aside class="order-left-panel">
                <div class="table-order-back-bar">
                    <span><span class="order-table-label">å½“å‰æ¡Œå°</span> <span class="order-table-value" id="tableOrderCode">-</span></span>
                    <button type="button" class="order-btn order-btn-outline" id="tableOrderBackBtn">â† è¿”å›æ¡Œä½</button>
                </div>
                <div class="order-customer-section">
                    <div class="order-customer-select">
                        <button type="button" class="order-customer-link"><span class="order-customer-icon">ğŸ‘¤</span><span>ç‚¹å‡»é€‰æ‹©å®¢æˆ·</span></button>
                        <button type="button" class="order-btn order-btn-primary order-storage-btn">å‚¨å€¼</button>
                    </div>
                    <div class="order-member-info">
                        <div class="order-member-item"><span class="order-member-label">ä½™é¢</span><span class="order-member-value">0.00</span></div>
                        <div class="order-member-item"><span class="order-member-label">æƒç›Šå¡</span><span class="order-member-value">0</span></div>
                        <div class="order-member-item"><span class="order-member-label">ä¼˜æƒ åˆ¸</span><span class="order-member-value">0</span></div>
                        <div class="order-member-item"><span class="order-member-label">ç§¯åˆ†</span><span class="order-member-value">0</span></div>
                    </div>
                </div>
                <div class="order-items-section">
                    <div class="order-items-header"><h3 class="order-items-title">ç‚¹å•åˆ—è¡¨</h3></div>
                    <div class="order-items-list" id="tableOrderItemsList">
                        <div class="order-items-empty" id="tableOrderEmpty">
                            <div class="order-empty-icon">ğŸ›’</div>
                            <div class="order-empty-text">æš‚æ— èœå“</div>
                        </div>
                    </div>
                </div>
                <div class="order-settlement-section">
                    <div class="order-discount-bar">
                        <span class="order-discount-text">æ— ä¼˜æƒ </span>
                        <button type="button" class="order-btn order-btn-outline order-modify-discount-btn">ä¿®æ”¹ä¼˜æƒ </button>
                    </div>
                    <div class="order-total-section">
                        <div class="order-total-info">
                            <div class="order-total-label">åˆè®¡</div>
                            <div class="order-total-price" id="tableOrderTotalPrice">Â¥0.00</div>
                        </div>
                        <button type="button" class="order-btn order-btn-primary order-btn-large order-checkout-btn" id="tableOrderCheckoutBtn">æ”¶é“¶</button>
                    </div>
                </div>
            </aside>
            <div class="order-middle-panel">
                <div class="order-number-section">
                    <div class="order-number-header"><h3 class="order-number-title">å·ç‰Œ</h3></div>
                    <div class="order-number-actions">
                        <div class="order-action-item">
                            <label class="order-switch"><input type="checkbox" id="tableOrderPackSwitch"><span class="order-switch-slider"></span></label>
                            <span class="order-action-text">æ•´å•æ‰“åŒ…</span>
                        </div>
                        <button type="button" class="order-action-btn" id="tableOrderClearBtn">æ¸…ç©º</button>
                        <button type="button" class="order-action-btn">å–å•</button>
                        <button type="button" class="order-action-btn">æ•´å•æ‰“æŠ˜\å‡å…</button>
                        <button type="button" class="order-action-btn">æ•´å•å¤‡æ³¨</button>
                        <button type="button" class="order-action-btn">å›¢è´­åˆ¸å…ˆæ ¸é”€</button>
                    </div>
                    <div class="order-number-footer">
                        <button type="button" class="order-scroll-btn" id="tableOrderScrollUp">å‘ä¸Šæ»‘</button>
                        <button type="button" class="order-scroll-btn" id="tableOrderScrollDown">å‘ä¸‹æ»‘</button>
                    </div>
                </div>
            </div>
            <main class="order-right-panel">
                <div class="order-product-toolbar">
                    <div class="order-search-section">
                        <input type="text" class="order-search-input" id="tableOrderSearch" placeholder="ğŸ” å•†å“åç§°">
                    </div>
                    <div class="order-toolbar-buttons">
                        <button type="button" class="order-tool-btn order-tool-btn-outline" title="ä¸´æ—¶å•†å“">ä¸´æ—¶å•†å“</button>
                        <button type="button" class="order-tool-btn" title="å¤§å›¾">å¤§</button>
                        <button type="button" class="order-tool-btn" title="ä¸­å›¾">ä¸­</button>
                        <button type="button" class="order-tool-btn" title="å°å›¾">å°</button>
                    </div>
                </div>
                <div class="order-category-tabs">
                    <div class="order-category-tabs-wrapper">
                        <button type="button" class="order-category-tab active" data-category="all">å…¨éƒ¨</button>
                        <button type="button" class="order-category-tab" data-category="soft-drink">è½¯é¥®</button>
                        <button type="button" class="order-category-tab" data-category="beer">å•¤é…’</button>
                        <button type="button" class="order-category-tab" data-category="snack">å°å·</button>
                        <button type="button" class="order-category-tab" data-category="other">å…¶å®ƒ</button>
                        <button type="button" class="order-category-tab" data-category="wine">æ´‹é…’</button>
                        <button type="button" class="order-category-tab" data-category="special">ç‰¹è‰²</button>
                        <button type="button" class="order-category-tab" data-category="rainbow">å½©è™¹</button>
                        <button type="button" class="order-category-tab" data-category="package">å¥—é¤</button>
                        <button type="button" class="order-category-tab" data-category="chinese">ä¸­é¤</button>
                    </div>
                </div>
                <div class="order-product-content">
                    <div class="order-products-grid order-products-grid-medium" id="tableOrderProductsGrid"></div>
                </div>
                <div class="order-payment-bar">
                    <button type="button" class="order-payment-btn order-payment-btn-outline">æ‰«ä»˜</button>
                    <button type="button" class="order-payment-btn order-payment-btn-outline">ç°é‡‘</button>
                    <button type="button" class="order-payment-btn order-payment-btn-douyin"><span class="douyin-logo">æŠ–éŸ³</span></button>
                    <button type="button" class="order-payment-btn order-payment-btn-primary">å…ˆåƒåä»˜</button>
                </div>
            </main>
        </div>
    </div>

    <script>
        (function () {
            var areaFilter = 'all';
            var searchKeyword = '';
            var tables = [
                { code: 'A01', area: 'AåŒº', status: 'empty', capacity: 10, current: 0 },
                { code: 'A02', area: 'AåŒº', status: 'wait-order', capacity: 10, current: 5, timerMinutes: 1113 },
                { code: 'A03', area: 'AåŒº', status: 'empty', capacity: 10, current: 0 },
                { code: 'A04', area: 'AåŒº', status: 'empty', capacity: 10, current: 0 },
                { code: 'A05', area: 'AåŒº', status: 'empty', capacity: 10, current: 0 },
                { code: 'A06', area: 'AåŒº', status: 'empty', capacity: 10, current: 0 },
                { code: 'A07', area: 'AåŒº', status: 'empty', capacity: 10, current: 0 },
                { code: 'A08', area: 'AåŒº', status: 'empty', capacity: 10, current: 0 },
                { code: 'A09', area: 'AåŒº', status: 'empty', capacity: 10, current: 0 },
                { code: 'B01', area: 'BåŒº', status: 'empty', capacity: 4, current: 0 },
                { code: 'B02', area: 'BåŒº', status: 'empty', capacity: 4, current: 0 },
                { code: 'B03', area: 'BåŒº', status: 'empty', capacity: 4, current: 0 },
                { code: 'B04', area: 'BåŒº', status: 'empty', capacity: 4, current: 0 },
                { code: 'B05', area: 'BåŒº', status: 'empty', capacity: 4, current: 0 }
            ];
            var statusText = { empty: 'ç©ºæ¡Œå°', 'wait-order': 'å¾…ä¸‹å•', 'wait-pay': 'å¾…ç»“è´¦', 'pre-settled': 'å·²é¢„ç»“', 'wait-clear': 'å¾…æ¸…å°', 'wait-dish': 'å¾…ä¸Šèœ' };

            function getTableOrdersFromStorage(code) {
                try {
                    var raw = localStorage.getItem('cashierTableOrders') || '{}';
                    var obj = typeof raw === 'string' ? JSON.parse(raw) : raw;
                    return Array.isArray(obj[code]) ? obj[code] : [];
                } catch (e) { return []; }
            }

            function getFiltered() {
                var list = tables;
                if (areaFilter !== 'all') list = list.filter(function (t) { return t.area === areaFilter; });
                if (searchKeyword) {
                    var k = searchKeyword.toLowerCase();
                    list = list.filter(function (t) { return (t.code || '').toLowerCase().indexOf(k) >= 0; });
                }
                return list;
            }

            function renderGrid() {
                var list = getFiltered();
                var html = list.map(function (t) {
                    var statusClass = 'status-' + (t.status || 'empty');
                    var statusLabel = statusText[t.status] || 'ç©ºæ¡Œå°';
                    var timerHtml = (t.timerMinutes != null && t.status === 'wait-order') ? '<div class="table-mgmt-card-timer">' + t.timerMinutes + ' åˆ†é’Ÿ</div>' : '';
                    var orders = getTableOrdersFromStorage(t.code);
                    var hasOrdered = orders && orders.length > 0;
                    var badgeHtml = hasOrdered ? '<div class="table-mgmt-card-badge">å·²ç‚¹å•</div>' : '';
                    return '<div class="table-mgmt-card ' + statusClass + '" data-code="' + t.code + '">' +
                        '<div class="table-mgmt-card-code">' + t.code + '</div>' +
                        '<div class="table-mgmt-card-status">' + statusLabel + '</div>' +
                        '<div class="table-mgmt-card-capacity">ğŸ‘¤ ' + (t.current || 0) + '/' + (t.capacity || 0) + '</div>' +
                        timerHtml + badgeHtml + '</div>';
                }).join('');
                document.getElementById('tableGrid').innerHTML = html || '<p style="grid-column:1/-1;text-align:center;color:#999;">æš‚æ— æ¡Œä½</p>';

                document.querySelectorAll('.table-mgmt-card').forEach(function (el) {
                    el.addEventListener('click', function () {
                        var code = this.dataset.code;
                        if (!code) return;
                        openTableOrderPanel(code);
                    });
                });
            }

            function updateSummary() {
                var all = tables.length;
                var empty = tables.filter(function (t) { return t.status === 'empty'; }).length;
                var waitOrder = tables.filter(function (t) { return t.status === 'wait-order'; }).length;
                var waitPay = tables.filter(function (t) { return t.status === 'wait-pay'; }).length;
                var preSettled = tables.filter(function (t) { return t.status === 'pre-settled'; }).length;
                var waitClear = tables.filter(function (t) { return t.status === 'wait-clear'; }).length;
                var waitDish = tables.filter(function (t) { return t.status === 'wait-dish'; }).length;
                var hasOrderedCount = tables.filter(function (t) { return getTableOrdersFromStorage(t.code).length > 0; }).length;
                var payTables = tables.filter(function (t) { return t.status === 'wait-pay'; });
                var payPeople = payTables.reduce(function (s, t) { return s + (t.current || 0); }, 0);
                var payAmount = payTables.length * 0;
                document.getElementById('pendingSummary').textContent = 'å¾…ç»“è´¦: ' + waitPay + 'æ¡Œ | ' + payPeople + 'äºº | Â¥' + payAmount.toFixed(2);

                var bar = document.getElementById('summaryBar');
                bar.innerHTML = '<span class="table-mgmt-summary-item"><span class="table-mgmt-summary-dot all"></span>å…¨éƒ¨(' + all + ')</span>' +
                    '<span class="table-mgmt-summary-item"><span class="table-mgmt-summary-dot empty"></span>ç©ºæ¡Œä½(' + empty + ')</span>' +
                    '<span class="table-mgmt-summary-item"><span class="table-mgmt-summary-dot wait-order"></span>å¾…ä¸‹å•(' + waitOrder + ')</span>' +
                    '<span class="table-mgmt-summary-item"><span class="table-mgmt-summary-dot has-order"></span>å·²ç‚¹å•(' + hasOrderedCount + ')</span>' +
                    '<span class="table-mgmt-summary-item"><span class="table-mgmt-summary-dot wait-pay"></span>å¾…ç»“è´¦(' + waitPay + ')</span>' +
                    '<span class="table-mgmt-summary-item"><span class="table-mgmt-summary-dot pre-settled"></span>å·²é¢„ç»“(' + preSettled + ')</span>' +
                    '<span class="table-mgmt-summary-item"><span class="table-mgmt-summary-dot wait-clear"></span>å¾…æ¸…å°(' + waitClear + ')</span>' +
                    '<span class="table-mgmt-summary-item"><span class="table-mgmt-summary-dot wait-dish"></span>å¾…ä¸Šèœ(' + waitDish + ')</span>';
            }

            document.querySelectorAll('.table-mgmt-filter-btn').forEach(function (btn) {
                btn.addEventListener('click', function () {
                    document.querySelectorAll('.table-mgmt-filter-btn').forEach(function (b) { b.classList.remove('active'); });
                    this.classList.add('active');
                    areaFilter = this.dataset.area || 'all';
                    renderGrid();
                });
            });
            document.getElementById('tableSearch').addEventListener('input', function () {
                searchKeyword = this.value.trim();
                renderGrid();
            });
            document.getElementById('btnClearAll').addEventListener('click', function () {
                if (confirm('ç¡®å®šä¸€é”®æ¸…å°ï¼Ÿå°†æ¸…ç©ºæ‰€æœ‰å¯æ¸…å°çŠ¶æ€æ¡Œä½ã€‚')) {
                    tables.forEach(function (t) {
                        if (t.status === 'wait-clear' || t.status === 'pre-settled') {
                            t.status = 'empty';
                            t.current = 0;
                        }
                    });
                    renderGrid();
                    updateSummary();
                }
            });
            document.getElementById('btnCallService').addEventListener('click', function () {
                alert('å‘¼å«æœåŠ¡');
            });

            // ---------- ç‚¹æ¡Œå°åç‚¹å•ç•Œé¢ï¼šå•†å“æ•°æ®ï¼ˆä¸ç‚¹å•é¡µä¸€è‡´ï¼‰ ----------
            var tableOrderProductData = [
                { id: 1, name: 'çº¢ç‰›', price: 15, category: 'soft-drink' },
                { id: 2, name: 'æ—ºä»”ç‰›å¥¶', price: 15, category: 'soft-drink' },
                { id: 3, name: 'ç‹è€å‰ï¼ˆå¬è£…ï¼‰', price: 10, category: 'soft-drink' },
                { id: 4, name: 'å¯ä¹ï¼ˆå¬è£…ï¼‰', price: 8, category: 'soft-drink' },
                { id: 5, name: 'çº¢èŒ¶', price: 8, category: 'soft-drink' },
                { id: 6, name: 'å†œå¤«å±±æ³‰550ml', price: 8, category: 'soft-drink' },
                { id: 7, name: 'è‹æ‰“æ°´', price: 10, category: 'soft-drink' },
                { id: 8, name: 'é›ªç¢§', price: 8, category: 'soft-drink' },
                { id: 9, name: 'è„‰åŠ¨', price: 12, category: 'soft-drink' },
                { id: 10, name: 'ç™¾å¨ç»å…¸ï¼ˆåŠæ‰“ï¼‰', price: 108, category: 'beer' },
                { id: 11, name: 'ç™¾å¨ç»å…¸ï¼ˆä¸€æ‰“ï¼‰', price: 198, category: 'beer' },
                { id: 12, name: 'ç§‘ç½—å¨œï¼ˆåŠæ‰“ï¼‰', price: 158, category: 'beer' },
                { id: 13, name: 'ç§‘ç½—å¨œï¼ˆä¸€æ‰“ï¼‰', price: 298, category: 'beer' },
                { id: 14, name: 'ç™¾å¨é“ç½ï¼ˆåŠæ‰“ï¼‰', price: 158, category: 'beer' },
                { id: 15, name: 'ç™¾å¨é“ç½ï¼ˆä¸€æ‰“ï¼‰', price: 298, category: 'beer' },
                { id: 16, name: 'ç¦ä½³ç™½ï¼ˆåŠæ‰“ï¼‰', price: 138, category: 'beer' },
                { id: 17, name: 'ç¦ä½³ç™½ï¼ˆä¸€æ‰“ï¼‰', price: 258, category: 'beer' },
                { id: 18, name: '1664æ¡ƒçº¢ï¼ˆåŠæ‰“ï¼‰', price: 198, category: 'beer' },
                { id: 19, name: '1664æ¡ƒçº¢ï¼ˆä¸€æ‰“ï¼‰', price: 388, category: 'beer' },
                { id: 20, name: 'åŠ¨åŠ›ç«è½¦ï¼ˆåŠæ‰“ï¼‰', price: 78, category: 'beer' },
                { id: 21, name: 'åŠ¨åŠ›ç«è½¦ï¼ˆä¸€æ‰“ï¼‰', price: 148, category: 'beer' },
                { id: 22, name: 'å´‚å±±å•¤é…’ï¼ˆåŠæ‰“ï¼‰', price: 68, category: 'beer' },
                { id: 23, name: 'å´‚å±±å•¤é…’ï¼ˆä¸€æ‰“ï¼‰', price: 128, category: 'beer' },
                { id: 24, name: '1664ç™½å•¤ï¼ˆåŠæ‰“ï¼‰', price: 188, category: 'beer' },
                { id: 25, name: '1664ç™½å•¤ï¼ˆä¸€æ‰“ï¼‰', price: 368, category: 'beer' },
                { id: 26, name: 'å°é£Ÿæ‹¼ç›˜', price: 28, category: 'snack' },
                { id: 27, name: 'èŠ±ç”Ÿç±³', price: 15, category: 'snack' },
                { id: 28, name: 'ç“œå­', price: 12, category: 'snack' },
                { id: 29, name: 'å…¶ä»–å•†å“1', price: 20, category: 'other' },
                { id: 30, name: 'å…¶ä»–å•†å“2', price: 25, category: 'other' },
                { id: 31, name: 'å¨å£«å¿Œ', price: 388, category: 'wine' },
                { id: 32, name: 'ç™½å…°åœ°', price: 488, category: 'wine' },
                { id: 33, name: 'ç‰¹è‰²æ–—é…’1', price: 88, category: 'special' },
                { id: 34, name: 'ç‰¹è‰²æ–—é…’2', price: 98, category: 'special' },
                { id: 35, name: 'å½©è™¹æ–—é…’1', price: 108, category: 'rainbow' },
                { id: 36, name: 'å½©è™¹æ–—é…’2', price: 118, category: 'rainbow' },
                { id: 37, name: 'ä¼˜æƒ å¥—é¤A', price: 198, category: 'package' },
                { id: 38, name: 'ä¼˜æƒ å¥—é¤B', price: 298, category: 'package' },
                { id: 39, name: 'å®«ä¿é¸¡ä¸', price: 38, category: 'chinese' },
                { id: 40, name: 'éº»å©†è±†è…', price: 28, category: 'chinese' }
            ];

            var tableOrderCurrentCode = '';
            var tableOrderItems = [];
            var tableOrderCategory = 'all';
            var tableOrderSearch = '';

            function saveTableOrderToStorage() {
                if (!tableOrderCurrentCode) return;
                try {
                    var raw = localStorage.getItem('cashierTableOrders') || '{}';
                    var obj = typeof raw === 'string' ? JSON.parse(raw) : raw;
                    obj[tableOrderCurrentCode] = tableOrderItems.slice();
                    localStorage.setItem('cashierTableOrders', JSON.stringify(obj));
                } catch (e) {}
            }

            function tableOrderUpdateDisplay() {
                var listEl = document.getElementById('tableOrderItemsList');
                var emptyEl = document.getElementById('tableOrderEmpty');
                var totalEl = document.getElementById('tableOrderTotalPrice');
                if (!listEl) return;
                if (tableOrderItems.length === 0) {
                    if (emptyEl) emptyEl.style.display = 'flex';
                    listEl.innerHTML = '';
                    listEl.appendChild(emptyEl);
                } else {
                    if (emptyEl) emptyEl.style.display = 'none';
                    listEl.innerHTML = tableOrderItems.map(function (item, index) {
                        return '<div class="order-item">' +
                            '<div class="order-item-name">' + item.name + '</div>' +
                            '<div class="order-item-price">Â¥' + (item.price || 0).toFixed(2) + '</div>' +
                            '<div class="order-item-quantity">' +
                            '<button type="button" class="order-quantity-btn" data-action="minus" data-index="' + index + '">-</button>' +
                            '<span class="order-quantity-value">' + (item.quantity || 1) + '</span>' +
                            '<button type="button" class="order-quantity-btn" data-action="plus" data-index="' + index + '">+</button>' +
                            '</div>' +
                            '<button type="button" class="order-item-delete" data-index="' + index + '" title="åˆ é™¤">Ã—</button>' +
                            '</div>';
                    }).join('');
                    listEl.querySelectorAll('.order-quantity-btn[data-action="minus"]').forEach(function (btn) {
                        btn.addEventListener('click', function () {
                            var i = parseInt(this.dataset.index, 10);
                            if (tableOrderItems[i]) {
                                tableOrderItems[i].quantity = (tableOrderItems[i].quantity || 1) - 1;
                                if (tableOrderItems[i].quantity <= 0) tableOrderItems.splice(i, 1);
                                tableOrderUpdateDisplay();
                                saveTableOrderToStorage();
                            }
                        });
                    });
                    listEl.querySelectorAll('.order-quantity-btn[data-action="plus"]').forEach(function (btn) {
                        btn.addEventListener('click', function () {
                            var i = parseInt(this.dataset.index, 10);
                            if (tableOrderItems[i]) {
                                tableOrderItems[i].quantity = (tableOrderItems[i].quantity || 1) + 1;
                                tableOrderUpdateDisplay();
                                saveTableOrderToStorage();
                            }
                        });
                    });
                    listEl.querySelectorAll('.order-item-delete').forEach(function (btn) {
                        btn.addEventListener('click', function () {
                            var i = parseInt(this.dataset.index, 10);
                            tableOrderItems.splice(i, 1);
                            tableOrderUpdateDisplay();
                            saveTableOrderToStorage();
                        });
                    });
                }
                var total = tableOrderItems.reduce(function (s, it) { return s + (it.price || 0) * (it.quantity || 1); }, 0);
                if (totalEl) totalEl.textContent = 'Â¥' + total.toFixed(2);
            }

            function tableOrderRenderProducts() {
                var grid = document.getElementById('tableOrderProductsGrid');
                if (!grid) return;
                var list = tableOrderProductData;
                if (tableOrderCategory !== 'all') list = list.filter(function (p) { return p.category === tableOrderCategory; });
                if (tableOrderSearch) {
                    var k = tableOrderSearch.toLowerCase();
                    list = list.filter(function (p) { return (p.name || '').toLowerCase().indexOf(k) >= 0; });
                }
                grid.innerHTML = list.map(function (p) {
                    return '<div class="order-product-card" data-product-id="' + p.id + '">' +
                        '<div class="order-product-image"><div class="order-product-image-placeholder">ğŸ“¦</div></div>' +
                        '<div class="order-product-name">' + (p.name || '') + '</div>' +
                        '<div class="order-product-price">Â¥' + (p.price || 0) + '</div>' +
                        '<button type="button" class="order-product-add-btn" data-product-id="' + p.id + '" title="æ·»åŠ åˆ°è®¢å•">+</button>' +
                        '</div>';
                }).join('');
                grid.querySelectorAll('.order-product-card').forEach(function (card) {
                    var id = parseInt(card.dataset.productId, 10);
                    var product = tableOrderProductData.filter(function (p) { return p.id === id; })[0];
                    if (!product) return;
                    card.addEventListener('click', function (e) {
                        if (e.target.classList.contains('order-product-add-btn')) return;
                        tableOrderAddItem(product);
                    });
                });
                grid.querySelectorAll('.order-product-add-btn').forEach(function (btn) {
                    var id = parseInt(btn.dataset.productId, 10);
                    var product = tableOrderProductData.filter(function (p) { return p.id === id; })[0];
                    if (product) btn.addEventListener('click', function (e) { e.stopPropagation(); tableOrderAddItem(product); });
                });
            }

            function tableOrderAddItem(product) {
                var exist = tableOrderItems.filter(function (it) { return it.id === product.id; })[0];
                if (exist) exist.quantity = (exist.quantity || 1) + 1;
                else tableOrderItems.push({ id: product.id, name: product.name, price: product.price, quantity: 1 });
                tableOrderUpdateDisplay();
                saveTableOrderToStorage();
            }

            function openTableOrderPanel(code) {
                tableOrderCurrentCode = code;
                tableOrderItems = getTableOrdersFromStorage(code).slice();
                tableOrderCategory = 'all';
                tableOrderSearch = '';
                var codeEl = document.getElementById('tableOrderCode');
                if (codeEl) codeEl.textContent = code;
                document.getElementById('tableOrderOverlay').classList.add('is-open');
                document.getElementById('tableOrderSearch').value = '';
                document.querySelectorAll('#tableOrderOverlay .order-category-tab').forEach(function (t) {
                    t.classList.toggle('active', t.dataset.category === 'all');
                });
                tableOrderUpdateDisplay();
                tableOrderRenderProducts();
            }

            document.getElementById('tableOrderBackBtn').addEventListener('click', function () {
                document.getElementById('tableOrderOverlay').classList.remove('is-open');
                renderGrid();
                updateSummary();
            });
            document.getElementById('tableOrderClearBtn').addEventListener('click', function () {
                if (confirm('ç¡®å®šæ¸…ç©ºå½“å‰æ¡Œå°è®¢å•ï¼Ÿ')) {
                    tableOrderItems = [];
                    tableOrderUpdateDisplay();
                    saveTableOrderToStorage();
                }
            });
            document.getElementById('tableOrderCheckoutBtn').addEventListener('click', function () {
                var total = tableOrderItems.reduce(function (s, it) { return s + (it.price || 0) * (it.quantity || 1); }, 0);
                alert('æ”¶é“¶ï¼ˆæœ¬æ¡Œå°åˆè®¡ Â¥' + total.toFixed(2) + 'ï¼‰');
            });
            document.getElementById('tableOrderSearch').addEventListener('input', function () {
                tableOrderSearch = this.value.trim();
                tableOrderRenderProducts();
            });
            document.querySelectorAll('#tableOrderOverlay .order-category-tab').forEach(function (tab) {
                tab.addEventListener('click', function () {
                    document.querySelectorAll('#tableOrderOverlay .order-category-tab').forEach(function (t) { t.classList.remove('active'); });
                    this.classList.add('active');
                    tableOrderCategory = this.dataset.category || 'all';
                    tableOrderRenderProducts();
                });
            });
            document.getElementById('tableOrderScrollUp').addEventListener('click', function () {
                var el = document.getElementById('tableOrderItemsList');
                if (el) el.scrollTop -= 100;
            });
            document.getElementById('tableOrderScrollDown').addEventListener('click', function () {
                var el = document.getElementById('tableOrderItemsList');
                if (el) el.scrollTop += 100;
            });

            renderGrid();
            updateSummary();
        })();
    </script>
</body>
</html>
