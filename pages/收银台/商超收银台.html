<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å•†è¶…æ”¶é“¶å° - é›…å®‰å¥½ç‰©</title>
    <link rel="stylesheet" href="../../css/Main.css">
    <link rel="stylesheet" href="å•†è¶…æ”¶é“¶å°.css">
</head>
<body class="mall-cashier-body">
    <div class="mall-cashier-layout">
        <!-- é¡¶éƒ¨ -->
        <header class="mall-cashier-header">
            <div class="mall-cashier-tabs">
                <button type="button" class="mall-cashier-tab active" data-tab="product">å•†å“</button>
                <button type="button" class="mall-cashier-tab" data-tab="member">ä¼šå‘˜</button>
                <button type="button" class="mall-cashier-tab" data-tab="order">è®¢å•</button>
            </div>
            <div class="mall-cashier-cart-link">
                <span>ç»“è´¦æ¸…å•</span>
                <span id="cartCount">(0ä»¶)</span>
            </div>
        </header>

        <!-- è®¢å•åˆ—è¡¨è§†å›¾ï¼ˆç‚¹å‡»è®¢å• Tab æ—¶æ˜¾ç¤ºï¼‰ -->
        <div class="mall-order-panel hidden" id="orderPanel">
            <header class="mall-order-header">
                <button type="button" class="mall-order-back" id="orderPanelBack">â† è¿”å›</button>
                <h1 class="mall-order-title">è®¢å•</h1>
            </header>
            <div class="mall-order-search-wrap">
                <input type="text" class="mall-order-search" id="orderSearchInput" placeholder="è¯·è¾“å…¥è®¢å•å·æœç´¢">
                <button type="button" class="mall-order-search-btn" id="orderSearchBtn">ğŸ”</button>
            </div>
            <div class="mall-order-list" id="orderList"></div>
        </div>

        <!-- ä¸»å†…å®¹ -->
        <main class="mall-cashier-main" id="productMain">
            <!-- å·¦ä¾§ï¼šæœç´¢ + åˆ†ç±» + å•†å“ -->
            <div class="mall-cashier-left">
                <div class="mall-cashier-search-wrap">
                    <input type="text" class="mall-cashier-search" id="productSearch" placeholder="è¯·è¾“å…¥å•†å“åç§°/æ¡ç ">
                </div>
                <div class="mall-cashier-content">
                    <nav class="mall-cashier-categories">
                        <button type="button" class="mall-cashier-cat-item active" data-category="all">å…¨éƒ¨</button>
                        <button type="button" class="mall-cashier-cat-item" data-category="é›…å®‰å¥½æ™¯">é›…å®‰å¥½æ™¯</button>
                        <button type="button" class="mall-cashier-cat-item" data-category="é›…å®‰å¥½ç‰©">é›…å®‰å¥½ç‰©</button>
                        <button type="button" class="mall-cashier-cat-item" data-category="æ–‡åˆ›äº§å“">æ–‡åˆ›äº§å“</button>
                    </nav>
                    <div class="mall-cashier-products" id="productGrid"></div>
                </div>
            </div>

            <!-- å³ä¾§ï¼šç»“ç®—æ¸…å• -->
            <aside class="mall-cashier-right">
                <div class="mall-cashier-cart-title">ç»“ç®—æ¸…å• <span id="cartCountRight">(0ä»¶)</span></div>
                <div class="mall-cashier-cart-body" id="cartBody">
                    <div class="mall-cashier-cart-empty-icon">ğŸ“‹</div>
                    <div class="mall-cashier-cart-empty-text">æ­¤æ¬¡æš‚æ— é€‰ä¸­å•†å“</div>
                </div>
                <div class="mall-cashier-cart-summary" id="cartSummary" style="display:none;">
                    <div class="mall-cashier-cart-summary-row">æœ¬æ¬¡ä¼˜æƒ ï¼š<span id="summaryDiscount">Â¥0.00</span></div>
                    <div class="mall-cashier-cart-summary-row total">åº”æ”¶é‡‘é¢ï¼š<span id="summaryTotal">Â¥0.00</span></div>
                </div>
                <div class="mall-cashier-cart-actions">
                    <button type="button" class="btn mall-cashier-btn-cancel" id="btnCancelOrder">æ•´å•å–æ¶ˆ</button>
                    <button type="button" class="btn mall-cashier-btn-pay" id="btnPay">æ”¶æ¬¾</button>
                </div>
            </aside>
        </main>

        <!-- åº•éƒ¨æ“ä½œæ  -->
        <footer class="mall-cashier-bottom" id="cashierBottom">
            <button type="button" class="mall-cashier-bottom-btn">æ•´å•</button>
            <button type="button" class="mall-cashier-bottom-btn">å–å•</button>
            <button type="button" class="mall-cashier-bottom-btn">åŠ é’Ÿ</button>
            <button type="button" class="mall-cashier-bottom-btn">æ”¹ä»·</button>
            <button type="button" class="mall-cashier-bottom-btn">ä¼šå‘˜å……å€¼</button>
        </footer>
    </div>

    <!-- ä¼šå‘˜æŸ¥è¯¢å¼¹çª— -->
    <div class="mall-member-modal hidden" id="memberModal">
        <div class="mall-member-modal-backdrop" id="memberModalClose"></div>
        <div class="mall-member-modal-content">
            <div class="mall-member-modal-icon">ğŸ“±âœ“</div>
            <p class="mall-member-modal-tip">è¯·æ‰«æä»˜æ¬¾ç æˆ–è€…è¾“å…¥ä¼šå‘˜æ‰‹æœºå·ä»¥ä¾¿æŸ¥è¯¢ä¼šå‘˜</p>
            <input type="text" class="mall-member-modal-input" id="memberQueryInput" placeholder="è¯·æ‰«æä»˜æ¬¾ç æˆ–ä¼šå‘˜æ‰‹æœºå·" readonly>
            <div class="mall-member-keypad-wrap">
                <div class="mall-member-keypad" id="memberKeypad">
                    <button type="button" class="mall-member-key" data-n="1">1</button>
                    <button type="button" class="mall-member-key" data-n="2">2</button>
                    <button type="button" class="mall-member-key" data-n="3">3</button>
                    <button type="button" class="mall-member-key mall-member-key-del" data-n="del">X</button>
                    <button type="button" class="mall-member-key" data-n="4">4</button>
                    <button type="button" class="mall-member-key" data-n="5">5</button>
                    <button type="button" class="mall-member-key" data-n="6">6</button>
                    <button type="button" class="mall-member-key mall-member-key-confirm" id="memberConfirmBtn" data-n="confirm">ç¡®è®¤</button>
                    <button type="button" class="mall-member-key" data-n="7">7</button>
                    <button type="button" class="mall-member-key" data-n="8">8</button>
                    <button type="button" class="mall-member-key" data-n="9">9</button>
                    <button type="button" class="mall-member-key mall-member-key-zero" data-n="0">0</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        (function () {
            var products = [
                { id: 1, name: 'é›…å®‰ç‰¹äº§ç»¿è¥å…»è›‹', category: 'é›…å®‰å¥½æ™¯', image: '../../images/01.jpg', price: 20.00, stock: 6977 },
                { id: 2, name: 'åœŸå¸å†œå®¶æ•£å…»è›‹', category: 'é›…å®‰å¥½æ™¯', image: '../../images/02.jpg', price: 18.00, stock: 1306 },
                { id: 3, name: 'æœ‰æœºå±±èŒ¶æ²¹', category: 'é›…å®‰å¥½æ™¯', image: '../../images/03.jpg', price: 36.00, stock: 2623 },
                { id: 4, name: 'è…Šå‘³ç¤¼ç›’', category: 'é›…å®‰å¥½æ™¯', image: '../../images/04.jpg', price: 15.00, stock: 856 },
                { id: 5, name: 'è’™é¡¶å±±èŒ¶', category: 'é›…å®‰å¥½æ™¯', image: '../../images/05.jpg', price: 49.00, stock: 420 },
                { id: 6, name: 'é›…é±¼é²œç¤¼ç›’', category: 'é›…å®‰å¥½æ™¯', image: '../../images/06.jpg', price: 68.00, stock: 318 },
                { id: 7, name: 'èŠ±æ¤’æ²¹', category: 'é›…å®‰å¥½æ™¯', image: '../../images/01.jpg', price: 15.00, stock: 2100 },
                { id: 13, name: 'é›…å®‰èœ‚èœœ', category: 'é›…å®‰å¥½ç‰©', image: '../../images/01.jpg', price: 38.00, stock: 520 },
                { id: 14, name: 'é›…å®‰é»‘èŒ¶', category: 'é›…å®‰å¥½ç‰©', image: '../../images/02.jpg', price: 88.00, stock: 260 },
                { id: 15, name: 'é›…å®‰èŒè‡å¹²è´§', category: 'é›…å®‰å¥½ç‰©', image: '../../images/03.jpg', price: 45.00, stock: 380 },
                { id: 8, name: 'ç†ŠçŒ«å‘¨è¾¹ç©å¶', category: 'æ–‡åˆ›äº§å“', image: '../../images/02.jpg', price: 28.00, stock: 560 },
                { id: 9, name: 'é›…å®‰é£æ™¯æ˜ä¿¡ç‰‡', category: 'æ–‡åˆ›äº§å“', image: '../../images/03.jpg', price: 58.00, stock: 890 },
                { id: 10, name: 'èŒ¶å…·å¥—è£…', category: 'æ–‡åˆ›äº§å“', image: '../../images/04.jpg', price: 52.00, stock: 234 },
                { id: 11, name: 'æ‰‹å·¥èŒ¶é¥¼', category: 'æ–‡åˆ›äº§å“', image: '../../images/05.jpg', price: 58.00, stock: 445 },
                { id: 12, name: 'ç²¾å“ç¤¼ç›’è£…', category: 'æ–‡åˆ›äº§å“', image: '../../images/06.jpg', price: 268.00, stock: 120 }
            ];
            var cart = [];
            var currentCategory = 'all';
            var searchKeyword = '';

            function getFilteredProducts() {
                var list = products;
                if (currentCategory !== 'all') list = list.filter(function (p) { return p.category === currentCategory; });
                if (searchKeyword) {
                    var k = searchKeyword.toLowerCase();
                    list = list.filter(function (p) { return (p.name || '').toLowerCase().indexOf(k) >= 0 || String(p.id).indexOf(k) >= 0; });
                }
                return list;
            }

            function renderProducts() {
                var list = getFilteredProducts();
                var html = list.map(function (p) {
                    return '<div class="mall-cashier-product-card" data-id="' + p.id + '">' +
                        '<img class="mall-cashier-product-img" src="' + (p.image || '') + '" alt="" onerror="this.src=\'../../images/01.jpg\'">' +
                        '<div class="mall-cashier-product-info">' +
                        '<div class="mall-cashier-product-name">' + (p.name || '') + '</div>' +
                        '<div class="mall-cashier-product-price">Â¥' + (p.price != null ? Number(p.price).toFixed(2) : '0.00') + '</div>' +
                        '<div class="mall-cashier-product-stock">åº“å­˜' + (p.stock != null ? p.stock : 0) + '</div>' +
                        '<button type="button" class="mall-cashier-product-add" data-id="' + p.id + '" title="åŠ å…¥">+</button>' +
                        '</div></div>';
                }).join('');
                document.getElementById('productGrid').innerHTML = html || '<p style="padding:24px;color:#999;">æš‚æ— å•†å“</p>';

                document.querySelectorAll('.mall-cashier-product-add').forEach(function (btn) {
                    btn.addEventListener('click', function () {
                        var id = this.dataset.id;
                        var p = products.find(function (x) { return String(x.id) === String(id); });
                        if (p) {
                            var item = cart.find(function (x) { return String(x.id) === String(id); });
                            if (item) item.qty++; else cart.push({ id: p.id, name: p.name, price: p.price, qty: 1 });
                            updateCartUI();
                        }
                    });
                });
            }

            function updateCartUI() {
                var count = cart.reduce(function (sum, x) { return sum + (x.qty || 0); }, 0);
                document.getElementById('cartCount').textContent = '(' + count + 'ä»¶)';
                document.getElementById('cartCountRight').textContent = '(' + count + 'ä»¶)';
                var body = document.getElementById('cartBody');
                var summary = document.getElementById('cartSummary');
                if (count === 0) {
                    body.innerHTML = '<div class="mall-cashier-cart-empty-icon">ğŸ“‹</div><div class="mall-cashier-cart-empty-text">æ­¤æ¬¡æš‚æ— é€‰ä¸­å•†å“</div>';
                    body.style.display = 'flex';
                    if (summary) summary.style.display = 'none';
                } else {
                    var total = cart.reduce(function (sum, x) { return sum + (x.price || 0) * (x.qty || 0); }, 0);
                    body.innerHTML = '<div style="width:100%;font-size:13px;color:#666;">' + cart.map(function (x) {
                        return '<div style="display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid #f0f0f0;">' +
                            '<span>' + (x.name || '') + ' x' + (x.qty || 0) + '</span>' +
                            '<span>Â¥' + ((x.price || 0) * (x.qty || 0)).toFixed(2) + '</span></div>';
                    }).join('') + '</div>';
                    body.style.display = 'block';
                    if (summary) {
                        summary.style.display = 'block';
                        var el = document.getElementById('summaryTotal');
                        if (el) el.textContent = 'Â¥' + total.toFixed(2);
                    }
                }
            }

            document.getElementById('productSearch').addEventListener('input', function () {
                searchKeyword = this.value.trim();
                renderProducts();
            });
            document.querySelectorAll('.mall-cashier-cat-item').forEach(function (btn) {
                btn.addEventListener('click', function () {
                    document.querySelectorAll('.mall-cashier-cat-item').forEach(function (b) { b.classList.remove('active'); });
                    this.classList.add('active');
                    currentCategory = this.dataset.category || 'all';
                    renderProducts();
                });
            });
            document.getElementById('btnCancelOrder').addEventListener('click', function () {
                if (cart.length === 0) return;
                if (confirm('ç¡®å®šæ•´å•å–æ¶ˆï¼Ÿ')) { cart = []; updateCartUI(); }
            });
            document.getElementById('btnPay').addEventListener('click', function () {
                if (cart.length === 0) { alert('è¯·å…ˆæ·»åŠ å•†å“'); return; }
                alert('æ”¶æ¬¾åŠŸèƒ½æ¼”ç¤ºï¼šåº”æ”¶ ' + cart.reduce(function (s, x) { return s + (x.price || 0) * (x.qty || 0); }, 0).toFixed(2) + ' å…ƒ');
            });

            // ä¼šå‘˜ tabï¼šæ‰“å¼€ä¼šå‘˜æŸ¥è¯¢å¼¹çª—
            document.querySelectorAll('.mall-cashier-tab[data-tab="member"]').forEach(function (btn) {
                btn.addEventListener('click', function () {
                    document.getElementById('memberModal').classList.remove('hidden');
                    document.getElementById('memberQueryInput').value = '';
                });
            });
            document.querySelectorAll('.mall-cashier-tab[data-tab="product"]').forEach(function (btn) {
                btn.addEventListener('click', function () {
                    document.querySelectorAll('.mall-cashier-tab').forEach(function (b) { b.classList.remove('active'); });
                    btn.classList.add('active');
                });
            });
            document.querySelectorAll('.mall-cashier-tab[data-tab="order"]').forEach(function (btn) {
                btn.addEventListener('click', function () {
                    document.querySelectorAll('.mall-cashier-tab').forEach(function (b) { b.classList.remove('active'); });
                    btn.classList.add('active');
                    document.getElementById('productMain').classList.add('hidden');
                    document.getElementById('cashierBottom').classList.add('hidden');
                    document.getElementById('orderPanel').classList.remove('hidden');
                    renderOrderList();
                });
            });
            document.getElementById('orderPanelBack').addEventListener('click', function () {
                document.getElementById('orderPanel').classList.add('hidden');
                document.getElementById('productMain').classList.remove('hidden');
                document.getElementById('cashierBottom').classList.remove('hidden');
                document.querySelectorAll('.mall-cashier-tab').forEach(function (b) { b.classList.remove('active'); });
                document.querySelector('.mall-cashier-tab[data-tab="product"]').classList.add('active');
            });
            document.getElementById('orderSearchBtn').addEventListener('click', function () { renderOrderList(); });
            document.getElementById('orderSearchInput').addEventListener('keypress', function (e) { if (e.key === 'Enter') renderOrderList(); });

            function renderOrderList() {
                var keyword = (document.getElementById('orderSearchInput').value || '').trim();
                var list = getDemoOrders();
                if (keyword) list = list.filter(function (o) { return (o.orderNo || '').indexOf(keyword) >= 0; });
                var html = list.map(function (o) {
                    var productsHtml = (o.products || []).map(function (p) {
                        return '<div class="mall-order-card-product">' +
                            '<img src="' + (p.image || '../../images/01.jpg') + '" alt="" onerror="this.src=\'../../images/01.jpg\'">' +
                            '<div class="mall-order-card-product-name">' + (p.name || '') + '</div>' +
                            '<div class="mall-order-card-product-qty">x' + (p.qty || 0) + '</div>' +
                            '<div class="mall-order-card-product-price">Â¥' + (p.price != null ? (Number(p.price) * (p.qty || 0)).toFixed(2) : '0.00') + '</div>' +
                            '</div>';
                    }).join('');
                    var guideLine = o.guideId ? '<div>å¯¼è´­å‘˜ï¼š<span>' + o.guideId + '</span></div>' : '';
                    return '<div class="mall-order-card" data-id="' + (o.orderNo || '') + '">' +
                        '<div class="mall-order-card-head">' +
                        '<div>è®¢å•å·ï¼š<span>' + (o.orderNo || '') + '</span></div>' + guideLine +
                        '<div>æ”¶é“¶å‘˜ï¼š<span>' + (o.cashierId || '') + '</span></div>' +
                        '</div>' +
                        '<div class="mall-order-card-products">' + productsHtml + '</div>' +
                        '<div class="mall-order-card-footer">' +
                        '<span class="mall-order-card-total">è®¢å•æ€»ä»·ï¼šÂ¥' + (o.total != null ? Number(o.total).toFixed(2) : '0.00') + '</span>' +
                        '<span class="mall-order-card-count">ç­‰' + (o.itemCount != null ? o.itemCount : (o.products || []).length) + 'ä»¶å•†å“</span>' +
                        '</div>' +
                        '<div class="mall-order-card-actions">' +
                        '<button type="button" class="mall-order-card-btn">æ‰“å°å°ç¥¨</button>' +
                        '<button type="button" class="mall-order-card-btn">æ·»åŠ å¤‡æ³¨</button>' +
                        '<button type="button" class="mall-order-card-btn mall-order-card-btn-primary">è¯¦æƒ…</button>' +
                        '</div></div>';
                }).join('');
                document.getElementById('orderList').innerHTML = html || '<p class="mall-order-empty">æš‚æ— è®¢å•</p>';
            }
            function getDemoOrders() {
                return [
                    { orderNo: '20251227144628721232', guideId: 'dg001', cashierId: '001', total: 1500.00, itemCount: 34, products: [
                        { name: 'è’™é¡¶å±±èŒ¶', image: '../../images/05.jpg', price: 49, qty: 6 },
                        { name: 'è…Šå‘³ç¤¼ç›’', image: '../../images/04.jpg', price: 15, qty: 11 },
                        { name: 'èŠ±æ¤’æ²¹', image: '../../images/01.jpg', price: 15, qty: 1 },
                        { name: 'åœŸå¸å†œå®¶æ•£å…»è›‹', image: '../../images/02.jpg', price: 18, qty: 2 }
                    ]},
                    { orderNo: '20251227143855221198', cashierId: '001', total: 183.00, itemCount: 6, products: [
                        { name: 'è’™é¡¶å±±èŒ¶', image: '../../images/05.jpg', price: 49, qty: 2 },
                        { name: 'é›…é±¼é²œç¤¼ç›’', image: '../../images/06.jpg', price: 68, qty: 1 },
                        { name: 'ç†ŠçŒ«å‘¨è¾¹ç©å¶', image: '../../images/02.jpg', price: 28, qty: 1 }
                    ]}
                ];
            }
            document.getElementById('memberModalClose').addEventListener('click', function () {
                document.getElementById('memberModal').classList.add('hidden');
            });
            var memberInput = document.getElementById('memberQueryInput');
            document.getElementById('memberKeypad').addEventListener('click', function (e) {
                var btn = e.target.closest('.mall-member-key');
                if (!btn) return;
                var n = btn.dataset.n;
                if (n === 'del') {
                    memberInput.value = memberInput.value.slice(0, -1);
                } else if (n === 'confirm') {
                    return;
                } else {
                    memberInput.value += n;
                }
            });
            document.getElementById('memberConfirmBtn').addEventListener('click', function () {
                var val = (memberInput.value || '').trim();
                if (!val) { alert('è¯·æ‰«æä»˜æ¬¾ç æˆ–è¾“å…¥ä¼šå‘˜æ‰‹æœºå·'); return; }
                alert('æŸ¥è¯¢ä¼šå‘˜ï¼š' + val + '\nï¼ˆæ¼”ç¤ºï¼šå¯åœ¨æ­¤å¯¹æ¥ä¼šå‘˜ä¿¡æ¯æŸ¥è¯¢ï¼‰');
                document.getElementById('memberModal').classList.add('hidden');
            });

            renderProducts();
            updateCartUI();
        })();
    </script>
</body>
</html>
