<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¾€æ¥æ±‡æ€» - 2026æ–°é¡¹ç›®äºŒ</title>
    <link rel="stylesheet" href="../../css/Main.css">
    <style>
        .partner-summary-page {
            padding: var(--spacing-lg);
            background-color: var(--color-neutral-50);
        }

        /* é¡µé¢æ ‡é¢˜ */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-md);
        }

        .page-title {
            font-size: var(--font-size-2xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-text-primary);
            margin: 0;
        }

        .page-subtitle {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
        }

        /* é¡¶éƒ¨æ“ä½œæŒ‰é’®æ  */
        .toolbar-card {
            background-color: #ffffff;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-card);
            padding: var(--spacing-md) var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: var(--spacing-md);
            flex-wrap: wrap;
        }

        .toolbar-left,
        .toolbar-right {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            flex-wrap: wrap;
        }

        .btn-icon-text {
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .btn-icon-text-symbol {
            font-size: 14px;
        }

        /* ç­›é€‰æ¡ä»¶åŒºåŸŸ */
        .filter-section {
            background-color: #ffffff;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-card);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
        }

        .filter-row {
            display: flex;
            gap: var(--spacing-md);
            align-items: flex-end;
            flex-wrap: wrap;
            margin-bottom: var(--spacing-md);
        }

        .filter-item {
            flex: 1;
            min-width: 150px;
        }

        .filter-item--full {
            flex: 1 1 100%;
        }

        .filter-item label {
            display: block;
            margin-bottom: var(--spacing-xs);
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            color: var(--color-text-primary);
        }

        .filter-item input,
        .filter-item select {
            width: 100%;
            padding: var(--spacing-sm) var(--spacing-md);
            border: 1px solid var(--color-neutral-300);
            border-radius: var(--radius-md);
            font-size: var(--font-size-base);
            transition: all var(--transition-base) var(--ease-in-out);
        }

        .filter-item input:focus,
        .filter-item select:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: var(--shadow-input-focus);
        }

        .filter-actions {
            display: flex;
            gap: var(--spacing-sm);
            justify-content: flex-end;
            margin-top: var(--spacing-md);
            padding-top: var(--spacing-md);
            border-top: 1px solid var(--color-neutral-200);
        }

        /* ç»Ÿè®¡æ‘˜è¦åŒºåŸŸ */
        .summary-row {
            display: flex;
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
            flex-wrap: wrap;
        }

        .summary-card {
            flex: 1;
            min-width: 180px;
            background-color: #ffffff;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-card);
            padding: var(--spacing-md) var(--spacing-lg);
            position: relative;
        }

        .summary-label {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            margin-bottom: var(--spacing-xs);
        }

        .summary-value {
            font-size: var(--font-size-2xl);
            font-weight: var(--font-weight-bold);
            display: flex;
            align-items: baseline;
            gap: var(--spacing-xs);
        }

        .summary-value-blue {
            color: var(--color-primary);
        }

        .summary-value-red {
            color: var(--color-error);
        }

        .summary-value-green {
            color: var(--color-success);
        }

        .summary-indicator {
            position: absolute;
            top: var(--spacing-sm);
            right: var(--spacing-sm);
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .summary-indicator.blue {
            background-color: var(--color-primary);
        }

        .summary-indicator.red {
            background-color: var(--color-error);
        }

        .summary-indicator.green {
            background-color: var(--color-success);
        }

        /* è¡¨æ ¼å®¹å™¨ */
        .table-container {
            background-color: #ffffff;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-card);
            overflow: hidden;
        }

        .table-wrapper {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background-color: var(--color-neutral-50);
        }

        th, td {
            padding: var(--spacing-sm) var(--spacing-md);
            font-size: var(--font-size-sm);
            border-bottom: 1px solid var(--color-neutral-200);
            white-space: nowrap;
        }

        th {
            text-align: left;
            font-weight: var(--font-weight-medium);
            color: var(--color-text-primary);
        }

        th.sortable {
            cursor: pointer;
            user-select: none;
            position: relative;
            padding-right: var(--spacing-xl);
        }

        th.sortable::after {
            content: 'â†•';
            position: absolute;
            right: var(--spacing-sm);
            color: var(--color-neutral-400);
            font-size: var(--font-size-xs);
        }

        th.sortable.asc::after {
            content: 'â†‘';
            color: var(--color-primary);
        }

        th.sortable.desc::after {
            content: 'â†“';
            color: var(--color-primary);
        }

        tbody tr {
            transition: all var(--transition-base) var(--ease-in-out);
        }

        tbody tr:hover {
            background-color: var(--color-neutral-50);
        }

        tbody tr:last-child td {
            border-bottom: none;
        }

        .checkbox-cell {
            width: 48px;
            text-align: center;
        }

        .checkbox-cell input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .link-text {
            color: var(--color-primary);
            cursor: pointer;
        }

        .link-text:hover {
            text-decoration: underline;
        }

        .amount-positive {
            color: var(--color-success);
            font-weight: var(--font-weight-medium);
        }

        .amount-negative {
            color: var(--color-error);
            font-weight: var(--font-weight-medium);
        }

        .mobile-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: var(--radius-sm);
            font-size: var(--font-size-xs);
            background-color: rgba(40, 167, 69, 0.1);
            color: var(--color-success);
            margin-left: var(--spacing-xs);
        }

        .action-buttons {
            display: flex;
            gap: var(--spacing-xs);
            flex-wrap: wrap;
        }

        .action-btn {
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--radius-md);
            border: none;
            font-size: var(--font-size-xs);
            cursor: pointer;
            transition: all var(--transition-base) var(--ease-in-out);
        }

        .action-btn.receive {
            background-color: rgba(40, 167, 69, 0.1);
            color: var(--color-success);
        }

        .action-btn.receive:hover {
            background-color: var(--color-success);
            color: #ffffff;
        }

        .action-btn.pay {
            background-color: rgba(220, 53, 69, 0.1);
            color: var(--color-error);
        }

        .action-btn.pay:hover {
            background-color: var(--color-error);
            color: #ffffff;
        }

        .action-btn.history {
            background-color: rgba(44, 131, 235, 0.1);
            color: var(--color-primary);
        }

        .action-btn.history:hover {
            background-color: var(--color-primary);
            color: #ffffff;
        }

        .text-right {
            text-align: right;
        }

        .text-secondary {
            color: var(--color-text-secondary);
        }

        /* åˆè®¡è¡Œ */
        .table-footer-row {
            background-color: var(--color-neutral-50);
            font-weight: var(--font-weight-medium);
        }

        /* åº•éƒ¨å·¥å…·æ  */
        .bottom-toolbar {
            margin-top: var(--spacing-md);
            padding: var(--spacing-md) var(--spacing-lg);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: var(--spacing-md);
            background-color: #ffffff;
            border-radius: 0 0 var(--radius-lg) var(--radius-lg);
            border-top: 1px solid var(--color-neutral-200);
        }

        .bottom-left,
        .bottom-right {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            flex-wrap: wrap;
        }

        .bottom-left label {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-xs);
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
        }

        /* åˆ†é¡µæ§ä»¶ */
        .page-size-select {
            padding: 2px 8px;
            border-radius: var(--radius-md);
            border: 1px solid var(--color-neutral-300);
            font-size: var(--font-size-xs);
        }

        .pagination-info {
            font-size: var(--font-size-xs);
            color: var(--color-text-secondary);
        }

        .pagination-pages {
            display: inline-flex;
            align-items: center;
            gap: 2px;
        }

        .pagination-page-btn {
            min-width: 24px;
            padding: 2px 6px;
            border-radius: var(--radius-md);
            border: 1px solid var(--color-neutral-300);
            background-color: #ffffff;
            font-size: var(--font-size-xs);
            cursor: pointer;
            transition: all var(--transition-base) var(--ease-in-out);
        }

        .pagination-page-btn.active {
            background-color: var(--color-primary);
            color: #ffffff;
            border-color: var(--color-primary);
        }

        .pagination-page-btn:hover:not(.active):not(:disabled) {
            border-color: var(--color-primary);
            color: var(--color-primary);
        }

        .pagination-page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination-jump-input {
            width: 40px;
            padding: 2px 4px;
            border-radius: var(--radius-md);
            border: 1px solid var(--color-neutral-300);
            font-size: var(--font-size-xs);
            text-align: center;
        }

        /* æ¨¡æ€æ¡† */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background-color: #ffffff;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            padding: var(--spacing-lg);
            border-bottom: 1px solid var(--color-neutral-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-bold);
            color: var(--color-text-primary);
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: var(--font-size-xl);
            color: var(--color-text-secondary);
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-md);
            transition: all var(--transition-base) var(--ease-in-out);
        }

        .modal-close:hover {
            background-color: var(--color-neutral-100);
            color: var(--color-text-primary);
        }

        .modal-body {
            padding: var(--spacing-lg);
            overflow-y: auto;
            flex: 1;
        }

        .modal-footer {
            padding: var(--spacing-lg);
            border-top: 1px solid var(--color-neutral-200);
            display: flex;
            justify-content: flex-end;
            gap: var(--spacing-sm);
        }

        /* æ”¶æ¬¾/ä»˜æ¬¾è¡¨å• */
        .form-group {
            margin-bottom: var(--spacing-md);
        }

        .form-group label {
            display: block;
            margin-bottom: var(--spacing-xs);
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            color: var(--color-text-primary);
        }

        .form-group label .required {
            color: var(--color-error);
            margin-left: 2px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: var(--spacing-sm) var(--spacing-md);
            border: 1px solid var(--color-neutral-300);
            border-radius: var(--radius-md);
            font-size: var(--font-size-base);
            transition: all var(--transition-base) var(--ease-in-out);
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: var(--shadow-input-focus);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-row {
            display: flex;
            gap: var(--spacing-md);
        }

        .form-row .form-group {
            flex: 1;
        }

        /* å¾€æ¥å†ç¨‹è¡¨æ ¼ */
        .history-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: var(--spacing-md);
        }

        .history-table th,
        .history-table td {
            padding: var(--spacing-sm) var(--spacing-md);
            text-align: left;
            border-bottom: 1px solid var(--color-neutral-200);
            font-size: var(--font-size-sm);
        }

        .history-table th {
            background-color: var(--color-neutral-50);
            font-weight: var(--font-weight-medium);
            color: var(--color-text-primary);
        }

        .history-table tbody tr:hover {
            background-color: var(--color-neutral-50);
        }

        .history-type-tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: var(--radius-sm);
            font-size: var(--font-size-xs);
        }

        .history-type-tag.purchase {
            background-color: rgba(44, 131, 235, 0.1);
            color: var(--color-primary);
        }

        .history-type-tag.return {
            background-color: rgba(255, 140, 66, 0.1);
            color: #ff8c42;
        }

        .history-type-tag.receive {
            background-color: rgba(40, 167, 69, 0.1);
            color: var(--color-success);
        }

        .history-type-tag.pay {
            background-color: rgba(220, 53, 69, 0.1);
            color: var(--color-error);
        }

        /* å¾€æ¥å•ä½ä¿¡æ¯å¡ç‰‡ */
        .partner-info-card {
            background-color: var(--color-neutral-50);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
        }

        .partner-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-md);
        }

        .partner-info-item {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xs);
        }

        .partner-info-label {
            font-size: var(--font-size-xs);
            color: var(--color-text-secondary);
        }

        .partner-info-value {
            font-size: var(--font-size-base);
            color: var(--color-text-primary);
            font-weight: var(--font-weight-medium);
        }

        @media (max-width: 1200px) {
            .toolbar-card {
                flex-direction: column;
                align-items: stretch;
            }

            .filter-row {
                flex-direction: column;
            }

            .filter-item {
                width: 100%;
            }

            .page-header {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--spacing-xs);
            }

            .bottom-toolbar {
                flex-direction: column;
                align-items: flex-start;
            }

            .modal-content {
                width: 95%;
            }

            .form-row {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="partner-summary-page">
        <!-- é¡µé¢æ ‡é¢˜ -->
        <div class="page-header">
            <div>
                <h1 class="page-title">å¾€æ¥æ±‡æ€»</h1>
                <div class="page-subtitle">ç®¡ç†å’ŒæŸ¥çœ‹å¾€æ¥å•ä½åº”æ”¶åº”ä»˜ä¿¡æ¯ï¼Œæ”¯æŒæ”¶æ¬¾ä»˜æ¬¾å’Œå¾€æ¥å†ç¨‹æŸ¥è¯¢</div>
            </div>
        </div>

        <!-- é¡¶éƒ¨æ“ä½œæŒ‰é’®æ  -->
        <div class="toolbar-card">
            <div class="toolbar-left">
                <button class="btn btn-outline" id="exportBtn">
                    <span class="btn-icon-text">
                        <span class="btn-icon-text-symbol">â†‘</span>
                        <span>å¯¼å‡º</span>
                    </span>
                </button>
                <button class="btn btn-outline" id="printListBtn">
                    <span class="btn-icon-text">
                        <span class="btn-icon-text-symbol">ğŸ–¨</span>
                        <span>æ‰“å°åˆ—è¡¨</span>
                    </span>
                </button>
                <button class="btn btn-outline" id="summaryBtn">
                    <span class="btn-icon-text">
                        <span class="btn-icon-text-symbol">ğŸ“Š</span>
                        <span>å¾€æ¥æ±‡æ€»</span>
                    </span>
                </button>
            </div>
        </div>

        <!-- ç­›é€‰æ¡ä»¶åŒºåŸŸ -->
        <div class="filter-section">
            <div class="filter-row">
                <div class="filter-item">
                    <label>å¾€æ¥å•ä½ç±»å‹</label>
                    <select id="partnerTypeSelect">
                        <option value="">å…¨éƒ¨ç±»å‹</option>
                        <option value="supplier">ä¾›åº”å•†</option>
                        <option value="customer">å®¢æˆ·</option>
                        <option value="both">ä¾›åº”å•†+å®¢æˆ·</option>
                    </select>
                </div>
                <div class="filter-item">
                    <label>ä½™é¢ç­›é€‰</label>
                    <select id="balanceFilterSelect">
                        <option value="">å…¨éƒ¨</option>
                        <option value="receivable">æœ‰åº”æ”¶</option>
                        <option value="payable">æœ‰åº”ä»˜</option>
                        <option value="zero">ä½™é¢ä¸ºé›¶</option>
                    </select>
                </div>
                <div class="filter-item">
                    <label>å¿«æ·æœç´¢</label>
                    <input type="text" id="quickSearchInput" placeholder="è¾“å…¥å•ä½åç§°ã€è”ç³»äººã€æ‰‹æœºå·æœç´¢">
                </div>
            </div>
            <div class="filter-actions">
                <button class="btn btn-primary" id="searchBtn">æœç´¢</button>
            </div>
        </div>

        <!-- ç»Ÿè®¡æ‘˜è¦åŒºåŸŸ -->
        <div class="summary-row">
            <div class="summary-card">
                <span class="summary-indicator red"></span>
                <div class="summary-label">åº”æ”¶æ€»é¢(å…ƒ)</div>
                <div class="summary-value summary-value-red" id="totalReceivable">0.00</div>
            </div>
            <div class="summary-card">
                <span class="summary-indicator blue"></span>
                <div class="summary-label">åº”ä»˜æ€»é¢(å…ƒ)</div>
                <div class="summary-value summary-value-blue" id="totalPayable">0.00</div>
            </div>
            <div class="summary-card">
                <span class="summary-indicator green"></span>
                <div class="summary-label">å¾€æ¥å•ä½æ•°</div>
                <div class="summary-value summary-value-green" id="partnerCount">0</div>
            </div>
            <div class="summary-card">
                <div class="summary-label">å‡€ä½™é¢(å…ƒ)</div>
                <div class="summary-value summary-value-blue" id="netBalance">0.00</div>
            </div>
        </div>

        <!-- æ•°æ®è¡¨æ ¼ -->
        <div class="table-container">
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th class="checkbox-cell">
                                <input type="checkbox" id="selectAll">
                            </th>
                            <th>åºå·</th>
                            <th class="sortable" data-sort="name">å¾€æ¥å•ä½</th>
                            <th>è”ç³»äºº</th>
                            <th>æ‰‹æœºå·</th>
                            <th class="text-right sortable" data-sort="receivable">åº”æ”¶(å…ƒ)</th>
                            <th class="text-right sortable" data-sort="payable">åº”ä»˜(å…ƒ)</th>
                            <th class="text-right sortable" data-sort="balance">ä½™é¢(å…ƒ)</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="dataTableBody">
                        <!-- JS æ¸²æŸ“ -->
                    </tbody>
                    <tfoot>
                        <tr class="table-footer-row">
                            <td colspan="5" class="text-right">åˆè®¡ï¼š</td>
                            <td class="text-right" id="totalReceivableCell">0.00</td>
                            <td class="text-right" id="totalPayableCell">0.00</td>
                            <td class="text-right" id="totalBalanceCell">0.00</td>
                            <td></td>
                        </tr>
                    </tfoot>
                </table>
            </div>

            <!-- åº•éƒ¨å·¥å…·æ  -->
            <div class="bottom-toolbar">
                <div class="bottom-left">
                    <label>
                        <input type="checkbox" id="bottomSelectAll">
                        <span>å…¨é€‰</span>
                    </label>
                    <span class="text-secondary" id="selectedInfo">å·²é€‰æ‹© 0 æ¡è®°å½•</span>
                </div>
                <div class="bottom-right">
                    <select class="page-size-select" id="pageSizeSelect">
                        <option value="20" selected>20 æ¡/é¡µ</option>
                        <option value="50">50 æ¡/é¡µ</option>
                        <option value="100">100 æ¡/é¡µ</option>
                    </select>
                    <span class="pagination-info">å…± <span id="totalRecords">0</span> æ¡è®°å½•</span>
                    <div class="pagination-pages" id="paginationPages">
                        <!-- åˆ†é¡µæŒ‰é’®ç”±JSç”Ÿæˆ -->
                    </div>
                    <span class="pagination-info">è·³è½¬åˆ°</span>
                    <input type="number" class="pagination-jump-input" min="1" value="1" id="jumpToPage">
                    <span class="pagination-info">é¡µ</span>
                </div>
            </div>
        </div>
    </div>

    <!-- æ”¶æ¬¾æ¨¡æ€æ¡† -->
    <div class="modal" id="receiveModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">æ”¶æ¬¾</h3>
                <button class="modal-close" onclick="closeReceiveModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="partner-info-card" id="receivePartnerInfo">
                    <!-- å¾€æ¥å•ä½ä¿¡æ¯ -->
                </div>
                <div class="form-group">
                    <label>æ”¶æ¬¾é‡‘é¢ <span class="required">*</span></label>
                    <input type="number" id="receiveAmount" step="0.01" min="0.01" placeholder="è¯·è¾“å…¥æ”¶æ¬¾é‡‘é¢">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>æ”¶æ¬¾è´¦æˆ·</label>
                        <select id="receiveAccount">
                            <option value="cash">ç°é‡‘è´¦æˆ·</option>
                            <option value="bank">é“¶è¡Œè´¦æˆ·</option>
                            <option value="alipay">æ”¯ä»˜å®è´¦æˆ·</option>
                            <option value="wechat">å¾®ä¿¡è´¦æˆ·</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>æ”¶æ¬¾æ—¥æœŸ</label>
                        <input type="date" id="receiveDate">
                    </div>
                </div>
                <div class="form-group">
                    <label>å¤‡æ³¨</label>
                    <textarea id="receiveRemark" placeholder="è¯·è¾“å…¥å¤‡æ³¨ä¿¡æ¯"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeReceiveModal()">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="confirmReceive()">ç¡®è®¤æ”¶æ¬¾</button>
            </div>
        </div>
    </div>

    <!-- ä»˜æ¬¾æ¨¡æ€æ¡† -->
    <div class="modal" id="payModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ä»˜æ¬¾</h3>
                <button class="modal-close" onclick="closePayModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="partner-info-card" id="payPartnerInfo">
                    <!-- å¾€æ¥å•ä½ä¿¡æ¯ -->
                </div>
                <div class="form-group">
                    <label>ä»˜æ¬¾é‡‘é¢ <span class="required">*</span></label>
                    <input type="number" id="payAmount" step="0.01" min="0.01" placeholder="è¯·è¾“å…¥ä»˜æ¬¾é‡‘é¢">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>ä»˜æ¬¾è´¦æˆ·</label>
                        <select id="payAccount">
                            <option value="cash">ç°é‡‘è´¦æˆ·</option>
                            <option value="bank">é“¶è¡Œè´¦æˆ·</option>
                            <option value="alipay">æ”¯ä»˜å®è´¦æˆ·</option>
                            <option value="wechat">å¾®ä¿¡è´¦æˆ·</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ä»˜æ¬¾æ—¥æœŸ</label>
                        <input type="date" id="payDate">
                    </div>
                </div>
                <div class="form-group">
                    <label>å¤‡æ³¨</label>
                    <textarea id="payRemark" placeholder="è¯·è¾“å…¥å¤‡æ³¨ä¿¡æ¯"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closePayModal()">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="confirmPay()">ç¡®è®¤ä»˜æ¬¾</button>
            </div>
        </div>
    </div>

    <!-- å¾€æ¥å†ç¨‹æ¨¡æ€æ¡† -->
    <div class="modal" id="historyModal">
        <div class="modal-content" style="max-width: 1000px;">
            <div class="modal-header">
                <h3 class="modal-title">å¾€æ¥å†ç¨‹</h3>
                <button class="modal-close" onclick="closeHistoryModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="partner-info-card" id="historyPartnerInfo">
                    <!-- å¾€æ¥å•ä½ä¿¡æ¯ -->
                </div>
                <table class="history-table">
                    <thead>
                        <tr>
                            <th>æ—¥æœŸ</th>
                            <th>ç±»å‹</th>
                            <th>å•å·</th>
                            <th class="text-right">åº”æ”¶é‡‘é¢</th>
                            <th class="text-right">åº”ä»˜é‡‘é¢</th>
                            <th class="text-right">å·²æ”¶é‡‘é¢</th>
                            <th class="text-right">å·²ä»˜é‡‘é¢</th>
                            <th class="text-right">ä½™é¢</th>
                            <th>å¤‡æ³¨</th>
                        </tr>
                    </thead>
                    <tbody id="historyTableBody">
                        <!-- JS æ¸²æŸ“ -->
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeHistoryModal()">å…³é—­</button>
            </div>
        </div>
    </div>

    <script>
        // æ¨¡æ‹Ÿå¾€æ¥å•ä½æ•°æ®
        const partnerData = [
            {
                id: 'PARTNER001',
                name: 'é›…å®‰æœ¬åœ°ä¾›åº”å•†A',
                contact: 'å¼ è€æ¿',
                mobile: '13800000001',
                type: 'supplier',
                receivable: 0.00,
                payable: 800.00,
                balance: -800.00,
                mobileBound: true
            },
            {
                id: 'PARTNER002',
                name: 'æˆéƒ½æ‰¹å‘å•†B',
                contact: 'æç»ç†',
                mobile: '13800000002',
                type: 'supplier',
                receivable: 0.00,
                payable: 560.00,
                balance: -560.00,
                mobileBound: true
            },
            {
                id: 'PARTNER003',
                name: 'é›…å®‰æœ¬åœ°ä¾›åº”å•†C',
                contact: 'ç‹æ€»',
                mobile: '13800000003',
                type: 'supplier',
                receivable: 0.00,
                payable: 1500.00,
                balance: -1500.00,
                mobileBound: false
            },
            {
                id: 'PARTNER004',
                name: 'èŒ¶å¶ä¾›åº”å•†D',
                contact: 'èµµè€æ¿',
                mobile: '13800000004',
                type: 'supplier',
                receivable: 0.00,
                payable: 1497.00,
                balance: -1497.00,
                mobileBound: true
            },
            {
                id: 'PARTNER005',
                name: 'é›…å®‰æ‰¹å‘å•†A',
                contact: 'å¼ è€æ¿',
                mobile: '13800000010',
                type: 'customer',
                receivable: 5000.00,
                payable: 0.00,
                balance: 5000.00,
                mobileBound: true
            },
            {
                id: 'PARTNER006',
                name: 'æˆéƒ½æ‰¹å‘å•†B',
                contact: 'æç»ç†',
                mobile: '13800000011',
                type: 'customer',
                receivable: 3000.00,
                payable: 0.00,
                balance: 3000.00,
                mobileBound: true
            },
            {
                id: 'PARTNER007',
                name: 'é›…å®‰æ‰¹å‘å•†C',
                contact: 'ç‹æ€»',
                mobile: '13800000012',
                type: 'customer',
                receivable: 8500.00,
                payable: 0.00,
                balance: 8500.00,
                mobileBound: false
            }
        ];

        // æ¨¡æ‹Ÿå¾€æ¥å†ç¨‹æ•°æ®
        const historyData = {
            'PARTNER001': [
                {
                    date: '2025-01-15',
                    type: 'purchase',
                    typeText: 'é‡‡è´­è¿›è´§',
                    orderNo: 'JH20250115001',
                    receivable: 0.00,
                    payable: 1800.20,
                    received: 1000.20,
                    paid: 0.00,
                    balance: -800.00,
                    remark: 'é¦–æ‰¹åˆ°è´§'
                },
                {
                    date: '2025-01-20',
                    type: 'receive',
                    typeText: 'æ”¶æ¬¾',
                    orderNo: 'SK20250120001',
                    receivable: 0.00,
                    payable: 0.00,
                    received: 1000.20,
                    paid: 0.00,
                    balance: -800.00,
                    remark: 'éƒ¨åˆ†æ”¶æ¬¾'
                }
            ],
            'PARTNER002': [
                {
                    date: '2025-01-16',
                    type: 'purchase',
                    typeText: 'é‡‡è´­è¿›è´§',
                    orderNo: 'JH20250116001',
                    receivable: 0.00,
                    payable: 1200.00,
                    received: 640.00,
                    paid: 0.00,
                    balance: -560.00,
                    remark: ''
                },
                {
                    date: '2025-01-18',
                    type: 'receive',
                    typeText: 'æ”¶æ¬¾',
                    orderNo: 'SK20250118001',
                    receivable: 0.00,
                    payable: 0.00,
                    received: 640.00,
                    paid: 0.00,
                    balance: -560.00,
                    remark: 'éƒ¨åˆ†æ”¶æ¬¾'
                }
            ],
            'PARTNER005': [
                {
                    date: '2025-01-26',
                    type: 'purchase',
                    typeText: 'æ‰¹å‘è®¢å•',
                    orderNo: 'PF20250126001',
                    receivable: 5000.00,
                    payable: 0.00,
                    received: 0.00,
                    paid: 0.00,
                    balance: 5000.00,
                    remark: 'å•†å®¶è‡ªåŠ©(å®ä»˜)'
                }
            ],
            'PARTNER006': [
                {
                    date: '2025-01-26',
                    type: 'purchase',
                    typeText: 'æ‰¹å‘è®¢å•',
                    orderNo: 'PF20250126002',
                    receivable: 3000.00,
                    payable: 0.00,
                    received: 0.00,
                    paid: 0.00,
                    balance: 3000.00,
                    remark: 'å•†å®¶è‡ªåŠ©(èµŠè´¦)'
                }
            ]
        };

        let currentPage = 1;
        let pageSize = 20;
        let sortField = '';
        let sortOrder = '';
        let selectedIds = new Set();
        let filteredData = [...partnerData];
        let currentPartnerId = null;

        // åˆå§‹åŒ–
        function init() {
            // è®¾ç½®é»˜è®¤æ—¥æœŸä¸ºä»Šå¤©
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('receiveDate').value = today;
            document.getElementById('payDate').value = today;
            
            renderTable();
            updatePagination();
            updateSummary();
            bindEvents();
        }

        // è·å–ç­›é€‰åçš„æ•°æ®
        function getFilteredData() {
            let data = [...partnerData];
            
            const partnerType = document.getElementById('partnerTypeSelect').value;
            const balanceFilter = document.getElementById('balanceFilterSelect').value;
            const quickSearch = document.getElementById('quickSearchInput').value.trim().toLowerCase();
            
            if (partnerType) {
                if (partnerType === 'supplier') {
                    data = data.filter(item => item.type === 'supplier');
                } else if (partnerType === 'customer') {
                    data = data.filter(item => item.type === 'customer');
                }
                // 'both' è¡¨ç¤ºä¸è¿‡æ»¤
            }
            
            if (balanceFilter) {
                if (balanceFilter === 'receivable') {
                    data = data.filter(item => item.receivable > 0);
                } else if (balanceFilter === 'payable') {
                    data = data.filter(item => item.payable > 0);
                } else if (balanceFilter === 'zero') {
                    data = data.filter(item => item.balance === 0);
                }
            }
            
            if (quickSearch) {
                data = data.filter(item => 
                    item.name.toLowerCase().includes(quickSearch) ||
                    item.contact.toLowerCase().includes(quickSearch) ||
                    item.mobile.includes(quickSearch)
                );
            }
            
            return data;
        }

        // æ›´æ–°ç»Ÿè®¡æ‘˜è¦
        function updateSummary() {
            const data = getFilteredData();
            
            // åº”æ”¶æ€»é¢
            const totalReceivable = data.reduce((sum, item) => sum + item.receivable, 0);
            
            // åº”ä»˜æ€»é¢
            const totalPayable = data.reduce((sum, item) => sum + item.payable, 0);
            
            // å¾€æ¥å•ä½æ•°
            const partnerCount = data.length;
            
            // å‡€ä½™é¢ï¼ˆåº”æ”¶-åº”ä»˜ï¼‰
            const netBalance = totalReceivable - totalPayable;
            
            // æ›´æ–°æ˜¾ç¤º
            document.getElementById('totalReceivable').textContent = totalReceivable.toFixed(2);
            document.getElementById('totalPayable').textContent = totalPayable.toFixed(2);
            document.getElementById('partnerCount').textContent = partnerCount;
            document.getElementById('netBalance').textContent = netBalance.toFixed(2);
            
            // å‡€ä½™é¢é¢œè‰²
            const netBalanceElement = document.getElementById('netBalance');
            netBalanceElement.className = 'summary-value ' + (netBalance >= 0 ? 'summary-value-green' : 'summary-value-red');
        }

        // æ¸²æŸ“è¡¨æ ¼
        function renderTable() {
            const tbody = document.getElementById('dataTableBody');
            tbody.innerHTML = '';

            filteredData = getFilteredData();
            const startIndex = (currentPage - 1) * pageSize;
            const endIndex = startIndex + pageSize;
            const pageData = filteredData.slice(startIndex, endIndex);

            pageData.forEach((item, index) => {
                const row = document.createElement('tr');
                
                const balanceClass = item.balance >= 0 ? 'amount-positive' : 'amount-negative';
                const balanceText = item.balance >= 0 ? `+${item.balance.toFixed(2)}` : item.balance.toFixed(2);
                
                row.innerHTML = `
                    <td class="checkbox-cell">
                        <input type="checkbox" class="row-checkbox" data-id="${item.id}">
                    </td>
                    <td>${startIndex + index + 1}</td>
                    <td>
                        <span class="link-text" onclick="viewPartnerDetail('${item.id}')">${item.name}</span>
                    </td>
                    <td>${item.contact}</td>
                    <td>
                        ${item.mobile}
                        ${item.mobileBound ? '<span class="mobile-badge" title="å·²ç»‘å®šï¼Œå¯ç”¨äºæ”¶é“¶å°æè´§æŠ˜æ‰£">å·²ç»‘å®š</span>' : ''}
                    </td>
                    <td class="text-right amount-positive">${item.receivable.toFixed(2)}</td>
                    <td class="text-right amount-negative">${item.payable.toFixed(2)}</td>
                    <td class="text-right ${balanceClass}">${balanceText}</td>
                    <td>
                        <div class="action-buttons">
                            ${item.receivable > 0 ? `<button class="action-btn receive" onclick="openReceiveModal('${item.id}')">æ”¶æ¬¾</button>` : ''}
                            ${item.payable > 0 ? `<button class="action-btn pay" onclick="openPayModal('${item.id}')">ä»˜æ¬¾</button>` : ''}
                            <button class="action-btn history" onclick="openHistoryModal('${item.id}')">å¾€æ¥å†ç¨‹</button>
                        </div>
                    </td>
                `;

                tbody.appendChild(row);
            });

            // æ›´æ–°åˆè®¡è¡Œ
            const totalReceivable = filteredData.reduce((sum, item) => sum + item.receivable, 0);
            const totalPayable = filteredData.reduce((sum, item) => sum + item.payable, 0);
            const totalBalance = filteredData.reduce((sum, item) => sum + item.balance, 0);
            
            document.getElementById('totalReceivableCell').textContent = totalReceivable.toFixed(2);
            document.getElementById('totalPayableCell').textContent = totalPayable.toFixed(2);
            document.getElementById('totalBalanceCell').textContent = totalBalance.toFixed(2);

            updateSelectedInfo();
        }

        // æ›´æ–°åˆ†é¡µ
        function updatePagination() {
            const totalRecords = filteredData.length;
            const totalPages = Math.ceil(totalRecords / pageSize);
            document.getElementById('totalRecords').textContent = totalRecords;

            const paginationPages = document.getElementById('paginationPages');
            paginationPages.innerHTML = '';

            if (totalPages === 0) {
                return;
            }

            // ä¸Šä¸€é¡µ
            const prevBtn = document.createElement('button');
            prevBtn.className = 'pagination-page-btn';
            prevBtn.textContent = 'ä¸Šä¸€é¡µ';
            prevBtn.disabled = currentPage === 1;
            prevBtn.onclick = () => {
                if (currentPage > 1) {
                    currentPage--;
                    renderTable();
                    updatePagination();
                }
            };
            paginationPages.appendChild(prevBtn);

            // é¡µç æŒ‰é’®
            for (let i = 1; i <= totalPages; i++) {
                if (totalPages > 7 && i !== 1 && i !== totalPages && Math.abs(i - currentPage) > 1) {
                    if (Math.abs(i - currentPage) === 2) {
                        const ellipsis = document.createElement('span');
                        ellipsis.className = 'pagination-info';
                        ellipsis.textContent = '...';
                        paginationPages.appendChild(ellipsis);
                    }
                    continue;
                }
                
                const btn = document.createElement('button');
                btn.className = 'pagination-page-btn' + (i === currentPage ? ' active' : '');
                btn.textContent = i;
                btn.onclick = () => {
                    currentPage = i;
                    renderTable();
                    updatePagination();
                };
                paginationPages.appendChild(btn);
            }

            // ä¸‹ä¸€é¡µ
            const nextBtn = document.createElement('button');
            nextBtn.className = 'pagination-page-btn';
            nextBtn.textContent = 'ä¸‹ä¸€é¡µ';
            nextBtn.disabled = currentPage === totalPages;
            nextBtn.onclick = () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    renderTable();
                    updatePagination();
                }
            };
            paginationPages.appendChild(nextBtn);
        }

        // æ‰“å¼€æ”¶æ¬¾æ¨¡æ€æ¡†
        function openReceiveModal(partnerId) {
            currentPartnerId = partnerId;
            const partner = partnerData.find(p => p.id === partnerId);
            if (!partner) return;

            // æ˜¾ç¤ºå¾€æ¥å•ä½ä¿¡æ¯
            const infoHtml = `
                <div class="partner-info-grid">
                    <div class="partner-info-item">
                        <div class="partner-info-label">å¾€æ¥å•ä½</div>
                        <div class="partner-info-value">${partner.name}</div>
                    </div>
                    <div class="partner-info-item">
                        <div class="partner-info-label">è”ç³»äºº</div>
                        <div class="partner-info-value">${partner.contact}</div>
                    </div>
                    <div class="partner-info-item">
                        <div class="partner-info-label">æ‰‹æœºå·</div>
                        <div class="partner-info-value">${partner.mobile}</div>
                    </div>
                    <div class="partner-info-item">
                        <div class="partner-info-label">åº”æ”¶é‡‘é¢</div>
                        <div class="partner-info-value amount-positive">${partner.receivable.toFixed(2)} å…ƒ</div>
                    </div>
                </div>
            `;
            document.getElementById('receivePartnerInfo').innerHTML = infoHtml;

            // è®¾ç½®æœ€å¤§æ”¶æ¬¾é‡‘é¢
            document.getElementById('receiveAmount').max = partner.receivable;
            document.getElementById('receiveAmount').value = partner.receivable > 0 ? partner.receivable.toFixed(2) : '';

            document.getElementById('receiveModal').classList.add('show');
        }

        // å…³é—­æ”¶æ¬¾æ¨¡æ€æ¡†
        function closeReceiveModal() {
            document.getElementById('receiveModal').classList.remove('show');
            currentPartnerId = null;
            // æ¸…ç©ºè¡¨å•
            document.getElementById('receiveAmount').value = '';
            document.getElementById('receiveRemark').value = '';
        }

        // ç¡®è®¤æ”¶æ¬¾
        function confirmReceive() {
            const amount = parseFloat(document.getElementById('receiveAmount').value);
            const account = document.getElementById('receiveAccount').value;
            const date = document.getElementById('receiveDate').value;
            const remark = document.getElementById('receiveRemark').value;

            if (!amount || amount <= 0) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„æ”¶æ¬¾é‡‘é¢');
                return;
            }

            const partner = partnerData.find(p => p.id === currentPartnerId);
            if (amount > partner.receivable) {
                alert('æ”¶æ¬¾é‡‘é¢ä¸èƒ½è¶…è¿‡åº”æ”¶é‡‘é¢');
                return;
            }

            // æ¨¡æ‹Ÿæ”¶æ¬¾
            partner.receivable -= amount;
            partner.balance = partner.receivable - partner.payable;

            // æ·»åŠ åˆ°å¾€æ¥å†ç¨‹
            if (!historyData[currentPartnerId]) {
                historyData[currentPartnerId] = [];
            }
            historyData[currentPartnerId].unshift({
                date: date,
                type: 'receive',
                typeText: 'æ”¶æ¬¾',
                orderNo: 'SK' + new Date().getTime(),
                receivable: 0.00,
                payable: 0.00,
                received: amount,
                paid: 0.00,
                balance: partner.balance,
                remark: remark || 'æ”¶æ¬¾'
            });

            alert(`æ”¶æ¬¾æˆåŠŸï¼\næ”¶æ¬¾é‡‘é¢ï¼š${amount.toFixed(2)} å…ƒ\næ”¶æ¬¾è´¦æˆ·ï¼š${account}\næ”¶æ¬¾æ—¥æœŸï¼š${date}`);
            closeReceiveModal();
            renderTable();
            updateSummary();
        }

        // æ‰“å¼€ä»˜æ¬¾æ¨¡æ€æ¡†
        function openPayModal(partnerId) {
            currentPartnerId = partnerId;
            const partner = partnerData.find(p => p.id === partnerId);
            if (!partner) return;

            // æ˜¾ç¤ºå¾€æ¥å•ä½ä¿¡æ¯
            const infoHtml = `
                <div class="partner-info-grid">
                    <div class="partner-info-item">
                        <div class="partner-info-label">å¾€æ¥å•ä½</div>
                        <div class="partner-info-value">${partner.name}</div>
                    </div>
                    <div class="partner-info-item">
                        <div class="partner-info-label">è”ç³»äºº</div>
                        <div class="partner-info-value">${partner.contact}</div>
                    </div>
                    <div class="partner-info-item">
                        <div class="partner-info-label">æ‰‹æœºå·</div>
                        <div class="partner-info-value">${partner.mobile}</div>
                    </div>
                    <div class="partner-info-item">
                        <div class="partner-info-label">åº”ä»˜é‡‘é¢</div>
                        <div class="partner-info-value amount-negative">${partner.payable.toFixed(2)} å…ƒ</div>
                    </div>
                </div>
            `;
            document.getElementById('payPartnerInfo').innerHTML = infoHtml;

            // è®¾ç½®æœ€å¤§ä»˜æ¬¾é‡‘é¢
            document.getElementById('payAmount').max = partner.payable;
            document.getElementById('payAmount').value = partner.payable > 0 ? partner.payable.toFixed(2) : '';

            document.getElementById('payModal').classList.add('show');
        }

        // å…³é—­ä»˜æ¬¾æ¨¡æ€æ¡†
        function closePayModal() {
            document.getElementById('payModal').classList.remove('show');
            currentPartnerId = null;
            // æ¸…ç©ºè¡¨å•
            document.getElementById('payAmount').value = '';
            document.getElementById('payRemark').value = '';
        }

        // ç¡®è®¤ä»˜æ¬¾
        function confirmPay() {
            const amount = parseFloat(document.getElementById('payAmount').value);
            const account = document.getElementById('payAccount').value;
            const date = document.getElementById('payDate').value;
            const remark = document.getElementById('payRemark').value;

            if (!amount || amount <= 0) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„ä»˜æ¬¾é‡‘é¢');
                return;
            }

            const partner = partnerData.find(p => p.id === currentPartnerId);
            if (amount > partner.payable) {
                alert('ä»˜æ¬¾é‡‘é¢ä¸èƒ½è¶…è¿‡åº”ä»˜é‡‘é¢');
                return;
            }

            // æ¨¡æ‹Ÿä»˜æ¬¾
            partner.payable -= amount;
            partner.balance = partner.receivable - partner.payable;

            // æ·»åŠ åˆ°å¾€æ¥å†ç¨‹
            if (!historyData[currentPartnerId]) {
                historyData[currentPartnerId] = [];
            }
            historyData[currentPartnerId].unshift({
                date: date,
                type: 'pay',
                typeText: 'ä»˜æ¬¾',
                orderNo: 'FK' + new Date().getTime(),
                receivable: 0.00,
                payable: 0.00,
                received: 0.00,
                paid: amount,
                balance: partner.balance,
                remark: remark || 'ä»˜æ¬¾'
            });

            alert(`ä»˜æ¬¾æˆåŠŸï¼\nä»˜æ¬¾é‡‘é¢ï¼š${amount.toFixed(2)} å…ƒ\nä»˜æ¬¾è´¦æˆ·ï¼š${account}\nä»˜æ¬¾æ—¥æœŸï¼š${date}`);
            closePayModal();
            renderTable();
            updateSummary();
        }

        // æ‰“å¼€å¾€æ¥å†ç¨‹æ¨¡æ€æ¡†
        function openHistoryModal(partnerId) {
            currentPartnerId = partnerId;
            const partner = partnerData.find(p => p.id === partnerId);
            if (!partner) return;

            // æ˜¾ç¤ºå¾€æ¥å•ä½ä¿¡æ¯
            const infoHtml = `
                <div class="partner-info-grid">
                    <div class="partner-info-item">
                        <div class="partner-info-label">å¾€æ¥å•ä½</div>
                        <div class="partner-info-value">${partner.name}</div>
                    </div>
                    <div class="partner-info-item">
                        <div class="partner-info-label">è”ç³»äºº</div>
                        <div class="partner-info-value">${partner.contact}</div>
                    </div>
                    <div class="partner-info-item">
                        <div class="partner-info-label">æ‰‹æœºå·</div>
                        <div class="partner-info-value">${partner.mobile} ${partner.mobileBound ? '<span class="mobile-badge">å·²ç»‘å®š</span>' : ''}</div>
                    </div>
                    <div class="partner-info-item">
                        <div class="partner-info-label">å½“å‰ä½™é¢</div>
                        <div class="partner-info-value ${partner.balance >= 0 ? 'amount-positive' : 'amount-negative'}">${partner.balance >= 0 ? '+' : ''}${partner.balance.toFixed(2)} å…ƒ</div>
                    </div>
                </div>
            `;
            document.getElementById('historyPartnerInfo').innerHTML = infoHtml;

            // æ¸²æŸ“å¾€æ¥å†ç¨‹è¡¨æ ¼
            const history = historyData[partnerId] || [];
            const tbody = document.getElementById('historyTableBody');
            tbody.innerHTML = '';

            if (history.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" style="text-align: center; color: var(--color-text-secondary);">æš‚æ— å¾€æ¥è®°å½•</td></tr>';
            } else {
                history.forEach(item => {
                    const row = document.createElement('tr');
                    const balanceClass = item.balance >= 0 ? 'amount-positive' : 'amount-negative';
                    const balanceText = item.balance >= 0 ? `+${item.balance.toFixed(2)}` : item.balance.toFixed(2);
                    
                    row.innerHTML = `
                        <td>${item.date}</td>
                        <td><span class="history-type-tag ${item.type}">${item.typeText}</span></td>
                        <td>${item.orderNo}</td>
                        <td class="text-right amount-positive">${item.receivable.toFixed(2)}</td>
                        <td class="text-right amount-negative">${item.payable.toFixed(2)}</td>
                        <td class="text-right amount-positive">${item.received.toFixed(2)}</td>
                        <td class="text-right amount-negative">${item.paid.toFixed(2)}</td>
                        <td class="text-right ${balanceClass}">${balanceText}</td>
                        <td>${item.remark || '-'}</td>
                    `;
                    tbody.appendChild(row);
                });
            }

            document.getElementById('historyModal').classList.add('show');
        }

        // å…³é—­å¾€æ¥å†ç¨‹æ¨¡æ€æ¡†
        function closeHistoryModal() {
            document.getElementById('historyModal').classList.remove('show');
            currentPartnerId = null;
        }

        // ç»‘å®šäº‹ä»¶
        function bindEvents() {
            // å…¨é€‰
            document.getElementById('selectAll').addEventListener('change', function() {
                const checked = this.checked;
                document.querySelectorAll('.row-checkbox').forEach(cb => {
                    cb.checked = checked;
                    if (checked) {
                        selectedIds.add(cb.dataset.id);
                    } else {
                        selectedIds.delete(cb.dataset.id);
                    }
                });
                document.getElementById('bottomSelectAll').checked = checked;
                updateSelectedInfo();
            });

            document.getElementById('bottomSelectAll').addEventListener('change', function() {
                document.getElementById('selectAll').checked = this.checked;
                document.getElementById('selectAll').dispatchEvent(new Event('change'));
            });

            // è¡Œå¤é€‰æ¡†
            document.addEventListener('change', function(e) {
                if (e.target.classList.contains('row-checkbox')) {
                    const id = e.target.dataset.id;
                    if (e.target.checked) {
                        selectedIds.add(id);
                    } else {
                        selectedIds.delete(id);
                    }
                    updateSelectAllState();
                    updateSelectedInfo();
                }
            });

            // æ’åº
            document.querySelectorAll('th.sortable').forEach(th => {
                th.addEventListener('click', function() {
                    const field = this.dataset.sort;
                    if (sortField === field) {
                        sortOrder = sortOrder === 'asc' ? 'desc' : 'asc';
                    } else {
                        sortField = field;
                        sortOrder = 'asc';
                    }
                    // æ›´æ–°æ’åºå›¾æ ‡
                    document.querySelectorAll('th.sortable').forEach(t => {
                        t.classList.remove('asc', 'desc');
                    });
                    this.classList.add(sortOrder);
                    // è¿™é‡Œå¯ä»¥æ·»åŠ æ’åºé€»è¾‘
                    renderTable();
                });
            });

            // æœç´¢
            document.getElementById('searchBtn').addEventListener('click', function() {
                currentPage = 1;
                renderTable();
                updatePagination();
                updateSummary();
            });

            // ç­›é€‰æ¡ä»¶å˜åŒ–
            ['partnerTypeSelect', 'balanceFilterSelect'].forEach(id => {
                document.getElementById(id).addEventListener('change', function() {
                    currentPage = 1;
                    renderTable();
                    updatePagination();
                    updateSummary();
                });
            });

            // å¿«æ·æœç´¢
            document.getElementById('quickSearchInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    document.getElementById('searchBtn').click();
                }
            });

            // åˆ†é¡µå¤§å°
            document.getElementById('pageSizeSelect').addEventListener('change', function() {
                pageSize = parseInt(this.value);
                currentPage = 1;
                renderTable();
                updatePagination();
            });

            // è·³è½¬é¡µé¢
            document.getElementById('jumpToPage').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    const page = parseInt(this.value);
                    const totalPages = Math.ceil(filteredData.length / pageSize);
                    if (page >= 1 && page <= totalPages) {
                        currentPage = page;
                        renderTable();
                        updatePagination();
                    }
                }
            });

            // ========== å¯¼å‡ºåŠŸèƒ½ ==========
            document.getElementById('exportBtn').addEventListener('click', () => {
                const data = getFilteredData();
                if (data.length === 0) {
                    alert('æ²¡æœ‰æ•°æ®å¯å¯¼å‡º');
                    return;
                }
                
                const headers = ['å•ä½åç§°', 'è”ç³»äºº', 'æ‰‹æœºå·', 'ç±»å‹', 'åº”æ”¶é‡‘é¢', 'åº”ä»˜é‡‘é¢', 'ä½™é¢', 'æ‰‹æœºç»‘å®š'];
                const rows = data.map(item => [
                    item.name || '',
                    item.contact || '',
                    item.mobile || '',
                    item.type === 'supplier' ? 'ä¾›åº”å•†' : 'å®¢æˆ·',
                    item.receivable.toFixed(2),
                    item.payable.toFixed(2),
                    item.balance.toFixed(2),
                    item.mobileBound ? 'å·²ç»‘å®š' : 'æœªç»‘å®š'
                ].join(','));
                
                const csvContent = [headers.join(','), ...rows].join('\n');
                const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', 'å¾€æ¥æ±‡æ€»_' + new Date().toISOString().slice(0, 10) + '.csv');
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            });

            // ========== æ‰“å°åˆ—è¡¨ ==========
            document.getElementById('printListBtn').addEventListener('click', () => {
                const data = getFilteredData();
                if (data.length === 0) {
                    alert('æ²¡æœ‰æ•°æ®å¯æ‰“å°');
                    return;
                }
                
                const printWindow = window.open('', '_blank');
                const printContent = `
                    <html>
                        <head>
                            <title>å¾€æ¥æ±‡æ€»åˆ—è¡¨</title>
                            <style>
                                body { font-family: Arial, sans-serif; padding: 20px; }
                                h1 { text-align: center; }
                                table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                                th, td { border: 1px solid #ddd; padding: 8px; text-align: left; font-size: 12px; }
                                th { background-color: #f2f2f2; }
                            </style>
                        </head>
                        <body>
                            <h1>å¾€æ¥æ±‡æ€»åˆ—è¡¨</h1>
                            <p>æ‰“å°æ—¶é—´ï¼š${new Date().toLocaleString('zh-CN')}</p>
                            <table>
                                <thead>
                                    <tr>
                                        <th>å•ä½åç§°</th>
                                        <th>è”ç³»äºº</th>
                                        <th>æ‰‹æœºå·</th>
                                        <th>ç±»å‹</th>
                                        <th>åº”æ”¶é‡‘é¢</th>
                                        <th>åº”ä»˜é‡‘é¢</th>
                                        <th>ä½™é¢</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${data.map((item, index) => `
                                        <tr>
                                            <td>${item.name || '-'}</td>
                                            <td>${item.contact || '-'}</td>
                                            <td>${item.mobile || '-'}</td>
                                            <td>${item.type === 'supplier' ? 'ä¾›åº”å•†' : 'å®¢æˆ·'}</td>
                                            <td>${item.receivable.toFixed(2)}</td>
                                            <td>${item.payable.toFixed(2)}</td>
                                            <td>${item.balance.toFixed(2)}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </body>
                    </html>
                `;
                printWindow.document.write(printContent);
                printWindow.document.close();
                printWindow.print();
            });

            // ========== å¾€æ¥æ±‡æ€»ç»Ÿè®¡ ==========
            document.getElementById('summaryBtn').addEventListener('click', () => {
                const data = getFilteredData();
                const totalReceivable = data.reduce((sum, item) => sum + item.receivable, 0);
                const totalPayable = data.reduce((sum, item) => sum + item.payable, 0);
                const netBalance = totalReceivable - totalPayable;
                const supplierCount = data.filter(item => item.type === 'supplier').length;
                const customerCount = data.filter(item => item.type === 'customer').length;
                
                const summaryContent = `
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--spacing-md); margin-bottom: var(--spacing-lg);">
                        <div style="padding: var(--spacing-md); background: var(--color-neutral-50); border-radius: var(--radius-md);">
                            <div style="font-size: var(--font-size-sm); color: var(--color-text-secondary); margin-bottom: var(--spacing-xs);">åº”æ”¶æ€»é¢</div>
                            <div style="font-size: var(--font-size-xl); font-weight: bold; color: var(--color-success);">Â¥${totalReceivable.toFixed(2)}</div>
                        </div>
                        <div style="padding: var(--spacing-md); background: var(--color-neutral-50); border-radius: var(--radius-md);">
                            <div style="font-size: var(--font-size-sm); color: var(--color-text-secondary); margin-bottom: var(--spacing-xs);">åº”ä»˜æ€»é¢</div>
                            <div style="font-size: var(--font-size-xl); font-weight: bold; color: var(--color-error);">Â¥${totalPayable.toFixed(2)}</div>
                        </div>
                        <div style="padding: var(--spacing-md); background: var(--color-neutral-50); border-radius: var(--radius-md);">
                            <div style="font-size: var(--font-size-sm); color: var(--color-text-secondary); margin-bottom: var(--spacing-xs);">å‡€ä½™é¢</div>
                            <div style="font-size: var(--font-size-xl); font-weight: bold; color: var(--color-primary);">Â¥${netBalance.toFixed(2)}</div>
                        </div>
                        <div style="padding: var(--spacing-md); background: var(--color-neutral-50); border-radius: var(--radius-md);">
                            <div style="font-size: var(--font-size-sm); color: var(--color-text-secondary); margin-bottom: var(--spacing-xs);">ä¾›åº”å•†æ•°</div>
                            <div style="font-size: var(--font-size-xl); font-weight: bold;">${supplierCount} å®¶</div>
                        </div>
                        <div style="padding: var(--spacing-md); background: var(--color-neutral-50); border-radius: var(--radius-md);">
                            <div style="font-size: var(--font-size-sm); color: var(--color-text-secondary); margin-bottom: var(--spacing-xs);">å®¢æˆ·æ•°</div>
                            <div style="font-size: var(--font-size-xl); font-weight: bold;">${customerCount} å®¶</div>
                        </div>
                    </div>
                `;
                
                const modal = document.createElement('div');
                modal.className = 'modal';
                modal.id = 'summaryModal';
                modal.innerHTML = `
                    <div class="modal-content" style="max-width: 700px;">
                        <div class="modal-header">
                            <h3 class="modal-title">å¾€æ¥æ±‡æ€»ç»Ÿè®¡</h3>
                            <button class="modal-close" onclick="this.closest('.modal').remove()">Ã—</button>
                        </div>
                        <div class="modal-body">
                            ${summaryContent}
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-primary" onclick="this.closest('.modal').remove()">å…³é—­</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
                modal.classList.add('show');
            });

            // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
            document.getElementById('receiveModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeReceiveModal();
                }
            });

            document.getElementById('payModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closePayModal();
                }
            });

            document.getElementById('historyModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeHistoryModal();
                }
            });
        }

        // æ›´æ–°å…¨é€‰çŠ¶æ€
        function updateSelectAllState() {
            const checkboxes = document.querySelectorAll('.row-checkbox');
            const checkedCount = Array.from(checkboxes).filter(cb => cb.checked).length;
            document.getElementById('selectAll').checked = checkboxes.length > 0 && checkedCount === checkboxes.length;
            document.getElementById('bottomSelectAll').checked = document.getElementById('selectAll').checked;
        }

        // æ›´æ–°é€‰ä¸­ä¿¡æ¯
        function updateSelectedInfo() {
            document.getElementById('selectedInfo').textContent = `å·²é€‰æ‹© ${selectedIds.size} æ¡è®°å½•`;
        }

        // ========== æŸ¥çœ‹å¾€æ¥å•ä½è¯¦æƒ… ==========
        function viewPartnerDetail(id) {
            const item = partnerData.find(d => d.id === id);
            if (!item) return;
            
            const detailContent = `
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--spacing-md);">
                    <div>
                        <div style="font-size: var(--font-size-sm); color: var(--color-text-secondary); margin-bottom: var(--spacing-xs);">å•ä½åç§°</div>
                        <div style="font-size: var(--font-size-base); font-weight: bold;">${item.name || '-'}</div>
                    </div>
                    <div>
                        <div style="font-size: var(--font-size-sm); color: var(--color-text-secondary); margin-bottom: var(--spacing-xs);">è”ç³»äºº</div>
                        <div style="font-size: var(--font-size-base);">${item.contact || '-'}</div>
                    </div>
                    <div>
                        <div style="font-size: var(--font-size-sm); color: var(--color-text-secondary); margin-bottom: var(--spacing-xs);">æ‰‹æœºå·</div>
                        <div style="font-size: var(--font-size-base);">${item.mobile || '-'}</div>
                    </div>
                    <div>
                        <div style="font-size: var(--font-size-sm); color: var(--color-text-secondary); margin-bottom: var(--spacing-xs);">ç±»å‹</div>
                        <div style="font-size: var(--font-size-base);">${item.type === 'supplier' ? 'ä¾›åº”å•†' : 'å®¢æˆ·'}</div>
                    </div>
                    <div>
                        <div style="font-size: var(--font-size-sm); color: var(--color-text-secondary); margin-bottom: var(--spacing-xs);">åº”æ”¶é‡‘é¢</div>
                        <div style="font-size: var(--font-size-lg); font-weight: bold; color: var(--color-success);">Â¥${item.receivable.toFixed(2)}</div>
                    </div>
                    <div>
                        <div style="font-size: var(--font-size-sm); color: var(--color-text-secondary); margin-bottom: var(--spacing-xs);">åº”ä»˜é‡‘é¢</div>
                        <div style="font-size: var(--font-size-lg); font-weight: bold; color: var(--color-error);">Â¥${item.payable.toFixed(2)}</div>
                    </div>
                    <div>
                        <div style="font-size: var(--font-size-sm); color: var(--color-text-secondary); margin-bottom: var(--spacing-xs);">ä½™é¢</div>
                        <div style="font-size: var(--font-size-lg); font-weight: bold; color: var(--color-primary);">Â¥${item.balance.toFixed(2)}</div>
                    </div>
                    <div>
                        <div style="font-size: var(--font-size-sm); color: var(--color-text-secondary); margin-bottom: var(--spacing-xs);">æ‰‹æœºç»‘å®š</div>
                        <div style="font-size: var(--font-size-base);">${item.mobileBound ? 'å·²ç»‘å®šï¼ˆå¯ç”¨äºæ”¶é“¶å°æè´§æŠ˜æ‰£ï¼‰' : 'æœªç»‘å®š'}</div>
                    </div>
                </div>
            `;
            
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.id = 'partnerDetailModal';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 700px;">
                    <div class="modal-header">
                        <h3 class="modal-title">å¾€æ¥å•ä½è¯¦æƒ…</h3>
                        <button class="modal-close" onclick="this.closest('.modal').remove()">Ã—</button>
                    </div>
                    <div class="modal-body">
                        ${detailContent}
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-primary" onclick="this.closest('.modal').remove()">å…³é—­</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            modal.classList.add('show');
        }

        // åˆå§‹åŒ–
        init();
    </script>
</body>
</html>
