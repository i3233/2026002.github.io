<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰¹å‘è®¢å• - 2026æ–°é¡¹ç›®äºŒ</title>
    <link rel="stylesheet" href="../../css/Main.css">
    <style>
        .wholesale-order-page {
            padding: var(--spacing-lg);
            background-color: var(--color-neutral-50);
        }

        /* é¡µé¢æ ‡é¢˜ */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-lg);
            padding: var(--spacing-lg);
            background-color: #ffffff;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-card);
        }

        .page-title {
            font-size: var(--font-size-2xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-text-primary);
            margin: 0;
        }

        .page-subtitle {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            margin-top: var(--spacing-xs);
        }

        /* æ‰“å°æœºé…ç½®åŒºåŸŸ */
        .printer-config-section {
            background-color: #ffffff;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-card);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
        }

        .printer-config-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--spacing-md);
            padding-bottom: var(--spacing-md);
            border-bottom: 1px solid var(--color-neutral-200);
        }

        .printer-config-title {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-bold);
            color: var(--color-text-primary);
        }

        .printer-select-wrapper {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            flex-wrap: wrap;
        }

        .printer-select-label {
            font-size: var(--font-size-base);
            font-weight: var(--font-weight-medium);
            color: var(--color-text-primary);
            white-space: nowrap;
        }

        .printer-select {
            min-width: 200px;
            padding: var(--spacing-sm) var(--spacing-md);
            border: 1px solid var(--color-neutral-300);
            border-radius: var(--radius-md);
            font-size: var(--font-size-base);
            background-color: #ffffff;
            cursor: pointer;
            transition: all var(--transition-base) var(--ease-in-out);
        }

        .printer-select:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: var(--shadow-input-focus);
        }

        .printer-info {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            padding: var(--spacing-md);
            background-color: var(--color-neutral-50);
            border-radius: var(--radius-md);
            margin-top: var(--spacing-md);
        }

        .printer-info-item {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xs);
        }

        .printer-info-label {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
        }

        .printer-info-value {
            font-size: var(--font-size-base);
            font-weight: var(--font-weight-medium);
            color: var(--color-text-primary);
        }

        /* é¡¶éƒ¨å·¥å…·æ  */
        .toolbar-card {
            background-color: #ffffff;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-card);
            padding: var(--spacing-md) var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: var(--spacing-md);
        }

        .toolbar-left,
        .toolbar-center,
        .toolbar-right {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .toolbar-left {
            flex: 1.6;
            flex-wrap: wrap;
        }

        .toolbar-center {
            flex: 1;
            justify-content: center;
        }

        .toolbar-right {
            flex: 1;
            justify-content: flex-end;
            flex-wrap: wrap;
        }

        .toolbar-search-input {
            flex: 1;
            min-width: 220px;
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-md);
            border: 1px solid var(--color-neutral-300);
            font-size: var(--font-size-base);
            transition: all var(--transition-base) var(--ease-in-out);
        }

        .toolbar-search-input:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: var(--shadow-input-focus);
        }

        .btn-icon-text {
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .btn-icon-text-symbol {
            font-size: 14px;
        }

        /* ç»Ÿè®¡å¡ç‰‡ */
        .summary-row {
            display: flex;
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
            flex-wrap: wrap;
        }

        .summary-card {
            flex: 1;
            min-width: 220px;
            background-color: #ffffff;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-card);
            padding: var(--spacing-md) var(--spacing-lg);
        }

        .summary-label {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            margin-bottom: var(--spacing-xs);
        }

        .summary-value {
            font-size: var(--font-size-2xl);
            font-weight: var(--font-weight-bold);
            display: flex;
            align-items: baseline;
            gap: var(--spacing-xs);
        }

        .summary-value-blue {
            color: var(--color-primary);
        }

        .summary-value-green {
            color: var(--color-success);
        }

        .summary-value-red {
            color: var(--color-error);
        }

        /* è®¢å•çŠ¶æ€ Tab */
        .order-tabs {
            display: flex;
            gap: var(--spacing-xs);
            margin-bottom: var(--spacing-md);
        }

        .order-tab-btn {
            padding: var(--spacing-xs) var(--spacing-md);
            border-radius: var(--radius-full);
            border: none;
            background-color: transparent;
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            cursor: pointer;
            transition: all var(--transition-base) var(--ease-in-out);
        }

        .order-tab-btn:hover {
            background-color: var(--color-neutral-100);
            color: var(--color-text-primary);
        }

        .order-tab-btn.active {
            background-color: rgba(44, 131, 235, 0.1);
            color: var(--color-primary);
            font-weight: var(--font-weight-medium);
        }

        /* è¡¨æ ¼å®¹å™¨ */
        .table-container {
            background-color: #ffffff;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-card);
            overflow: hidden;
        }

        .table-wrapper {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background-color: var(--color-neutral-50);
        }

        th, td {
            padding: var(--spacing-sm) var(--spacing-md);
            font-size: var(--font-size-sm);
            border-bottom: 1px solid var(--color-neutral-200);
            white-space: nowrap;
        }

        th {
            text-align: left;
            font-weight: var(--font-weight-medium);
            color: var(--color-text-primary);
        }

        th.sortable {
            cursor: pointer;
            user-select: none;
            position: relative;
            padding-right: var(--spacing-xl);
        }

        th.sortable::after {
            content: 'â†•';
            position: absolute;
            right: var(--spacing-sm);
            color: var(--color-neutral-400);
            font-size: var(--font-size-xs);
        }

        th.sortable.asc::after {
            content: 'â†‘';
            color: var(--color-primary);
        }

        th.sortable.desc::after {
            content: 'â†“';
            color: var(--color-primary);
        }

        tbody tr:hover {
            background-color: var(--color-neutral-50);
        }

        tbody tr:last-child td {
            border-bottom: none;
        }

        .checkbox-cell {
            width: 48px;
            text-align: center;
        }

        .checkbox-cell input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .link-text {
            color: var(--color-primary);
            cursor: pointer;
        }

        .link-text:hover {
            text-decoration: underline;
        }

        .status-pill {
            font-size: var(--font-size-xs);
            cursor: pointer;
            padding: 2px 8px;
            border-radius: var(--radius-sm);
        }

        .status-pill--success {
            background-color: rgba(40, 167, 69, 0.1);
            color: var(--color-success);
        }

        .status-pill--primary {
            background-color: rgba(44, 131, 235, 0.1);
            color: var(--color-primary);
        }

        .status-pill--warning {
            background-color: rgba(255, 193, 7, 0.1);
            color: var(--color-warning);
        }

        .status-pill--error {
            background-color: rgba(220, 53, 69, 0.1);
            color: var(--color-error);
        }

        .btn-link {
            color: var(--color-primary);
            background-color: transparent;
            border: none;
            padding: 0;
            cursor: pointer;
            font-size: var(--font-size-sm);
            margin-right: var(--spacing-sm);
        }

        .btn-link:hover {
            text-decoration: underline;
        }

        .btn-link.danger {
            color: var(--color-error);
        }

        .text-right {
            text-align: right;
        }

        .text-secondary {
            color: var(--color-text-secondary);
        }

        /* åˆè®¡è¡Œ */
        .table-footer-row {
            background-color: var(--color-neutral-50);
            font-weight: var(--font-weight-medium);
        }

        /* åº•éƒ¨å·¥å…·æ  */
        .bottom-toolbar {
            margin-top: var(--spacing-md);
            padding: var(--spacing-md) var(--spacing-lg);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: var(--spacing-md);
            background-color: #ffffff;
            border-radius: 0 0 var(--radius-lg) var(--radius-lg);
            border-top: 1px solid var(--color-neutral-200);
        }

        .bottom-left,
        .bottom-right {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            flex-wrap: wrap;
        }

        .bottom-left label {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-xs);
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
        }

        /* åˆ†é¡µæ§ä»¶ */
        .page-size-select {
            padding: 2px 8px;
            border-radius: var(--radius-md);
            border: 1px solid var(--color-neutral-300);
            font-size: var(--font-size-xs);
        }

        .pagination-info {
            font-size: var(--font-size-xs);
            color: var(--color-text-secondary);
        }

        .pagination-pages {
            display: inline-flex;
            align-items: center;
            gap: 2px;
        }

        .pagination-page-btn {
            min-width: 24px;
            padding: 2px 6px;
            border-radius: var(--radius-md);
            border: 1px solid var(--color-neutral-300);
            background-color: #ffffff;
            font-size: var(--font-size-xs);
            cursor: pointer;
            transition: all var(--transition-base) var(--ease-in-out);
        }

        .pagination-page-btn.active {
            background-color: var(--color-primary);
            color: #ffffff;
            border-color: var(--color-primary);
        }

        .pagination-page-btn:hover:not(.active) {
            border-color: var(--color-primary);
            color: var(--color-primary);
        }

        .pagination-jump-input {
            width: 40px;
            padding: 2px 4px;
            border-radius: var(--radius-md);
            border: 1px solid var(--color-neutral-300);
            font-size: var(--font-size-xs);
            text-align: center;
        }

        /* è®¢å•æ¥æºæ ‡ç­¾ */
        .order-source-tag {
            display: inline-block;
            padding: 2px 6px;
            border-radius: var(--radius-sm);
            font-size: var(--font-size-xs);
            font-weight: var(--font-weight-medium);
        }

        .order-source-tag.online-paid {
            background-color: rgba(40, 167, 69, 0.1);
            color: var(--color-success);
        }

        .order-source-tag.online-credit {
            background-color: rgba(255, 193, 7, 0.1);
            color: var(--color-warning);
        }

        .order-source-tag.manual {
            background-color: rgba(44, 131, 235, 0.1);
            color: var(--color-primary);
        }

        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal {
            background-color: #ffffff;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: var(--spacing-lg);
            border-bottom: 1px solid var(--color-neutral-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-bold);
            color: var(--color-text-primary);
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: var(--font-size-xl);
            color: var(--color-text-secondary);
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-md);
            transition: all var(--transition-base) var(--ease-in-out);
        }

        .modal-close:hover {
            background-color: var(--color-neutral-100);
            color: var(--color-text-primary);
        }

        .modal-body {
            padding: var(--spacing-lg);
        }

        .modal-footer {
            padding: var(--spacing-lg);
            border-top: 1px solid var(--color-neutral-200);
            display: flex;
            justify-content: flex-end;
            gap: var(--spacing-sm);
        }

        .form-group {
            margin-bottom: var(--spacing-md);
        }

        .form-label {
            display: block;
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            color: var(--color-text-primary);
            margin-bottom: var(--spacing-xs);
        }

        .form-input,
        .form-select {
            width: 100%;
            padding: var(--spacing-sm) var(--spacing-md);
            border: 1px solid var(--color-neutral-300);
            border-radius: var(--radius-md);
            font-size: var(--font-size-base);
            transition: all var(--transition-base) var(--ease-in-out);
        }

        .form-input:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: var(--shadow-input-focus);
        }

        @media (max-width: 1200px) {
            .toolbar-card {
                flex-direction: column;
                align-items: stretch;
            }

            .toolbar-left,
            .toolbar-center,
            .toolbar-right {
                justify-content: flex-start;
            }

            .page-header {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--spacing-xs);
            }

            .bottom-toolbar {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="wholesale-order-page">
        <!-- é¡µé¢æ ‡é¢˜ -->
        <div class="page-header">
            <div>
                <h1 class="page-title">æ‰¹å‘è®¢å•</h1>
                <div class="page-subtitle">ç®¡ç†æ‰¹å‘è®¢å•ï¼Œæ”¯æŒå•†å®¶è‡ªåŠ©ä¸‹å•å’Œéƒ¨é—¨ä»£ä¸‹å•</div>
            </div>
        </div>

        <!-- æ‰“å°æœºé…ç½®åŒºåŸŸ -->
        <div class="printer-config-section">
            <div class="printer-config-header">
                <h2 class="printer-config-title">æ‰“å°æœºé…ç½®</h2>
            </div>
            
            <div class="printer-select-wrapper">
                <label class="printer-select-label">é€‰æ‹©æ‰“å°æœºï¼š</label>
                <select class="printer-select" id="printerSelect">
                    <option value="">è¯·é€‰æ‹©æ‰“å°æœº</option>
                    <!-- é€‰é¡¹ç”±JSåŠ¨æ€ç”Ÿæˆ -->
                </select>
                <button class="btn btn-primary" id="bindPrinterBtn">ç»‘å®š</button>
                <button class="btn btn-outline" id="unbindPrinterBtn" style="display: none;">è§£ç»‘</button>
                <button class="btn btn-outline" id="testPrintBtn" style="display: none;">æµ‹è¯•æ‰“å°</button>
            </div>

            <!-- æ‰“å°æœºä¿¡æ¯ï¼ˆç»‘å®šåæ˜¾ç¤ºï¼‰ -->
            <div id="printerInfo" class="printer-info hidden">
                <div class="printer-info-item">
                    <span class="printer-info-label">æ‰“å°æœºåç§°</span>
                    <span class="printer-info-value" id="printerNameDisplay">-</span>
                </div>
                <div class="printer-info-item">
                    <span class="printer-info-label">æ‰“å°æœºå‹å·</span>
                    <span class="printer-info-value" id="printerModelDisplay">-</span>
                </div>
                <div class="printer-info-item">
                    <span class="printer-info-label">è¿æ¥æ–¹å¼</span>
                    <span class="printer-info-value" id="printerConnectionDisplay">-</span>
                </div>
                <div class="printer-info-item">
                    <span class="printer-info-label">ç»‘å®šæ—¶é—´</span>
                    <span class="printer-info-value" id="printerBindTimeDisplay">-</span>
                </div>
            </div>
        </div>

        <!-- é¡¶éƒ¨å·¥å…·æ  -->
        <div class="toolbar-card">
            <!-- å·¦ä¾§æŒ‰é’®ç»„ -->
            <div class="toolbar-left">
                <button class="btn btn-primary" id="addOrderBtn">
                    <span class="btn-icon-text">
                        <span class="btn-icon-text-symbol">ï¼‹</span>
                        <span>æ–°å¢è®¢å•</span>
                    </span>
                </button>
                <button class="btn btn-outline" id="batchAuditBtn">
                    <span class="btn-icon-text">
                        <span class="btn-icon-text-symbol">âœ“</span>
                        <span>æ‰¹é‡å®¡æ ¸</span>
                    </span>
                </button>
                <button class="btn btn-outline" id="batchPrintBtn">
                    <span class="btn-icon-text">
                        <span class="btn-icon-text-symbol">ğŸ–¨</span>
                        <span>æ‰¹é‡æ‰“å°</span>
                    </span>
                </button>
                <button class="btn btn-outline">
                    <span class="btn-icon-text">
                        <span class="btn-icon-text-symbol">â†‘</span>
                        <span>å¯¼å‡º</span>
                    </span>
                </button>
            </div>

            <!-- ä¸­é—´æœç´¢åŒº -->
            <div class="toolbar-center">
                <input type="text" 
                       class="toolbar-search-input" 
                       id="quickSearchInput" 
                       placeholder="å¿«æ·æœç´¢ï¼šæ”¯æŒæŒ‰è®¢å•å·ã€å¾€æ¥å•ä½ã€å•†å®¶åç§°ç­‰å…³é”®å­—">
                <button class="btn btn-primary" id="quickSearchBtn">æœç´¢</button>
            </div>

            <!-- å³ä¾§åŠŸèƒ½ -->
            <div class="toolbar-right">
                <button class="btn btn-outline" id="moreSearchBtn">æ›´å¤šæœç´¢</button>
                <button class="btn btn-outline">
                    <span class="btn-icon-text">
                        <span class="btn-icon-text-symbol">âŠ™</span>
                        <span>ç»Ÿè®¡</span>
                    </span>
                </button>
            </div>
        </div>

        <!-- è®¢å•çŠ¶æ€ Tab -->
        <div class="order-tabs">
            <button class="order-tab-btn active" data-status="all">å…¨éƒ¨</button>
            <button class="order-tab-btn" data-status="pendingAudit">å¾…å®¡æ ¸</button>
            <button class="order-tab-btn" data-status="pendingPrint">å¾…æ‰“å°</button>
            <button class="order-tab-btn" data-status="picking">æ‹£è´§ä¸­</button>
            <button class="order-tab-btn" data-status="pendingOutbound">å¾…å‡ºåº“</button>
            <button class="order-tab-btn" data-status="completed">å·²å®Œæˆ</button>
        </div>

        <!-- ç»Ÿè®¡å¡ç‰‡ -->
        <div class="summary-row">
            <div class="summary-card">
                <div class="summary-label">è®¢å•æ€»é¢ (å…ƒ)</div>
                <div class="summary-value summary-value-blue">
                    <span id="summaryTotalAmount">0.00</span>
                </div>
            </div>
            <div class="summary-card">
                <div class="summary-label">å¾…å®¡æ ¸è®¢å•</div>
                <div class="summary-value summary-value-red">
                    <span id="summaryPendingAuditCount">0</span>
                </div>
            </div>
            <div class="summary-card">
                <div class="summary-label">å·²å®Œæˆè®¢å•</div>
                <div class="summary-value summary-value-green">
                    <span id="summaryCompletedCount">0</span>
                </div>
            </div>
        </div>

        <!-- æ•°æ®è¡¨æ ¼ -->
        <div class="table-container">
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th class="checkbox-cell">
                                <input type="checkbox" id="selectAll">
                            </th>
                            <th>âŠ™ è®¢å•å·</th>
                            <th class="sortable" data-sort="orderTime">ä¸‹å•æ—¶é—´</th>
                            <th>è®¢å•æ¥æº</th>
                            <th>å¾€æ¥å•ä½/å•†å®¶</th>
                            <th>è”ç³»äºº</th>
                            <th>æ‰‹æœºå·</th>
                            <th class="text-right">å•†å“æ•°é‡</th>
                            <th class="text-right">è®¢å•é‡‘é¢</th>
                            <th class="text-right">å®ä»˜é‡‘é¢</th>
                            <th>æ”¯ä»˜æ–¹å¼</th>
                            <th>è®¢å•çŠ¶æ€</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="orderTableBody">
                        <!-- JS æ¸²æŸ“ -->
                    </tbody>
                    <tfoot>
                        <tr class="table-footer-row">
                            <td colspan="7" class="text-right">åˆè®¡ï¼š</td>
                            <td class="text-right" id="totalQtyCell">0</td>
                            <td class="text-right" id="totalAmountCell">0.00</td>
                            <td class="text-right" id="totalPaidCell">0.00</td>
                            <td colspan="3"></td>
                        </tr>
                    </tfoot>
                </table>
            </div>

            <!-- åº•éƒ¨å·¥å…·æ  -->
            <div class="bottom-toolbar">
                <!-- å·¦ä¾§æ‰¹é‡æ“ä½œ -->
                <div class="bottom-left">
                    <label>
                        <input type="checkbox" id="bottomSelectAll">
                        <span>å…¨é€‰</span>
                    </label>
                    <button class="btn btn-outline" id="batchExportBtn">æ‰¹é‡å¯¼å‡º</button>
                    <span class="text-secondary" id="selectedInfo">å·²é€‰æ‹© 0 æ¡è®°å½•</span>
                </div>

                <!-- å³ä¾§åˆ†é¡µ -->
                <div class="bottom-right">
                    <select class="page-size-select" id="pageSizeSelect">
                        <option value="20" selected>20 æ¡/é¡µ</option>
                        <option value="50">50 æ¡/é¡µ</option>
                        <option value="100">100 æ¡/é¡µ</option>
                    </select>
                    <span class="pagination-info">å…± <span id="totalRecords">0</span> æ¡è®°å½•</span>
                    <div class="pagination-pages" id="paginationPages">
                        <!-- åˆ†é¡µæŒ‰é’®ç”±JSç”Ÿæˆ -->
                    </div>
                    <span class="pagination-info">è·³è½¬åˆ°</span>
                    <input type="number" class="pagination-jump-input" min="1" value="1" id="jumpToPage">
                    <span class="pagination-info">é¡µ</span>
                </div>
            </div>
        </div>
    </div>

    <!-- æ–°å¢è®¢å•æ¨¡æ€æ¡† -->
    <div class="modal-overlay" id="addOrderModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">æ–°å¢æ‰¹å‘è®¢å•</h3>
                <button class="modal-close" id="closeAddOrderModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">å¾€æ¥å•ä½ *</label>
                    <select class="form-select" id="partnerSelect">
                        <option value="">è¯·é€‰æ‹©å¾€æ¥å•ä½</option>
                        <!-- é€‰é¡¹ç”±JSåŠ¨æ€ç”Ÿæˆ -->
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">è”ç³»äºº</label>
                    <input type="text" class="form-input" id="contactNameInput" placeholder="è¯·è¾“å…¥è”ç³»äººå§“å">
                </div>
                <div class="form-group">
                    <label class="form-label">æ‰‹æœºå·</label>
                    <input type="text" class="form-input" id="contactMobileInput" placeholder="è¯·è¾“å…¥æ‰‹æœºå·">
                </div>
                <div class="form-group">
                    <label class="form-label">æ”¯ä»˜æ–¹å¼ *</label>
                    <select class="form-select" id="payTypeSelect">
                        <option value="credit">èµŠè´¦</option>
                        <option value="cash">ç°é‡‘</option>
                        <option value="transfer">è½¬è´¦</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">è®¢å•æ¥æº</label>
                    <select class="form-select" id="orderSourceSelect">
                        <option value="manual" selected>éƒ¨é—¨ä»£ä¸‹å•</option>
                        <option value="online-paid">å•†å®¶è‡ªåŠ©(å®ä»˜)</option>
                        <option value="online-credit">å•†å®¶è‡ªåŠ©(èµŠè´¦)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">å•†å“æ€»æ•°é‡ï¼ˆä»¶ï¼‰</label>
                    <input type="number" class="form-input" id="totalQtyInput" min="0" step="1" placeholder="è¯·è¾“å…¥æœ¬æ¬¡æ‰¹å‘çš„æ€»ä»¶æ•°ï¼Œä¾‹å¦‚ï¼š50">
                </div>
                <div class="form-group">
                    <label class="form-label">è®¢å•é‡‘é¢ï¼ˆå…ƒï¼‰</label>
                    <input type="number" class="form-input" id="totalAmountInput" min="0" step="0.01" placeholder="è¯·è¾“å…¥æ•´å•é‡‘é¢ï¼Œä¾‹å¦‚ï¼š5000.00">
                </div>
                <div class="form-group">
                    <label class="form-label">æœ¬æ¬¡æ”¶æ¬¾é‡‘é¢ï¼ˆå…ƒï¼‰</label>
                    <input type="number" class="form-input" id="paidAmountInput" min="0" step="0.01" placeholder="å¯ä¸ºç©ºï¼Œé»˜è®¤è§†ä¸ºæœªæ”¶æ¬¾">
                </div>
                <div class="form-group">
                    <label class="form-label">æ˜¯å¦ç›´æ¥å®¡æ ¸é€šè¿‡</label>
                    <label style="font-size: var(--font-size-sm); color: var(--color-text-secondary); display: flex; align-items: center; gap: 6px;">
                        <input type="checkbox" id="autoAuditCheckbox">
                        <span>é€‰ä¸­åä¿å­˜å³è§†ä¸ºè´¢åŠ¡å·²å®¡æ ¸ï¼Œè®¢å•ç›´æ¥è¿›å…¥å¾…æ‰“å°/æ‹£è´§æµç¨‹ï¼ˆç¤ºä¾‹æµç¨‹ï¼‰ã€‚</span>
                    </label>
                </div>
                <div class="form-group">
                    <label class="form-label">å¤‡æ³¨</label>
                    <textarea class="form-input" id="remarkInput" rows="3" placeholder="è¯·è¾“å…¥å¤‡æ³¨ä¿¡æ¯"></textarea>
                </div>
                <div class="alert-info">
                    <strong>æç¤ºï¼š</strong>é»˜è®¤åˆ›å»ºçš„è®¢å•ä¼šè¿›å…¥â€œå¾…å®¡æ ¸â€æˆ–â€œå¾…æ‰“å°â€çŠ¶æ€ï¼Œä»…ä¸ºç¤ºä¾‹æµç¨‹ï¼Œåç»­å¯ä¸æ‰¹å‘å®¡æ ¸ä¸­å¿ƒã€æ‹£è´§/å‡ºåº“é¡µé¢åšè”åŠ¨ã€‚
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelAddOrderBtn">å–æ¶ˆ</button>
                <button class="btn btn-primary" id="confirmAddOrderBtn">åˆ›å»ºè®¢å•</button>
            </div>
        </div>
    </div>

    <script>
        // æ¨¡æ‹Ÿæ‰“å°æœºæ•°æ®
        const printers = [
            { id: 'PR001', name: '1å·æ‰“å°æœº', model: 'HP LaserJet Pro', connection: 'USB', status: 'online' },
            { id: 'PR002', name: '2å·æ‰“å°æœº', model: 'Canon PIXMA', connection: 'ç½‘ç»œ', status: 'online' },
            { id: 'PR003', name: '3å·æ‰“å°æœº', model: 'Epson LQ', connection: 'USB', status: 'offline' }
        ];

        // æ¨¡æ‹Ÿå¾€æ¥å•ä½æ•°æ®
        const partners = [
            { id: 'PT001', name: 'é›…å®‰æ‰¹å‘å•†A', contact: 'å¼ è€æ¿', mobile: '13800000001' },
            { id: 'PT002', name: 'æˆéƒ½æ‰¹å‘å•†B', contact: 'æç»ç†', mobile: '13800000002' },
            { id: 'PT003', name: 'ä¹å±±æ‰¹å‘å•†C', contact: 'ç‹æ€»', mobile: '13800000003' },
            { id: 'PT004', name: 'ç»µé˜³æ‰¹å‘å•†D', contact: 'èµµç»ç†', mobile: '13800000004' }
        ];

        // æ¨¡æ‹Ÿæ‰¹å‘è®¢å•æ•°æ®
        const wholesaleOrders = [
            {
                id: 'PF20250826001',
                orderTime: '2025-08-26 09:12:30',
                source: 'online-paid', // å•†å®¶è‡ªåŠ©çº¿ä¸Šä¸‹å•-å®ä»˜æ¬¾
                sourceText: 'å•†å®¶è‡ªåŠ©(å®ä»˜)',
                partner: 'é›…å®‰æ‰¹å‘å•†A',
                contact: 'å¼ è€æ¿',
                mobile: '13800000001',
                qty: 50,
                amount: 5000.00,
                paid: 5000.00,
                payType: 'è½¬è´¦',
                status: 'pendingPrint', // å¾…æ‰“å°
                auditStatus: 'approved',
                auditTime: '2025-08-26 09:13:00',
                printTime: null,
                pickingStatus: 'pending',
                outboundStatus: 'pending',
                completedTime: null
            },
            {
                id: 'PF20250826002',
                orderTime: '2025-08-26 10:05:11',
                source: 'online-credit', // å•†å®¶è‡ªåŠ©çº¿ä¸Šä¸‹å•-èµŠè´¦
                sourceText: 'å•†å®¶è‡ªåŠ©(èµŠè´¦)',
                partner: 'æˆéƒ½æ‰¹å‘å•†B',
                contact: 'æç»ç†',
                mobile: '13800000002',
                qty: 30,
                amount: 3000.00,
                paid: 0.00,
                payType: 'èµŠè´¦',
                status: 'pendingAudit', // å¾…å®¡æ ¸
                auditStatus: 'pending',
                auditTime: null,
                printTime: null,
                pickingStatus: 'pending',
                outboundStatus: 'pending',
                completedTime: null
            },
            {
                id: 'PF20250826003',
                orderTime: '2025-08-26 11:20:45',
                source: 'manual', // æ‰¹å‘éƒ¨é—¨ä»£ä¸‹å•
                sourceText: 'éƒ¨é—¨ä»£ä¸‹å•',
                partner: 'ä¹å±±æ‰¹å‘å•†C',
                contact: 'ç‹æ€»',
                mobile: '13800000003',
                qty: 40,
                amount: 4000.00,
                paid: 0.00,
                payType: 'èµŠè´¦',
                status: 'pendingAudit', // å¾…å®¡æ ¸
                auditStatus: 'pending',
                auditTime: null,
                printTime: null,
                pickingStatus: 'pending',
                outboundStatus: 'pending',
                completedTime: null
            },
            {
                id: 'PF20250827001',
                orderTime: '2025-08-27 09:03:10',
                source: 'online-paid',
                sourceText: 'å•†å®¶è‡ªåŠ©(å®ä»˜)',
                partner: 'ç»µé˜³æ‰¹å‘å•†D',
                contact: 'èµµç»ç†',
                mobile: '13800000004',
                qty: 25,
                amount: 2500.00,
                paid: 2500.00,
                payType: 'è½¬è´¦',
                status: 'picking', // æ‹£è´§ä¸­
                auditStatus: 'approved',
                auditTime: '2025-08-27 09:04:00',
                printTime: '2025-08-27 09:05:00',
                pickingStatus: 'picking',
                outboundStatus: 'pending',
                completedTime: null
            },
            {
                id: 'PF20250827002',
                orderTime: '2025-08-27 14:18:22',
                source: 'manual',
                sourceText: 'éƒ¨é—¨ä»£ä¸‹å•',
                partner: 'é›…å®‰æ‰¹å‘å•†A',
                contact: 'å¼ è€æ¿',
                mobile: '13800000001',
                qty: 35,
                amount: 3500.00,
                paid: 0.00,
                payType: 'èµŠè´¦',
                status: 'pendingOutbound', // å¾…å‡ºåº“
                auditStatus: 'approved',
                auditTime: '2025-08-27 14:20:00',
                printTime: '2025-08-27 14:21:00',
                pickingStatus: 'completed',
                outboundStatus: 'pending',
                completedTime: null
            },
            {
                id: 'PF20250828001',
                orderTime: '2025-08-28 10:45:33',
                source: 'online-credit',
                sourceText: 'å•†å®¶è‡ªåŠ©(èµŠè´¦)',
                partner: 'æˆéƒ½æ‰¹å‘å•†B',
                contact: 'æç»ç†',
                mobile: '13800000002',
                qty: 20,
                amount: 2000.00,
                paid: 0.00,
                payType: 'èµŠè´¦',
                status: 'completed', // å·²å®Œæˆ
                auditStatus: 'approved',
                auditTime: '2025-08-28 10:46:00',
                printTime: '2025-08-28 10:47:00',
                pickingStatus: 'completed',
                outboundStatus: 'completed',
                completedTime: '2025-08-28 11:00:00'
            }
        ];

        // å½“å‰çŠ¶æ€
        let currentPrinter = null;
        let filteredOrders = [...wholesaleOrders];
        let currentStatus = 'all';
        let sortColumn = null;
        let sortDirection = 'asc';

        // åˆå§‹åŒ–æ‰“å°æœºé€‰æ‹©å™¨
        function initPrinterSelect() {
            const select = document.getElementById('printerSelect');
            select.innerHTML = '<option value="">è¯·é€‰æ‹©æ‰“å°æœº</option>';
            printers.forEach(printer => {
                const option = document.createElement('option');
                option.value = printer.id;
                option.textContent = `${printer.name} (${printer.model})`;
                option.dataset.printer = JSON.stringify(printer);
                select.appendChild(option);
            });
        }

        // ç»‘å®šæ‰“å°æœº
        function bindPrinter() {
            const select = document.getElementById('printerSelect');
            const printerId = select.value;
            
            if (!printerId) {
                alert('è¯·é€‰æ‹©æ‰“å°æœº');
                return;
            }

            const option = select.options[select.selectedIndex];
            currentPrinter = JSON.parse(option.dataset.printer);
            currentPrinter.bindTime = new Date().toLocaleString('zh-CN');

            // æ˜¾ç¤ºæ‰“å°æœºä¿¡æ¯
            document.getElementById('printerNameDisplay').textContent = currentPrinter.name;
            document.getElementById('printerModelDisplay').textContent = currentPrinter.model;
            document.getElementById('printerConnectionDisplay').textContent = currentPrinter.connection;
            document.getElementById('printerBindTimeDisplay').textContent = currentPrinter.bindTime;
            document.getElementById('printerInfo').classList.remove('hidden');
            document.getElementById('unbindPrinterBtn').style.display = 'inline-block';
            document.getElementById('testPrintBtn').style.display = 'inline-block';
        }

        // è§£ç»‘æ‰“å°æœº
        function unbindPrinter() {
            if (!confirm('ç¡®å®šè¦è§£ç»‘å½“å‰æ‰“å°æœºå—ï¼Ÿ')) {
                return;
            }

            currentPrinter = null;
            document.getElementById('printerSelect').value = '';
            document.getElementById('printerInfo').classList.add('hidden');
            document.getElementById('unbindPrinterBtn').style.display = 'none';
            document.getElementById('testPrintBtn').style.display = 'none';
        }

        // æµ‹è¯•æ‰“å°
        function testPrint() {
            if (!currentPrinter) {
                alert('è¯·å…ˆç»‘å®šæ‰“å°æœº');
                return;
            }

            alert(`æµ‹è¯•æ‰“å°ï¼ˆç¤ºä¾‹ï¼‰\næ‰“å°æœºï¼š${currentPrinter.name}\næ­£åœ¨æ‰“å°æµ‹è¯•é¡µ...`);
        }

        // åˆå§‹åŒ–å¾€æ¥å•ä½é€‰æ‹©å™¨
        function initPartnerSelect() {
            const select = document.getElementById('partnerSelect');
            select.innerHTML = '<option value="">è¯·é€‰æ‹©å¾€æ¥å•ä½</option>';
            partners.forEach(partner => {
                const option = document.createElement('option');
                option.value = partner.id;
                option.textContent = partner.name;
                option.dataset.partner = JSON.stringify(partner);
                select.appendChild(option);
            });
        }

        // æ–°å¢è®¢å•
        function addOrder() {
            document.getElementById('addOrderModal').classList.add('show');
        }

        // ç¡®è®¤æ–°å¢è®¢å•
        function confirmAddOrder() {
            const partnerId = document.getElementById('partnerSelect').value;
            const payType = document.getElementById('payTypeSelect').value;
            const contactName = document.getElementById('contactNameInput').value;
            const contactMobile = document.getElementById('contactMobileInput').value;
            const orderSource = document.getElementById('orderSourceSelect').value || 'manual';
            const totalQty = parseInt(document.getElementById('totalQtyInput').value, 10) || 0;
            const totalAmount = parseFloat(document.getElementById('totalAmountInput').value) || 0;
            const paidAmount = parseFloat(document.getElementById('paidAmountInput').value) || 0;
            const autoAudit = document.getElementById('autoAuditCheckbox').checked;
            const remark = document.getElementById('remarkInput').value;

            if (!partnerId) {
                alert('è¯·é€‰æ‹©å¾€æ¥å•ä½');
                return;
            }

            const partnerOption = document.getElementById('partnerSelect').options[document.getElementById('partnerSelect').selectedIndex];
            const partner = JSON.parse(partnerOption.dataset.partner);

            // è®¢å•æ¥æºæ–‡æ¡ˆ
            let sourceText = 'éƒ¨é—¨ä»£ä¸‹å•';
            if (orderSource === 'online-paid') sourceText = 'å•†å®¶è‡ªåŠ©(å®ä»˜)';
            if (orderSource === 'online-credit') sourceText = 'å•†å®¶è‡ªåŠ©(èµŠè´¦)';

            // åˆå§‹çŠ¶æ€å’Œå®¡æ ¸çŠ¶æ€
            let status = 'pendingAudit';
            let auditStatus = 'pending';
            let auditTime = null;

            if (autoAudit) {
                auditStatus = 'approved';
                auditTime = new Date().toLocaleString('zh-CN');
                // å·²å®¡æ ¸åï¼Œå¦‚æœé‡‘é¢>0ï¼Œåˆ™é»˜è®¤ä¸ºå¾…æ‰“å°ï¼›é‡‘é¢ä¸º0åˆ™è§†ä¸ºå¾…æ‹£è´§/å‡ºåº“ç¤ºä¾‹
                status = totalAmount > 0 ? 'pendingPrint' : 'pendingOutbound';
            }

            // åˆ›å»ºæ–°è®¢å•
            const newOrder = {
                id: 'PF' + new Date().getTime(),
                orderTime: new Date().toLocaleString('zh-CN'),
                source: orderSource,
                sourceText: sourceText,
                partner: partner.name,
                contact: contactName || partner.contact,
                mobile: contactMobile || partner.mobile,
                qty: totalQty,
                amount: totalAmount,
                paid: paidAmount,
                payType: payType === 'credit' ? 'èµŠè´¦' : payType === 'cash' ? 'ç°é‡‘' : 'è½¬è´¦',
                status: status,
                auditStatus: auditStatus,
                auditTime: auditTime,
                printTime: null,
                pickingStatus: 'pending',
                outboundStatus: 'pending',
                completedTime: null,
                remark: remark
            };

            wholesaleOrders.unshift(newOrder);
            filterOrders();
            closeAddOrderModal();

            alert('è®¢å•åˆ›å»ºæˆåŠŸï¼è®¢å•éœ€è¦è´¢åŠ¡å®¡æ ¸åæ‰èƒ½æ‰“å°æ‹£è´§å•ã€‚');
        }

        // å…³é—­æ–°å¢è®¢å•æ¨¡æ€æ¡†
        function closeAddOrderModal() {
            document.getElementById('addOrderModal').classList.remove('show');
            document.getElementById('partnerSelect').value = '';
            document.getElementById('contactNameInput').value = '';
            document.getElementById('contactMobileInput').value = '';
            document.getElementById('payTypeSelect').value = 'credit';
            document.getElementById('orderSourceSelect').value = 'manual';
            document.getElementById('totalQtyInput').value = '';
            document.getElementById('totalAmountInput').value = '';
            document.getElementById('paidAmountInput').value = '';
            document.getElementById('autoAuditCheckbox').checked = false;
            document.getElementById('remarkInput').value = '';
        }

        // ç­›é€‰è®¢å•
        function filterOrders() {
            filteredOrders = [...wholesaleOrders];

            // æŒ‰çŠ¶æ€ç­›é€‰
            if (currentStatus !== 'all') {
                filteredOrders = filteredOrders.filter(order => {
                    if (currentStatus === 'pendingAudit') {
                        return order.status === 'pendingAudit';
                    } else if (currentStatus === 'pendingPrint') {
                        return order.status === 'pendingPrint';
                    } else if (currentStatus === 'picking') {
                        return order.status === 'picking';
                    } else if (currentStatus === 'pendingOutbound') {
                        return order.status === 'pendingOutbound';
                    } else if (currentStatus === 'completed') {
                        return order.status === 'completed';
                    }
                });
            }

            // åº”ç”¨æœç´¢
            applySearch();

            // æ›´æ–°ç»Ÿè®¡
            updateSummary();

            // æ¸²æŸ“è¡¨æ ¼
            renderTable();
        }

        // åº”ç”¨æœç´¢
        function applySearch() {
            const keyword = document.getElementById('quickSearchInput').value.trim().toLowerCase();
            if (keyword) {
                filteredOrders = filteredOrders.filter(order => {
                    return (
                        order.id.toLowerCase().includes(keyword) ||
                        order.partner.toLowerCase().includes(keyword) ||
                        order.contact.toLowerCase().includes(keyword) ||
                        order.mobile.toLowerCase().includes(keyword)
                    );
                });
            }
        }

        // æ›´æ–°ç»Ÿè®¡
        function updateSummary() {
            const totalAmount = filteredOrders.reduce((sum, order) => sum + order.amount, 0);
            const pendingAuditCount = filteredOrders.filter(order => order.status === 'pendingAudit').length;
            const completedCount = filteredOrders.filter(order => order.status === 'completed').length;

            document.getElementById('summaryTotalAmount').textContent = totalAmount.toFixed(2);
            document.getElementById('summaryPendingAuditCount').textContent = pendingAuditCount;
            document.getElementById('summaryCompletedCount').textContent = completedCount;
        }

        // æ¸²æŸ“è¡¨æ ¼
        function renderTable() {
            const tbody = document.getElementById('orderTableBody');
            tbody.innerHTML = '';

            if (filteredOrders.length === 0) {
                tbody.innerHTML = '<tr><td colspan="13" style="text-align: center; padding: var(--spacing-lg); color: var(--color-text-secondary);">æš‚æ— è®¢å•æ•°æ®</td></tr>';
                updateTotals();
                return;
            }

            filteredOrders.forEach(order => {
                const statusClass = getStatusClass(order.status);
                const sourceClass = getSourceClass(order.source);

                const tr = document.createElement('tr');
                tr.dataset.id = order.id;
                tr.innerHTML = `
                    <td class="checkbox-cell">
                        <input type="checkbox" class="row-checkbox" data-id="${order.id}">
                    </td>
                    <td>
                        <span class="link-text order-link" data-id="${order.id}">${order.id}</span>
                    </td>
                    <td>${order.orderTime}</td>
                    <td>
                        <span class="order-source-tag ${sourceClass}">${order.sourceText}</span>
                    </td>
                    <td>${order.partner}</td>
                    <td>${order.contact}</td>
                    <td>${order.mobile}</td>
                    <td class="text-right">${order.qty}</td>
                    <td class="text-right">${order.amount.toFixed(2)}</td>
                    <td class="text-right">${order.paid.toFixed(2)}</td>
                    <td>${order.payType}</td>
                    <td>
                        <span class="status-pill ${statusClass}">${getStatusText(order.status)}</span>
                    </td>
                    <td>
                        <button class="btn-link view-btn" data-id="${order.id}">æŸ¥çœ‹</button>
                        ${getActionButtons(order)}
                    </td>
                `;
                tbody.appendChild(tr);
            });

            updateTotals();
            updateSelectedInfo();
            bindTableEvents();
        }

        // è·å–çŠ¶æ€æ ·å¼ç±»
        function getStatusClass(status) {
            const statusMap = {
                'pendingAudit': 'status-pill--warning',
                'pendingPrint': 'status-pill--primary',
                'picking': 'status-pill--primary',
                'pendingOutbound': 'status-pill--warning',
                'completed': 'status-pill--success'
            };
            return statusMap[status] || 'status-pill--primary';
        }

        // è·å–çŠ¶æ€æ–‡æœ¬
        function getStatusText(status) {
            const statusMap = {
                'pendingAudit': 'å¾…å®¡æ ¸',
                'pendingPrint': 'å¾…æ‰“å°',
                'picking': 'æ‹£è´§ä¸­',
                'pendingOutbound': 'å¾…å‡ºåº“',
                'completed': 'å·²å®Œæˆ'
            };
            return statusMap[status] || status;
        }

        // è·å–æ¥æºæ ·å¼ç±»
        function getSourceClass(source) {
            const sourceMap = {
                'online-paid': 'online-paid',
                'online-credit': 'online-credit',
                'manual': 'manual'
            };
            return sourceMap[source] || 'manual';
        }

        // è·å–æ“ä½œæŒ‰é’®
        function getActionButtons(order) {
            let buttons = '';
            
            if (order.status === 'pendingAudit') {
                buttons += `<button class="btn-link audit-btn" data-id="${order.id}">å®¡æ ¸</button>`;
            }
            
            if (order.status === 'pendingPrint' || order.status === 'picking' || order.status === 'pendingOutbound') {
                if (!order.printTime) {
                    buttons += `<button class="btn-link print-btn" data-id="${order.id}">æ‰“å°</button>`;
                }
            }
            
            if (order.status === 'pendingOutbound') {
                buttons += `<button class="btn-link outbound-btn" data-id="${order.id}">å‡ºåº“</button>`;
            }
            
            return buttons;
        }

        // æ›´æ–°åˆè®¡
        function updateTotals() {
            const totalQty = filteredOrders.reduce((sum, order) => sum + order.qty, 0);
            const totalAmount = filteredOrders.reduce((sum, order) => sum + order.amount, 0);
            const totalPaid = filteredOrders.reduce((sum, order) => sum + order.paid, 0);

            document.getElementById('totalQtyCell').textContent = totalQty;
            document.getElementById('totalAmountCell').textContent = totalAmount.toFixed(2);
            document.getElementById('totalPaidCell').textContent = totalPaid.toFixed(2);
        }

        // ç»‘å®šè¡¨æ ¼äº‹ä»¶
        function bindTableEvents() {
            // æŸ¥çœ‹è®¢å•
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const orderId = this.dataset.id;
                    const order = wholesaleOrders.find(o => o.id === orderId);
                    alert(`è®¢å•è¯¦æƒ…ï¼ˆç¤ºä¾‹ï¼‰\nè®¢å•å·ï¼š${order.id}\nå¾€æ¥å•ä½ï¼š${order.partner}\né‡‘é¢ï¼šÂ¥${order.amount.toFixed(2)}\nçŠ¶æ€ï¼š${getStatusText(order.status)}`);
                });
            });

            // å®¡æ ¸è®¢å•
            document.querySelectorAll('.audit-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const orderId = this.dataset.id;
                    auditOrder(orderId);
                });
            });

            // æ‰“å°æ‹£è´§å•
            document.querySelectorAll('.print-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const orderId = this.dataset.id;
                    printPickingList(orderId);
                });
            });

            // å‡ºåº“
            document.querySelectorAll('.outbound-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const orderId = this.dataset.id;
                    doOutbound(orderId);
                });
            });

            // è®¢å•å·ç‚¹å‡»
            document.querySelectorAll('.order-link').forEach(link => {
                link.addEventListener('click', function() {
                    const orderId = this.dataset.id;
                    const order = wholesaleOrders.find(o => o.id === orderId);
                    alert(`è®¢å•è¯¦æƒ…ï¼ˆç¤ºä¾‹ï¼‰\nè®¢å•å·ï¼š${order.id}\nå¾€æ¥å•ä½ï¼š${order.partner}\né‡‘é¢ï¼šÂ¥${order.amount.toFixed(2)}\nçŠ¶æ€ï¼š${getStatusText(order.status)}`);
                });
            });
        }

        // å®¡æ ¸è®¢å•
        function auditOrder(orderId) {
            if (!confirm('ç¡®å®šè¦å®¡æ ¸é€šè¿‡è¯¥è®¢å•å—ï¼Ÿå®¡æ ¸é€šè¿‡åå¯ä»¥æ‰“å°æ‹£è´§å•ã€‚')) {
                return;
            }

            const order = wholesaleOrders.find(o => o.id === orderId);
            if (order) {
                order.auditStatus = 'approved';
                order.auditTime = new Date().toLocaleString('zh-CN');
                
                // æ ¹æ®æ”¯ä»˜æ–¹å¼æ›´æ–°çŠ¶æ€
                if (order.payType === 'èµŠè´¦') {
                    order.status = 'pendingPrint'; // èµŠè´¦éœ€è¦å®¡æ ¸åæ‰“å°
                } else {
                    order.status = 'pendingPrint'; // å®ä»˜æ¬¾ä¹Ÿéœ€è¦æ‰“å°
                }
                
                filterOrders();
                alert('è®¢å•å®¡æ ¸é€šè¿‡ï¼å¯ä»¥æ‰“å°æ‹£è´§å•äº†ã€‚');
            }
        }

        // æ‰“å°æ‹£è´§å•
        function printPickingList(orderId) {
            if (!currentPrinter) {
                alert('è¯·å…ˆç»‘å®šæ‰“å°æœº');
                return;
            }

            const order = wholesaleOrders.find(o => o.id === orderId);
            if (order) {
                if (order.auditStatus !== 'approved') {
                    alert('è®¢å•å°šæœªå®¡æ ¸é€šè¿‡ï¼Œæ— æ³•æ‰“å°æ‹£è´§å•');
                    return;
                }

                order.printTime = new Date().toLocaleString('zh-CN');
                order.status = 'picking'; // æ‰“å°åè¿›å…¥æ‹£è´§ä¸­çŠ¶æ€
                order.pickingStatus = 'picking';
                
                filterOrders();
                alert(`æ­£åœ¨æ‰“å°æ‹£è´§å•ï¼ˆç¤ºä¾‹ï¼‰\nè®¢å•å·ï¼š${order.id}\næ‰“å°æœºï¼š${currentPrinter.name}\næ‰“å°æ—¶é—´ï¼š${order.printTime}`);
            }
        }

        // å‡ºåº“
        function doOutbound(orderId) {
            if (!confirm('ç¡®å®šè¦å¯¹è¯¥è®¢å•æ‰§è¡Œå‡ºåº“æ“ä½œå—ï¼Ÿå‡ºåº“åå°†è‡ªåŠ¨æ›´æ–°åº“å­˜å¹¶å®Œæˆè®¢å•ã€‚')) {
                return;
            }

            const order = wholesaleOrders.find(o => o.id === orderId);
            if (order) {
                if (order.pickingStatus !== 'completed') {
                    alert('è¯·å…ˆå®Œæˆæ‹£è´§åå†å‡ºåº“');
                    return;
                }

                order.outboundStatus = 'completed';
                order.status = 'completed';
                order.completedTime = new Date().toLocaleString('zh-CN');
                
                filterOrders();
                alert(`è®¢å•å‡ºåº“æˆåŠŸï¼è®¢å•å·²å®Œæˆã€‚\nè®¢å•å·ï¼š${order.id}\nå®Œæˆæ—¶é—´ï¼š${order.completedTime}`);
            }
        }

        // æ‰¹é‡å®¡æ ¸
        function batchAudit() {
            const ids = getSelectedIds();
            if (ids.length === 0) {
                alert('è¯·å…ˆé€‰æ‹©è¦å®¡æ ¸çš„è®¢å•');
                return;
            }

            const pendingAuditIds = ids.filter(id => {
                const order = wholesaleOrders.find(o => o.id === id);
                return order && order.status === 'pendingAudit';
            });

            if (pendingAuditIds.length === 0) {
                alert('æ‰€é€‰è®¢å•ä¸­æ²¡æœ‰å¾…å®¡æ ¸çš„è®¢å•');
                return;
            }

            if (!confirm(`ç¡®å®šè¦æ‰¹é‡å®¡æ ¸é€šè¿‡ ${pendingAuditIds.length} ä¸ªè®¢å•å—ï¼Ÿ`)) {
                return;
            }

            pendingAuditIds.forEach(orderId => {
                auditOrder(orderId);
            });
        }

        // æ‰¹é‡æ‰“å°
        function batchPrint() {
            const ids = getSelectedIds();
            if (ids.length === 0) {
                alert('è¯·å…ˆé€‰æ‹©è¦æ‰“å°çš„è®¢å•');
                return;
            }

            if (!currentPrinter) {
                alert('è¯·å…ˆç»‘å®šæ‰“å°æœº');
                return;
            }

            const printableIds = ids.filter(id => {
                const order = wholesaleOrders.find(o => o.id === id);
                return order && (order.status === 'pendingPrint' || order.status === 'picking' || order.status === 'pendingOutbound') && order.auditStatus === 'approved';
            });

            if (printableIds.length === 0) {
                alert('æ‰€é€‰è®¢å•ä¸­æ²¡æœ‰å¯ä»¥æ‰“å°çš„è®¢å•ï¼ˆéœ€è¦å·²å®¡æ ¸é€šè¿‡ï¼‰');
                return;
            }

            if (!confirm(`ç¡®å®šè¦æ‰¹é‡æ‰“å° ${printableIds.length} ä¸ªè®¢å•çš„æ‹£è´§å•å—ï¼Ÿ`)) {
                return;
            }

            printableIds.forEach(orderId => {
                printPickingList(orderId);
            });
        }

        // å…¨é€‰/åé€‰
        function getSelectedIds() {
            const ids = [];
            document.querySelectorAll('.row-checkbox:checked').forEach(cb => {
                ids.push(cb.dataset.id);
            });
            return ids;
        }

        function updateSelectedInfo() {
            const ids = getSelectedIds();
            document.getElementById('selectedInfo').textContent = `å·²é€‰æ‹© ${ids.length} æ¡è®°å½•`;
        }

        function syncSelectAll() {
            const checkboxes = document.querySelectorAll('.row-checkbox');
            const checkedCount = document.querySelectorAll('.row-checkbox:checked').length;
            const allChecked = checkedCount > 0 && checkedCount === checkboxes.length;
            document.getElementById('selectAll').checked = allChecked;
            document.getElementById('bottomSelectAll').checked = allChecked;
            updateSelectedInfo();
        }

        // äº‹ä»¶ç»‘å®š
        document.getElementById('bindPrinterBtn').addEventListener('click', bindPrinter);
        document.getElementById('unbindPrinterBtn').addEventListener('click', unbindPrinter);
        document.getElementById('testPrintBtn').addEventListener('click', testPrint);
        document.getElementById('addOrderBtn').addEventListener('click', addOrder);
        document.getElementById('confirmAddOrderBtn').addEventListener('click', confirmAddOrder);
        document.getElementById('cancelAddOrderBtn').addEventListener('click', closeAddOrderModal);
        document.getElementById('closeAddOrderModal').addEventListener('click', closeAddOrderModal);
        document.getElementById('batchAuditBtn').addEventListener('click', batchAudit);
        document.getElementById('batchPrintBtn').addEventListener('click', batchPrint);
        document.getElementById('quickSearchBtn').addEventListener('click', filterOrders);
        document.getElementById('quickSearchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                filterOrders();
            }
        });

        // Tabåˆ‡æ¢
        document.querySelectorAll('.order-tab-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.order-tab-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                currentStatus = this.dataset.status || 'all';
                filterOrders();
            });
        });

        // å…¨é€‰
        document.getElementById('selectAll').addEventListener('change', function() {
            const checked = this.checked;
            document.querySelectorAll('.row-checkbox').forEach(cb => cb.checked = checked);
            document.getElementById('bottomSelectAll').checked = checked;
            updateSelectedInfo();
        });

        document.getElementById('bottomSelectAll').addEventListener('change', function() {
            const checked = this.checked;
            document.querySelectorAll('.row-checkbox').forEach(cb => cb.checked = checked);
            document.getElementById('selectAll').checked = checked;
            updateSelectedInfo();
        });

        document.addEventListener('change', function(e) {
            if (e.target.classList.contains('row-checkbox')) {
                syncSelectAll();
            }
        });

        // æ›´å¤šæœç´¢
        document.getElementById('moreSearchBtn').addEventListener('click', function() {
            alert('æ›´å¤šæœç´¢ï¼ˆç¤ºä¾‹ï¼‰ï¼šè¿™é‡Œå¯ä»¥å±•å¼€é«˜çº§ç­›é€‰æ¡ä»¶ï¼Œå¦‚ä¸‹å•æ—¶é—´ã€è®¢å•çŠ¶æ€ã€æ”¯ä»˜æ–¹å¼ç­‰ã€‚');
        });

        // å¾€æ¥å•ä½é€‰æ‹©å˜åŒ–æ—¶è‡ªåŠ¨å¡«å……è”ç³»äººä¿¡æ¯
        document.getElementById('partnerSelect').addEventListener('change', function() {
            const option = this.options[this.selectedIndex];
            if (option.value && option.dataset.partner) {
                const partner = JSON.parse(option.dataset.partner);
                document.getElementById('contactNameInput').value = partner.contact;
                document.getElementById('contactMobileInput').value = partner.mobile;
            }
        });

        // åˆå§‹åŒ–
        initPrinterSelect();
        initPartnerSelect();
        filterOrders();
    </script>
</body>
</html>