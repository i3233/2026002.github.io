<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¥—é¤åˆ—è¡¨ - 2026æ–°é¡¹ç›®äºŒ</title>
    <link rel="stylesheet" href="../../css/Main.css">
    <style>
        /* å¥—é¤åˆ—è¡¨é¡µé¢ä¸“ç”¨æ ·å¼ï¼Œæ•´ä½“é£æ ¼å¯¹é½å•†å“åˆ—è¡¨ */
        .package-list-page {
            padding: var(--spacing-lg);
            background-color: var(--color-neutral-50);
        }

        /* é¡µé¢å¤´éƒ¨ */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-lg);
            padding: var(--spacing-lg);
            background-color: #ffffff;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-card);
        }

        .page-title {
            font-size: var(--font-size-2xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-text-primary);
            margin: 0;
        }

        .header-actions {
            display: flex;
            gap: var(--spacing-sm);
        }

        /* Tabæ ‡ç­¾å¯¼èˆª */
        .tabs-nav {
            display: flex;
            gap: var(--spacing-xs);
            margin-bottom: var(--spacing-lg);
            padding: var(--spacing-md);
            background-color: #ffffff;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-card);
        }

        .tab-nav-item {
            padding: var(--spacing-sm) var(--spacing-lg);
            border: none;
            background-color: transparent;
            color: var(--color-text-secondary);
            font-size: var(--font-size-base);
            cursor: pointer;
            border-radius: var(--radius-md);
            transition: all var(--transition-base) var(--ease-in-out);
            position: relative;
        }

        .tab-nav-item:hover {
            background-color: var(--color-neutral-100);
            color: var(--color-text-primary);
        }

        .tab-nav-item.active {
            color: var(--color-primary);
            background-color: rgba(44, 131, 235, 0.1);
            font-weight: var(--font-weight-medium);
        }

        .tab-nav-item.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 60%;
            height: 2px;
            background-color: var(--color-primary);
            border-radius: var(--radius-full);
        }

        /* ç­›é€‰åŒºåŸŸï¼ˆç®€åŒ–ç‰ˆï¼šæ—¶é—´ + æœç´¢ï¼‰ */
        .filter-section {
            padding: var(--spacing-lg);
            background-color: #ffffff;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-card);
            margin-bottom: var(--spacing-lg);
        }

        .filter-row {
            display: flex;
            gap: var(--spacing-md);
            align-items: flex-end;
            flex-wrap: wrap;
        }

        .filter-item {
            flex: 1;
            min-width: 220px;
        }

        .filter-item label {
            display: block;
            margin-bottom: var(--spacing-xs);
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            color: var(--color-text-primary);
        }

        .filter-item input {
            width: 100%;
            padding: var(--spacing-sm) var(--spacing-md);
            border: 1px solid var(--color-neutral-300);
            border-radius: var(--radius-md);
            font-size: var(--font-size-base);
            transition: all var(--transition-base) var(--ease-in-out);
        }

        .filter-item input:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: var(--shadow-input-focus);
        }

        .date-range {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        /* æ‰¹é‡æ“ä½œåŒºåŸŸ */
        .batch-actions {
            display: flex;
            gap: var(--spacing-sm);
            padding: var(--spacing-md);
            background-color: #ffffff;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-card);
            margin-bottom: var(--spacing-lg);
            align-items: center;
        }

        .batch-actions.hidden {
            display: none;
        }

        .selected-count {
            margin-right: var(--spacing-md);
            color: var(--color-text-secondary);
            font-size: var(--font-size-sm);
        }

        /* è¡¨æ ¼å®¹å™¨ */
        .table-container {
            background-color: #ffffff;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-card);
            overflow: hidden;
        }

        .table-wrapper {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background-color: var(--color-neutral-50);
        }

        th {
            padding: var(--spacing-md);
            text-align: left;
            font-weight: var(--font-weight-medium);
            color: var(--color-text-primary);
            font-size: var(--font-size-sm);
            border-bottom: 2px solid var(--color-neutral-200);
            white-space: nowrap;
        }

        th.sortable {
            cursor: pointer;
            user-select: none;
            position: relative;
            padding-right: var(--spacing-xl);
        }

        th.sortable:hover {
            background-color: var(--color-neutral-100);
        }

        th.sortable::after {
            content: 'â†•';
            position: absolute;
            right: var(--spacing-sm);
            color: var(--color-neutral-400);
            font-size: var(--font-size-xs);
        }

        th.sortable.asc::after {
            content: 'â†‘';
            color: var(--color-primary);
        }

        th.sortable.desc::after {
            content: 'â†“';
            color: var(--color-primary);
        }

        td {
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--color-neutral-200);
            font-size: var(--font-size-sm);
            color: var(--color-text-primary);
        }

        tbody tr:hover {
            background-color: var(--color-neutral-50);
        }

        tbody tr:last-child td {
            border-bottom: none;
        }

        /* å¤é€‰æ¡† */
        .checkbox-cell {
            width: 50px;
            text-align: center;
        }

        .checkbox-cell input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        /* å¥—é¤ä¸»å›¾å’Œåç§° */
        .package-info {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .package-image {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: var(--radius-md);
            border: 1px solid var(--color-neutral-200);
        }

        .package-name {
            font-weight: var(--font-weight-medium);
            color: var(--color-text-primary);
            cursor: pointer;
        }

        .package-name:hover {
            color: var(--color-primary);
        }

        /* çŠ¶æ€æ ‡ç­¾ */
        .status-tag {
            display: inline-block;
            padding: var(--spacing-xs) var(--spacing-sm);
            background-color: var(--color-primary);
            color: #ffffff;
            border-radius: var(--radius-sm);
            font-size: var(--font-size-xs);
            font-weight: var(--font-weight-medium);
        }

        .status-tag.offline {
            background-color: var(--color-secondary);
        }

        /* ä»·æ ¼æ˜¾ç¤º */
        .price {
            color: var(--color-error);
            font-weight: var(--font-weight-medium);
        }

        .origin-price {
            text-decoration: line-through;
            color: var(--color-text-secondary);
            margin-left: var(--spacing-xs);
        }

        .save-amount {
            color: var(--color-success);
            font-size: var(--font-size-xs);
            margin-left: var(--spacing-xs);
        }

        /* æ“ä½œæŒ‰é’® */
        .action-buttons {
            display: flex;
            gap: var(--spacing-xs);
        }

        .btn-icon {
            width: 32px;
            height: 32px;
            padding: 0;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border: 1px solid var(--color-neutral-300);
            background-color: transparent;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-base) var(--ease-in-out);
        }

        .btn-icon:hover {
            border-color: var(--color-primary);
            color: var(--color-primary);
        }

        .btn-icon.delete:hover {
            border-color: var(--color-error);
            color: var(--color-error);
        }

        .btn-icon svg {
            width: 16px;
            height: 16px;
        }

        /* åˆ†é¡µ */
        .pagination {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-md) var(--spacing-lg);
            background-color: #ffffff;
            border-top: 1px solid var(--color-neutral-200);
        }

        .pagination-info {
            color: var(--color-text-secondary);
            font-size: var(--font-size-sm);
        }

        .pagination-controls {
            display: flex;
            gap: var(--spacing-xs);
        }

        .pagination-btn {
            padding: var(--spacing-xs) var(--spacing-sm);
            border: 1px solid var(--color-neutral-300);
            background-color: #ffffff;
            border-radius: var(--radius-md);
            cursor: pointer;
            font-size: var(--font-size-sm);
            transition: all var(--transition-base) var(--ease-in-out);
        }

        .pagination-btn:hover:not(:disabled) {
            border-color: var(--color-primary);
            color: var(--color-primary);
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination-btn.active {
            background-color: var(--color-primary);
            color: #ffffff;
            border-color: var(--color-primary);
        }

        /* å¼¹çª—é®ç½©ä¸å®¹å™¨ï¼ˆæ²¿ç”¨å•†å“åˆ—è¡¨é£æ ¼ï¼‰ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: var(--z-index-modal-backdrop);
            display: none;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal {
            background-color: #ffffff;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            padding: var(--spacing-lg);
            min-width: 800px;
            max-width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            z-index: var(--z-index-modal);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-lg);
            padding-bottom: var(--spacing-md);
            border-bottom: 1px solid var(--color-neutral-200);
        }

        .modal-title {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-bold);
            color: var(--color-text-primary);
            margin: 0;
        }

        .modal-close {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            background-color: transparent;
            cursor: pointer;
            border-radius: var(--radius-md);
            transition: all var(--transition-base) var(--ease-in-out);
            color: var(--color-text-secondary);
        }

        .modal-close:hover {
            background-color: var(--color-neutral-100);
            color: var(--color-text-primary);
        }

        .modal-body {
            margin-bottom: var(--spacing-lg);
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: var(--spacing-sm);
            padding-top: var(--spacing-md);
            border-top: 1px solid var(--color-neutral-200);
        }

        /* æ–°å»ºå¥—é¤å¼¹çª—å¸ƒå±€ï¼šå·¦å³ä¸¤æ  */
        .package-edit-layout {
            display: flex;
            gap: var(--spacing-lg);
            min-height: 320px;
        }

        .package-edit-left {
            flex: 3;
            border-right: 1px solid var(--color-neutral-200);
            padding-right: var(--spacing-md);
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .package-edit-right {
            flex: 2;
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .section-title-sm {
            font-size: var(--font-size-base);
            font-weight: var(--font-weight-medium);
            color: var(--color-text-primary);
            margin-bottom: var(--spacing-xs);
        }

        .section-desc-sm {
            font-size: var(--font-size-xs);
            color: var(--color-text-secondary);
            margin-bottom: var(--spacing-sm);
        }

        .form-field-inline {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xs);
            margin-bottom: var(--spacing-sm);
        }

        .form-field-inline label {
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            color: var(--color-text-primary);
        }

        .form-field-inline input {
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-md);
            border: 1px solid var(--color-neutral-300);
            font-size: var(--font-size-base);
            transition: all var(--transition-base) var(--ease-in-out);
        }

        .form-field-inline input:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: var(--shadow-input-focus);
        }

        .package-base-info {
            display: flex;
            gap: var(--spacing-md);
            align-items: center;
            margin-bottom: var(--spacing-md);
        }

        .package-thumb-placeholder {
            width: 72px;
            height: 72px;
            border-radius: var(--radius-md);
            border: 1px dashed var(--color-neutral-300);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--color-text-secondary);
            font-size: 28px;
        }

        .package-selected-list {
            border-radius: var(--radius-md);
            border: 1px solid var(--color-neutral-200);
            padding: var(--spacing-sm);
            max-height: 260px;
            overflow-y: auto;
        }

        .package-selected-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: var(--spacing-sm);
            padding: var(--spacing-xs) 0;
            border-bottom: 1px dashed var(--color-neutral-200);
        }

        .package-selected-item:last-child {
            border-bottom: none;
        }

        .package-selected-main {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .package-selected-main img {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-sm);
            object-fit: cover;
            border: 1px solid var(--color-neutral-200);
        }

        .package-selected-name {
            font-size: var(--font-size-xs);
            color: var(--color-text-primary);
        }

        .package-selected-sub {
            font-size: var(--font-size-xs);
            color: var(--color-text-secondary);
        }

        .package-selected-qty {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .package-selected-qty input {
            width: 60px;
            padding: 2px 4px;
            text-align: center;
            border-radius: var(--radius-sm);
            border: 1px solid var(--color-neutral-300);
            font-size: var(--font-size-xs);
        }

        .package-selected-remove {
            cursor: pointer;
            font-size: var(--font-size-xs);
            color: var(--color-text-secondary);
        }

        .package-selected-remove:hover {
            color: var(--color-error);
        }

        .package-summary {
            display: flex;
            flex-direction: column;
            gap: 4px;
            font-size: var(--font-size-xs);
            color: var(--color-text-secondary);
        }

        .package-summary strong {
            color: var(--color-text-primary);
        }

        .text-danger {
            color: var(--color-error);
        }

        .text-success {
            color: var(--color-success);
        }

        /* ç®€åŒ–ç‰ˆå•†å“é€‰æ‹©è¡¨æ ¼ï¼ˆå¼¹çª—å·¦ä¾§ï¼‰ */
        .select-table-wrapper {
            border-radius: var(--radius-md);
            border: 1px solid var(--color-neutral-200);
            overflow: hidden;
        }

        .select-table-wrapper table {
            width: 100%;
            border-collapse: collapse;
        }

        .select-table-wrapper th,
        .select-table-wrapper td {
            padding: var(--spacing-xs) var(--spacing-sm);
            font-size: var(--font-size-xs);
            border-bottom: 1px solid var(--color-neutral-200);
        }

        .select-filter-row {
            display: flex;
            gap: var(--spacing-xs);
            margin-bottom: var(--spacing-xs);
        }

        .select-filter-row input {
            flex: 1;
            padding: 4px 8px;
            border-radius: var(--radius-sm);
            border: 1px solid var(--color-neutral-300);
            font-size: var(--font-size-xs);
        }

        .select-filter-row input:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: var(--shadow-input-focus);
        }

        .select-product-name {
            cursor: pointer;
        }

        .select-product-name:hover {
            color: var(--color-primary);
        }

        @media (max-width: 1200px) {
            .filter-row {
                flex-direction: column;
            }

            .filter-item {
                width: 100%;
            }

            .package-edit-layout {
                flex-direction: column;
            }

            .package-edit-left {
                border-right: none;
                border-bottom: 1px solid var(--color-neutral-200);
                padding-right: 0;
                padding-bottom: var(--spacing-md);
            }
        }
    </style>
</head>
<body>
    <div class="package-list-page">
        <!-- é¡µé¢å¤´éƒ¨ -->
        <div class="page-header">
            <h1 class="page-title">å¥—é¤åˆ—è¡¨</h1>
            <div class="header-actions">
                <button class="btn btn-primary" id="createPackageBtn">æ–°å»ºå¥—é¤</button>
                <button class="btn btn-primary">å¥—é¤å¯¼å‡º</button>
                <button class="btn btn-primary">æ›´æ–°é”€é‡</button>
            </div>
        </div>

        <!-- Tabæ ‡ç­¾å¯¼èˆª -->
        <div class="tabs-nav">
            <button class="tab-nav-item active" data-tab="all">å…¨éƒ¨</button>
            <button class="tab-nav-item" data-tab="selling">é”€å”®ä¸­</button>
            <button class="tab-nav-item" data-tab="offline">ä¸‹æ¶ä¸­</button>
        </div>

        <!-- ç­›é€‰åŒºåŸŸ -->
        <div class="filter-section">
            <div class="filter-row">
                <div class="filter-item">
                    <label>æ·»åŠ æ—¶é—´</label>
                    <div class="date-range">
                        <input type="date" id="startDate" value="2025-01-01">
                        <span>è‡³</span>
                        <input type="date" id="endDate" value="2025-12-31">
                    </div>
                </div>
                <div class="filter-item">
                    <label>æœç´¢å¥—é¤</label>
                    <input type="text" id="searchInput" placeholder="æ”¯æŒè¾“å…¥å¥—é¤IDæˆ–åç§°æœç´¢">
                </div>
            </div>
        </div>

        <!-- æ‰¹é‡æ“ä½œåŒºåŸŸ -->
        <div class="batch-actions hidden" id="batchActions">
            <span class="selected-count">å·²é€‰æ‹© <span id="selectedCount">0</span> é¡¹</span>
            <button class="btn btn-outline" id="batchOnlineBtn">æ‰¹é‡ä¸Šæ¶</button>
            <button class="btn btn-outline" id="batchOfflineBtn">æ‰¹é‡ä¸‹æ¶</button>
            <button class="btn btn-outline" id="batchDeleteBtn">æ‰¹é‡åˆ é™¤</button>
        </div>

        <!-- è¡¨æ ¼å®¹å™¨ -->
        <div class="table-container">
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th class="checkbox-cell">
                                <input type="checkbox" id="selectAll">
                            </th>
                            <th class="sortable" data-sort="id">å¥—é¤ID</th>
                            <th>å¥—é¤åç§°</th>
                            <th>å¥—é¤ä»·æ ¼</th>
                            <th>åŸä»·åˆè®¡</th>
                            <th>èŠ‚çœé‡‘é¢</th>
                            <th>å•†å“æ•°é‡</th>
                            <th>æ·»åŠ æ—¶é—´</th>
                            <th>çŠ¶æ€</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="packageTableBody">
                        <!-- æ•°æ®ç”±JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </tbody>
                </table>
            </div>
            <!-- åˆ†é¡µ -->
            <div class="pagination">
                <div class="pagination-info">
                    å…± <span id="totalCount">0</span> æ¡æ•°æ®ï¼Œæ¯é¡µæ˜¾ç¤º 10 æ¡
                </div>
                <div class="pagination-controls">
                    <button class="pagination-btn" disabled>ä¸Šä¸€é¡µ</button>
                    <button class="pagination-btn active">1</button>
                    <button class="pagination-btn" disabled>ä¸‹ä¸€é¡µ</button>
                </div>
            </div>
        </div>

        <!-- æ–°å»º/ç¼–è¾‘å¥—é¤å¼¹çª— -->
        <div class="modal-overlay" id="packageModalOverlay">
            <div class="modal">
                <div class="modal-header">
                    <h3 class="modal-title" id="packageModalTitle">æ–°å»ºå¥—é¤</h3>
                    <button class="modal-close" id="packageModalClose">
                        <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="package-edit-layout">
                        <!-- å·¦ä¾§ï¼šé€‰æ‹©å•†å“ -->
                        <section class="package-edit-left">
                            <div>
                                <div class="section-title-sm">é€‰æ‹©å¥—é¤å•†å“</div>
                                <div class="section-desc-sm">
                                    ä»ä¸‹æ–¹å•†å“åˆ—è¡¨å‹¾é€‰è¦åŠ å…¥å¥—é¤çš„å•†å“ï¼Œå¯ä¸ºæ¯ä¸ªå•†å“è®¾ç½®æ•°é‡ï¼Œå³ä¾§ä¼šè‡ªåŠ¨è®¡ç®—åŸä»·åˆè®¡ä¸å»ºè®®å¥—é¤ä»·ã€‚
                                </div>
                                <div class="select-filter-row">
                                    <input type="text" id="productSearchInput" placeholder="è¾“å…¥å•†å“åç§°æˆ–IDæœç´¢">
                                </div>
                                <div class="select-table-wrapper">
                                    <table>
                                        <thead>
                                            <tr>
                                                <th style="width: 32px; text-align: center;">é€‰</th>
                                                <th>å•†å“</th>
                                                <th>å”®ä»·</th>
                                            </tr>
                                        </thead>
                                        <tbody id="selectProductTableBody">
                                            <!-- å•†å“æ•°æ®ç”±JSæ¸²æŸ“ -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </section>

                        <!-- å³ä¾§ï¼šå¥—é¤ä¿¡æ¯ + å·²é€‰å•†å“åˆ—è¡¨ + ä»·æ ¼è®¾ç½® -->
                        <section class="package-edit-right">
                            <div>
                                <div class="section-title-sm">å¥—é¤åŸºç¡€ä¿¡æ¯</div>
                                <div class="package-base-info">
                                    <div class="package-thumb-placeholder" id="packageThumbPlaceholder">ğŸ§©</div>
                                    <div style="flex: 1;">
                                        <div class="form-field-inline">
                                            <label for="packageNameInput">å¥—é¤åç§° <span style="color: var(--color-error);">*</span></label>
                                            <input type="text" id="packageNameInput" placeholder="è¯·è¾“å…¥å¥—é¤åç§°">
                                        </div>
                                        <div class="section-desc-sm">
                                            æš‚ä¸æ¥å…¥çœŸå®ä¸Šä¼ ï¼Œå½“å‰ç¤ºä¾‹ä»¥å ä½å›¾è¡¨ç¤ºå¥—é¤ä¸»å›¾ã€‚
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div>
                                <div class="section-title-sm">å·²é€‰å•†å“ï¼ˆç»„åˆæ˜ç»†ï¼‰</div>
                                <div class="section-desc-sm" id="selectedTips">
                                    æš‚æœªé€‰æ‹©å•†å“ï¼Œè¯·åœ¨å·¦ä¾§åˆ—è¡¨å‹¾é€‰è¦åŠ å…¥å¥—é¤çš„å•†å“ã€‚
                                </div>
                                <div class="package-selected-list" id="packageSelectedList">
                                    <!-- å·²é€‰å•†å“ç”±JSæ¸²æŸ“ -->
                                </div>
                            </div>

                            <div>
                                <div class="section-title-sm">å¥—é¤ä»·æ ¼è®¾ç½®</div>
                                <div class="form-field-inline">
                                    <label for="packagePriceInput">å¥—é¤å”®ä»· <span style="color: var(--color-error);">*</span></label>
                                    <input type="number" id="packagePriceInput" min="0" step="0.01" placeholder="è¯·è¾“å…¥å¥—é¤å”®ä»·">
                                </div>
                                <div class="package-summary" id="packageSummary">
                                    <span>åŸä»·åˆè®¡ï¼š<strong id="originPriceText">Â¥0.00</strong></span>
                                    <span>å¥—é¤å”®ä»·ï¼š<strong id="packagePriceText">Â¥0.00</strong></span>
                                    <span>èŠ‚çœé‡‘é¢ï¼š<strong id="saveAmountText">Â¥0.00</strong></span>
                                    <span id="packageValidationText" class="text-danger" style="display:none;"></span>
                                </div>
                            </div>
                        </section>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-outline" id="packageModalCancel">å–æ¶ˆ</button>
                    <button class="btn btn-primary" id="packageModalConfirm">ä¿å­˜å¥—é¤</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å•†å“æ•°æ®ï¼ˆæ¥è‡ªå•†è¶…å•†å“åˆ—è¡¨çš„åŒä¸€æ‰¹å•†å“ï¼Œåç§°/ID ç»Ÿä¸€ï¼‰
        const products = [
            { id: 1, name: 'é›…å®‰ç‰¹äº§ç»¿è¥å…»è›‹', image: '../../images/01.jpg', price: 20.00 },
            { id: 5, name: 'è’™é¡¶å±±èŒ¶', image: '../../images/05.jpg', price: 49.00 },
            { id: 7, name: 'èŠ±æ¤’æ²¹', image: '../../images/01.jpg', price: 15.00 },
            { id: 13, name: 'é›…å®‰èœ‚èœœ', image: '../../images/01.jpg', price: 38.00 },
            { id: 15, name: 'é›…å®‰èŒè‡å¹²è´§', image: '../../images/03.jpg', price: 45.00 },
            { id: 8, name: 'ç†ŠçŒ«å‘¨è¾¹ç©å¶', image: '../../images/02.jpg', price: 28.00 },
            { id: 12, name: 'ç²¾å“ç¤¼ç›’è£…', image: '../../images/06.jpg', price: 268.00 }
        ];

        // å¥—é¤æ•°æ®ï¼ˆä¸å•†è¶…å•†å“åˆ—è¡¨ä¸­çš„å•†å“åç§°/ID å¯¹åº”ï¼‰
        const packages = [
            {
                id: 1001,
                name: 'é›…å®‰å¥½æ™¯ç»å…¸ç¤¼ç›’å¥—é¤',
                image: '../../images/01.jpg',
                // å¥—é¤å”®ä»· < åŸä»·åˆè®¡ï¼ˆ20 + 49 = 69ï¼‰
                price: 59.00,
                originPrice: 69.00,
                items: [
                    { productId: 1, name: 'é›…å®‰ç‰¹äº§ç»¿è¥å…»è›‹', image: '../../images/01.jpg', price: 20.00, quantity: 1 },
                    { productId: 5, name: 'è’™é¡¶å±±èŒ¶', image: '../../images/05.jpg', price: 49.00, quantity: 1 }
                ],
                status: 'selling',
                addTime: '2025-08-26'
            },
            {
                id: 1002,
                name: 'é›…å®‰å¥½ç‰©èœ‚èœœèŒè‡å¥—é¤',
                image: '../../images/03.jpg',
                // å¥—é¤å”®ä»· < åŸä»·åˆè®¡ï¼ˆ38 + 45 = 83ï¼‰
                price: 69.00,
                originPrice: 83.00,
                items: [
                    { productId: 13, name: 'é›…å®‰èœ‚èœœ', image: '../../images/01.jpg', price: 38.00, quantity: 1 },
                    { productId: 15, name: 'é›…å®‰èŒè‡å¹²è´§', image: '../../images/03.jpg', price: 45.00, quantity: 1 }
                ],
                status: 'offline',
                addTime: '2025-08-20'
            }
        ];

        let filteredPackages = [...packages];
        let currentTab = 'all';
        let sortColumn = null;
        let sortDirection = 'asc';

        // æ–°å»º/ç¼–è¾‘å¥—é¤æ—¶çš„ä¸´æ—¶çŠ¶æ€
        let editingPackageId = null; // null è¡¨ç¤ºæ–°å»º
        let selectedItems = []; // { productId, name, image, price, quantity }

        const packageTableBody = document.getElementById('packageTableBody');

        // æ¸²æŸ“å¥—é¤è¡¨æ ¼
        function renderPackageTable() {
            packageTableBody.innerHTML = '';

            filteredPackages.forEach(pkg => {
                const tr = document.createElement('tr');
                const itemCount = pkg.items ? pkg.items.reduce((sum, item) => sum + (item.quantity || 0), 0) : 0;
                const saveAmount = (pkg.originPrice - pkg.price).toFixed(2);
                tr.dataset.id = pkg.id;
                tr.innerHTML = `
                    <td class="checkbox-cell">
                        <input type="checkbox" class="row-checkbox" data-id="${pkg.id}">
                    </td>
                    <td>${pkg.id}</td>
                    <td>
                        <div class="package-info">
                            <img src="${pkg.image || '../../images/01.jpg'}" alt="${pkg.name}" class="package-image" onerror="this.src='../../images/01.jpg'">
                            <span class="package-name" data-id="${pkg.id}">${pkg.name}</span>
                        </div>
                    </td>
                    <td>
                        <span class="price">Â¥${pkg.price.toFixed(2)}</span>
                    </td>
                    <td>
                        <span class="origin-price">Â¥${pkg.originPrice.toFixed(2)}</span>
                    </td>
                    <td>
                        <span class="save-amount">çœ Â¥${saveAmount}</span>
                    </td>
                    <td>${itemCount}</td>
                    <td>${pkg.addTime}</td>
                    <td>
                        <span class="status-tag ${pkg.status === 'offline' ? 'offline' : ''}">
                            ${pkg.status === 'selling' ? 'é”€å”®ä¸­' : 'ä¸‹æ¶ä¸­'}
                        </span>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-icon edit-btn" data-id="${pkg.id}" title="ç¼–è¾‘">
                                <svg viewBox="0 0 16 16" fill="currentColor">
                                    <path d="M11.013 1.427a1.75 1.75 0 012.474 0l1.086 1.086a1.75 1.75 0 010 2.474l-8.61 8.61c-.21.21-.47.364-.756.445l-3.251.93a.75.75 0 01-.927-.928l.929-3.25a1.75 1.75 0 01.445-.758l8.61-8.61zm1.414 1.06a.25.25 0 00-.354 0L10.811 3.75l1.439 1.44 1.263-1.263a.25.25 0 000-.354l-1.086-1.086zM11.189 6.25L9.75 4.81l-6.286 6.287a.25.25 0 00-.064.108l-.558 1.953 1.953-.558a.249.249 0 00.108-.064l6.286-6.286z"/>
                                </svg>
                            </button>
                            <button class="btn-icon copy-btn" data-id="${pkg.id}" title="å¤åˆ¶">
                                <svg viewBox="0 0 16 16" fill="currentColor">
                                    <path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"/>
                                    <path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"/>
                                </svg>
                            </button>
                            <button class="btn-icon delete delete-btn" data-id="${pkg.id}" title="åˆ é™¤">
                                <svg viewBox="0 0 16 16" fill="currentColor">
                                    <path d="M5.5 5.5A.5.5 0 016 6v6a.5.5 0 01-1 0V6a.5.5 0 01.5-.5zm2.5 0a.5.5 0 01.5.5v6a.5.5 0 01-1 0V6a.5.5 0 01.5-.5zm3 .5a.5.5 0 00-1 0v6a.5.5 0 001 0V6z"/>
                                    <path fill-rule="evenodd" d="M14.5 3a1 1 0 01-1 1H13v9a2 2 0 01-2 2H5a2 2 0 01-2-2V4h-.5a1 1 0 01-1-1V2a1 1 0 011-1H6a1 1 0 011-1h2a1 1 0 011 1h3.5a1 1 0 011 1v1zM4.118 4L4 4.059V13a1 1 0 001 1h6a1 1 0 001-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
                                </svg>
                            </button>
                        </div>
                    </td>
                `;
                packageTableBody.appendChild(tr);
            });

            document.getElementById('totalCount').textContent = filteredPackages.length;
            updateSelectedCount();
        }

        // Tabåˆ‡æ¢
        document.querySelectorAll('.tab-nav-item').forEach(tab => {
            tab.addEventListener('click', function () {
                document.querySelectorAll('.tab-nav-item').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                currentTab = this.dataset.tab;
                filterPackages();
            });
        });

        // ç­›é€‰ + æ’åº
        function filterPackages() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;

            filteredPackages = packages.filter(pkg => {
                // TabçŠ¶æ€
                if (currentTab === 'selling' && pkg.status !== 'selling') return false;
                if (currentTab === 'offline' && pkg.status !== 'offline') return false;

                // æœç´¢
                if (search) {
                    const searchLower = search.toLowerCase();
                    if (!pkg.id.toString().includes(searchLower) &&
                        !pkg.name.toLowerCase().includes(searchLower)) {
                        return false;
                    }
                }

                // æ—¥æœŸ
                if (startDate && pkg.addTime < startDate) return false;
                if (endDate && pkg.addTime > endDate) return false;

                return true;
            });

            // æ’åº
            if (sortColumn) {
                filteredPackages.sort((a, b) => {
                    let aVal = a[sortColumn];
                    let bVal = b[sortColumn];
                    if (typeof aVal === 'string') {
                        aVal = aVal.toLowerCase();
                        bVal = bVal.toLowerCase();
                    }
                    if (sortDirection === 'asc') {
                        return aVal > bVal ? 1 : -1;
                    } else {
                        return aVal < bVal ? 1 : -1;
                    }
                });
            }

            renderPackageTable();
        }

        // æ’åºäº‹ä»¶
        document.querySelectorAll('.sortable').forEach(th => {
            th.addEventListener('click', function () {
                const column = this.dataset.sort;
                if (sortColumn === column) {
                    sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
                } else {
                    sortColumn = column;
                    sortDirection = 'asc';
                }

                document.querySelectorAll('.sortable').forEach(t => t.classList.remove('asc', 'desc'));
                this.classList.add(sortDirection);

                filterPackages();
            });
        });

        // å…¨é€‰
        document.getElementById('selectAll').addEventListener('change', function () {
            const checkboxes = document.querySelectorAll('.row-checkbox');
            checkboxes.forEach(cb => cb.checked = this.checked);
            updateSelectedCount();
        });

        // è¡Œå¤é€‰æ¡†å˜åŒ–
        document.addEventListener('change', function (e) {
            if (e.target.classList.contains('row-checkbox')) {
                updateSelectedCount();
                const allChecked = document.querySelectorAll('.row-checkbox:checked').length === filteredPackages.length;
                document.getElementById('selectAll').checked = allChecked && filteredPackages.length > 0;
            }
        });

        // æ›´æ–°é€‰ä¸­æ•°é‡ä¸æ‰¹é‡æ“ä½œæ¡æ˜¾ç¤º
        function updateSelectedCount() {
            const count = document.querySelectorAll('.row-checkbox:checked').length;
            document.getElementById('selectedCount').textContent = count;
            const batchActions = document.getElementById('batchActions');
            if (count > 0) {
                batchActions.classList.remove('hidden');
            } else {
                batchActions.classList.add('hidden');
            }
        }

        // æœç´¢å’Œæ—¥æœŸå˜åŒ–
        document.getElementById('startDate').addEventListener('change', filterPackages);
        document.getElementById('endDate').addEventListener('change', filterPackages);
        document.getElementById('searchInput').addEventListener('input', filterPackages);

        // æ‰¹é‡æ“ä½œï¼ˆç¤ºä¾‹ï¼šä»…ä¿®æ”¹æœ¬åœ°çŠ¶æ€ï¼‰
        function getSelectedPackageIds() {
            const ids = [];
            document.querySelectorAll('.row-checkbox:checked').forEach(cb => {
                ids.push(parseInt(cb.dataset.id, 10));
            });
            return ids;
        }

        document.getElementById('batchOnlineBtn').addEventListener('click', function () {
            const ids = getSelectedPackageIds();
            if (!ids.length) return;
            packages.forEach(p => {
                if (ids.includes(p.id)) {
                    p.status = 'selling';
                }
            });
            filterPackages();
        });

        document.getElementById('batchOfflineBtn').addEventListener('click', function () {
            const ids = getSelectedPackageIds();
            if (!ids.length) return;
            packages.forEach(p => {
                if (ids.includes(p.id)) {
                    p.status = 'offline';
                }
            });
            filterPackages();
        });

        document.getElementById('batchDeleteBtn').addEventListener('click', function () {
            const ids = getSelectedPackageIds();
            if (!ids.length) return;
            if (!confirm('ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„å¥—é¤å—ï¼Ÿ')) return;
            for (let i = packages.length - 1; i >= 0; i--) {
                if (ids.includes(packages[i].id)) {
                    packages.splice(i, 1);
                }
            }
            filterPackages();
        });

        // æ–°å»º/ç¼–è¾‘å¥—é¤å¼¹çª—ç›¸å…³
        const packageModal = document.getElementById('packageModalOverlay');
        const packageModalTitle = document.getElementById('packageModalTitle');
        const packageModalClose = document.getElementById('packageModalClose');
        const packageModalCancel = document.getElementById('packageModalCancel');
        const packageModalConfirm = document.getElementById('packageModalConfirm');
        const packageNameInput = document.getElementById('packageNameInput');
        const packagePriceInput = document.getElementById('packagePriceInput');
        const productSearchInput = document.getElementById('productSearchInput');
        const selectProductTableBody = document.getElementById('selectProductTableBody');
        const packageSelectedList = document.getElementById('packageSelectedList');
        const selectedTips = document.getElementById('selectedTips');
        const originPriceText = document.getElementById('originPriceText');
        const packagePriceText = document.getElementById('packagePriceText');
        const saveAmountText = document.getElementById('saveAmountText');
        const packageValidationText = document.getElementById('packageValidationText');

        function openPackageModal(isEdit = false, pkg = null) {
            editingPackageId = isEdit && pkg ? pkg.id : null;
            if (isEdit && pkg) {
                packageModalTitle.textContent = 'ç¼–è¾‘å¥—é¤';
                packageNameInput.value = pkg.name;
                packagePriceInput.value = pkg.price.toFixed(2);
                selectedItems = pkg.items.map(item => ({
                    productId: item.productId,
                    name: item.name,
                    image: item.image,
                    price: item.price,
                    quantity: item.quantity
                }));
            } else {
                packageModalTitle.textContent = 'æ–°å»ºå¥—é¤';
                packageNameInput.value = '';
                packagePriceInput.value = '';
                selectedItems = [];
            }
            productSearchInput.value = '';
            renderSelectProductTable();
            renderSelectedItems();
            updatePriceSummary();
            packageValidationText.style.display = 'none';
            packageValidationText.textContent = '';
            packageModal.classList.add('show');
        }

        function closePackageModal() {
            packageModal.classList.remove('show');
        }

        document.getElementById('createPackageBtn').addEventListener('click', function () {
            openPackageModal(false, null);
        });

        if (packageModalClose) {
            packageModalClose.addEventListener('click', closePackageModal);
        }
        if (packageModalCancel) {
            packageModalCancel.addEventListener('click', closePackageModal);
        }
        packageModal.addEventListener('click', function (e) {
            if (e.target === packageModal) {
                closePackageModal();
            }
        });

        // æ¸²æŸ“å•†å“é€‰æ‹©è¡¨æ ¼
        function renderSelectProductTable() {
            const keyword = productSearchInput.value.toLowerCase();
            selectProductTableBody.innerHTML = '';
            products
                .filter(p => {
                    if (!keyword) return true;
                    const kw = keyword.toLowerCase();
                    return p.id.toString().includes(kw) || p.name.toLowerCase().includes(kw);
                })
                .forEach(p => {
                    const tr = document.createElement('tr');
                    const selected = selectedItems.some(item => item.productId === p.id);
                    tr.innerHTML = `
                        <td style="text-align: center;">
                            <input type="checkbox" class="select-product-checkbox" data-id="${p.id}" ${selected ? 'checked' : ''}>
                        </td>
                        <td>
                            <span class="select-product-name" data-id="${p.id}">${p.name}</span>
                        </td>
                        <td>Â¥${p.price.toFixed(2)}</td>
                    `;
                    selectProductTableBody.appendChild(tr);
                });
        }

        productSearchInput.addEventListener('input', renderSelectProductTable);

        // å¤„ç†é€‰ä¸­/å–æ¶ˆé€‰ä¸­å•†å“
        document.addEventListener('change', function (e) {
            if (e.target.classList.contains('select-product-checkbox')) {
                const productId = parseInt(e.target.dataset.id, 10);
                const product = products.find(p => p.id === productId);
                if (!product) return;
                if (e.target.checked) {
                    const existed = selectedItems.find(item => item.productId === productId);
                    if (existed) {
                        existed.quantity = existed.quantity || 1;
                    } else {
                        selectedItems.push({
                            productId: product.id,
                            name: product.name,
                            image: product.image,
                            price: product.price,
                            quantity: 1
                        });
                    }
                } else {
                    selectedItems = selectedItems.filter(item => item.productId !== productId);
                }
                renderSelectedItems();
                updatePriceSummary();
            }
        });

        // ç‚¹å‡»åç§°ä¹Ÿåˆ‡æ¢é€‰æ‹©
        document.addEventListener('click', function (e) {
            if (e.target.classList.contains('select-product-name')) {
                const id = e.target.dataset.id;
                const checkbox = document.querySelector('.select-product-checkbox[data-id="' + id + '"]');
                if (checkbox) {
                    checkbox.checked = !checkbox.checked;
                    checkbox.dispatchEvent(new Event('change'));
                }
            }
        });

        // æ¸²æŸ“å³ä¾§å·²é€‰å•†å“åˆ—è¡¨
        function renderSelectedItems() {
            packageSelectedList.innerHTML = '';
            if (!selectedItems.length) {
                selectedTips.textContent = 'æš‚æœªé€‰æ‹©å•†å“ï¼Œè¯·åœ¨å·¦ä¾§åˆ—è¡¨å‹¾é€‰è¦åŠ å…¥å¥—é¤çš„å•†å“ã€‚';
                return;
            }
            selectedTips.textContent = 'å·²é€‰ ' + selectedItems.length + ' ä¸ªå•†å“ï¼Œå¯å•ç‹¬è®¾ç½®æ•°é‡ã€‚';

            selectedItems.forEach(item => {
                const div = document.createElement('div');
                div.className = 'package-selected-item';
                div.dataset.productId = item.productId;
                div.innerHTML = `
                    <div class="package-selected-main">
                        <img src="${item.image || '../../images/01.jpg'}" alt="${item.name}" onerror="this.src='../../images/01.jpg'">
                        <div>
                            <div class="package-selected-name">${item.name}</div>
                            <div class="package-selected-sub">å•ä»·ï¼šÂ¥${item.price.toFixed(2)}</div>
                        </div>
                    </div>
                    <div class="package-selected-qty">
                        <span>æ•°é‡</span>
                        <input type="number" min="1" step="1" class="selected-qty-input" data-product-id="${item.productId}" value="${item.quantity || 1}">
                        <span class="package-selected-remove" data-product-id="${item.productId}">ç§»é™¤</span>
                    </div>
                `;
                packageSelectedList.appendChild(div);
            });
        }

        // å·²é€‰å•†å“æ•°é‡å˜åŒ–ä¸ç§»é™¤
        document.addEventListener('input', function (e) {
            if (e.target.classList.contains('selected-qty-input')) {
                const productId = parseInt(e.target.dataset.productId, 10);
                const qty = Math.max(1, parseInt(e.target.value || '1', 10));
                e.target.value = qty;
                const item = selectedItems.find(i => i.productId === productId);
                if (item) {
                    item.quantity = qty;
                    updatePriceSummary();
                }
            }
        });

        document.addEventListener('click', function (e) {
            if (e.target.classList.contains('package-selected-remove')) {
                const productId = parseInt(e.target.dataset.productId, 10);
                selectedItems = selectedItems.filter(i => i.productId !== productId);
                // åŒæ­¥å·¦ä¾§å¤é€‰æ¡†
                const checkbox = document.querySelector('.select-product-checkbox[data-id="' + productId + '"]');
                if (checkbox) {
                    checkbox.checked = false;
                }
                renderSelectedItems();
                updatePriceSummary();
            }
        });

        // æ›´æ–°ä»·æ ¼æ±‡æ€»åŒº
        function calculateOriginPrice() {
            return selectedItems.reduce((sum, item) => {
                const qty = item.quantity || 1;
                return sum + item.price * qty;
            }, 0);
        }

        function updatePriceSummary() {
            const originPrice = calculateOriginPrice();
            originPriceText.textContent = 'Â¥' + originPrice.toFixed(2);

            let packagePrice = parseFloat(packagePriceInput.value);
            if (isNaN(packagePrice)) {
                packagePrice = 0;
            }
            packagePriceText.textContent = 'Â¥' + packagePrice.toFixed(2);

            const saveAmount = Math.max(0, originPrice - packagePrice);
            saveAmountText.textContent = 'Â¥' + saveAmount.toFixed(2);

            // æ ¡éªŒæç¤º
            if (packagePrice <= 0) {
                packageValidationText.style.display = 'block';
                packageValidationText.textContent = 'è¯·è®¾ç½®å¤§äº 0 çš„å¥—é¤å”®ä»·ã€‚';
            } else if (originPrice > 0 && packagePrice > originPrice) {
                packageValidationText.style.display = 'block';
                packageValidationText.textContent = 'å¥—é¤å”®ä»·ä¸åº”é«˜äºåŸä»·åˆè®¡ï¼Œè¯·æ£€æŸ¥ä»·æ ¼è®¾ç½®ã€‚';
            } else {
                packageValidationText.style.display = 'none';
                packageValidationText.textContent = '';
            }
        }

        packagePriceInput.addEventListener('input', updatePriceSummary);

        // ä¿å­˜å¥—é¤ï¼ˆå‰ç«¯ç¤ºä¾‹ï¼šæ›´æ–°æœ¬åœ°æ•°ç»„å¹¶åˆ·æ–°è¡¨æ ¼ï¼‰
        if (packageModalConfirm) {
            packageModalConfirm.addEventListener('click', function () {
                const name = packageNameInput.value.trim();
                let price = parseFloat(packagePriceInput.value);
                const originPrice = calculateOriginPrice();

                if (!name) {
                    alert('è¯·å¡«å†™å¥—é¤åç§°');
                    return;
                }
                if (!selectedItems.length) {
                    alert('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªå•†å“ç»„æˆå¥—é¤');
                    return;
                }
                if (isNaN(price) || price <= 0) {
                    alert('è¯·å¡«å†™æœ‰æ•ˆçš„å¥—é¤å”®ä»·ï¼ˆå¤§äº 0ï¼‰');
                    return;
                }
                if (originPrice > 0 && price > originPrice) {
                    if (!confirm('å¥—é¤å”®ä»·é«˜äºåŸä»·åˆè®¡ï¼Œæ˜¯å¦ä»ç„¶ä¿å­˜ï¼Ÿ')) {
                        return;
                    }
                }

                price = parseFloat(price.toFixed(2));
                const now = new Date();
                const addTime = now.toISOString().slice(0, 10); // yyyy-mm-dd

                if (editingPackageId) {
                    const pkg = packages.find(p => p.id === editingPackageId);
                    if (pkg) {
                        pkg.name = name;
                        pkg.price = price;
                        pkg.originPrice = parseFloat(originPrice.toFixed(2));
                        pkg.items = selectedItems.map(item => ({
                            productId: item.productId,
                            name: item.name,
                            image: item.image,
                            price: item.price,
                            quantity: item.quantity || 1
                        }));
                    }
                } else {
                    const newId = packages.length ? Math.max(...packages.map(p => p.id)) + 1 : 1001;
                    const newPackage = {
                        id: newId,
                        name,
                        image: selectedItems[0]?.image || '../../images/01.jpg',
                        price,
                        originPrice: parseFloat(originPrice.toFixed(2)),
                        items: selectedItems.map(item => ({
                            productId: item.productId,
                            name: item.name,
                            image: item.image,
                            price: item.price,
                            quantity: item.quantity || 1
                        })),
                        status: 'selling',
                        addTime
                    };
                    packages.unshift(newPackage);
                }

                filterPackages();
                closePackageModal();
            });
        }

        // åˆ—è¡¨ä¸Šçš„ç¼–è¾‘ã€å¤åˆ¶ã€åˆ é™¤æŒ‰é’®
        document.addEventListener('click', function (e) {
            const editBtn = e.target.closest('.edit-btn');
            const copyBtn = e.target.closest('.copy-btn');
            const deleteBtn = e.target.closest('.delete-btn');
            const nameEl = e.target.closest('.package-name');

            if (editBtn) {
                const id = parseInt(editBtn.dataset.id, 10);
                const pkg = packages.find(p => p.id === id);
                if (pkg) {
                    openPackageModal(true, pkg);
                }
            }

            if (nameEl) {
                const id = parseInt(nameEl.dataset.id, 10);
                const pkg = packages.find(p => p.id === id);
                if (pkg) {
                    openPackageModal(true, pkg);
                }
            }

            if (copyBtn) {
                const id = parseInt(copyBtn.dataset.id, 10);
                const pkg = packages.find(p => p.id === id);
                if (pkg) {
                    const newId = packages.length ? Math.max(...packages.map(p => p.id)) + 1 : 1001;
                    const now = new Date();
                    const addTime = now.toISOString().slice(0, 10);
                    const copied = JSON.parse(JSON.stringify(pkg));
                    copied.id = newId;
                    copied.name = pkg.name + ' - å‰¯æœ¬';
                    copied.addTime = addTime;
                    packages.unshift(copied);
                    filterPackages();
                }
            }

            if (deleteBtn) {
                const id = parseInt(deleteBtn.dataset.id, 10);
                if (!confirm('ç¡®å®šè¦åˆ é™¤è¯¥å¥—é¤å—ï¼Ÿ')) return;
                const index = packages.findIndex(p => p.id === id);
                if (index > -1) {
                    packages.splice(index, 1);
                    filterPackages();
                }
            }
        });

        // åˆå§‹åŒ–
        filterPackages();
        renderSelectProductTable();
    </script>
</body>
</html>
