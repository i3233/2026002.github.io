<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å†å²ç»“å­˜ - 2026æ–°é¡¹ç›®äºŒ</title>
    <link rel="stylesheet" href="../../css/Main.css">
    <style>
        .history-statement-page {
            padding: var(--spacing-lg);
            background-color: var(--color-neutral-50);
        }

        /* é¡µé¢æ ‡é¢˜ */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-lg);
            padding: var(--spacing-lg);
            background-color: #ffffff;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-card);
        }

        .page-title {
            font-size: var(--font-size-2xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-text-primary);
            margin: 0;
        }

        .page-subtitle {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            margin-top: var(--spacing-xs);
        }

        /* ç­›é€‰å·¥å…·æ  */
        .filter-toolbar {
            padding: var(--spacing-lg);
            background-color: #ffffff;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-card);
            margin-bottom: var(--spacing-lg);
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            flex-wrap: wrap;
        }

        .filter-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .filter-item label {
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            color: var(--color-text-primary);
            white-space: nowrap;
        }

        .filter-item select,
        .filter-item input {
            padding: var(--spacing-sm) var(--spacing-md);
            border: 1px solid var(--color-neutral-300);
            border-radius: var(--radius-md);
            font-size: var(--font-size-base);
            transition: all var(--transition-base) var(--ease-in-out);
        }

        .filter-item select:focus,
        .filter-item input:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: var(--shadow-input-focus);
        }

        .filter-item--date-range {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .filter-item--date-range input {
            flex: 1;
        }

        .filter-item--date-range span {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
        }

        /* ç»Ÿè®¡æ‘˜è¦åŒºåŸŸ */
        .summary-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
        }

        .summary-card {
            background-color: #ffffff;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-card);
            padding: var(--spacing-md) var(--spacing-lg);
        }

        .summary-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-sm);
        }

        .summary-label {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
        }

        .summary-icon {
            font-size: var(--font-size-xl);
            opacity: 0.3;
        }

        .summary-value {
            font-size: var(--font-size-2xl);
            font-weight: var(--font-weight-bold);
            margin-bottom: var(--spacing-xs);
        }

        .summary-value-blue {
            color: var(--color-primary);
        }

        .summary-value-green {
            color: var(--color-success);
        }

        .summary-value-orange {
            color: #ff8c42;
        }

        .summary-value-red {
            color: var(--color-error);
        }

        /* å†å²è®°å½•åˆ—è¡¨ */
        .history-list-container {
            background-color: #ffffff;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-card);
            overflow: hidden;
            margin-bottom: var(--spacing-lg);
        }

        .history-list-header {
            padding: var(--spacing-lg);
            border-bottom: 1px solid var(--color-neutral-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .history-list-title {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-bold);
            color: var(--color-text-primary);
            margin: 0;
        }

        .history-list-actions {
            display: flex;
            gap: var(--spacing-sm);
        }

        .history-list-body {
            padding: var(--spacing-md);
        }

        .history-item {
            padding: var(--spacing-md);
            border: 1px solid var(--color-neutral-200);
            border-radius: var(--radius-md);
            margin-bottom: var(--spacing-md);
            cursor: pointer;
            transition: all var(--transition-base) var(--ease-in-out);
        }

        .history-item:hover {
            border-color: var(--color-primary);
            box-shadow: var(--shadow-card);
            transform: translateY(-2px);
        }

        .history-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-sm);
        }

        .history-item-date {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-bold);
            color: var(--color-text-primary);
        }

        .history-item-actions {
            display: flex;
            gap: var(--spacing-sm);
        }

        .history-item-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: var(--spacing-md);
            margin-top: var(--spacing-sm);
        }

        .history-stat-item {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xs);
        }

        .history-stat-label {
            font-size: var(--font-size-xs);
            color: var(--color-text-secondary);
        }

        .history-stat-value {
            font-size: var(--font-size-base);
            font-weight: var(--font-weight-medium);
            color: var(--color-text-primary);
        }

        .history-stat-value.amount {
            color: var(--color-primary);
        }

        .btn-link {
            color: var(--color-primary);
            background-color: transparent;
            border: none;
            padding: 0;
            cursor: pointer;
            font-size: var(--font-size-sm);
        }

        .btn-link:hover {
            text-decoration: underline;
        }

        /* è¯¦æƒ…å¼¹çª— */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: var(--spacing-lg);
            overflow-y: auto;
        }

        .modal-overlay.show {
            display: flex;
        }

        .detail-modal {
            background-color: #ffffff;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            max-width: 1400px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            padding: var(--spacing-lg);
            border-bottom: 1px solid var(--color-neutral-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .modal-title {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-bold);
            color: var(--color-text-primary);
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: var(--font-size-xl);
            color: var(--color-text-secondary);
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-md);
            transition: all var(--transition-base) var(--ease-in-out);
        }

        .modal-close:hover {
            background-color: var(--color-neutral-100);
            color: var(--color-text-primary);
        }

        .modal-body {
            padding: var(--spacing-lg);
            flex: 1;
            overflow-y: auto;
        }

        /* è¿›å­˜é”€ç»Ÿè®¡å¡ç‰‡ */
        .inventory-stats-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
        }

        .inventory-stat-card {
            background-color: var(--color-neutral-50);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
        }

        .inventory-stat-title {
            font-size: var(--font-size-base);
            font-weight: var(--font-weight-bold);
            color: var(--color-text-primary);
            margin-bottom: var(--spacing-md);
            padding-bottom: var(--spacing-sm);
            border-bottom: 2px solid var(--color-neutral-200);
        }

        .inventory-stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-sm) 0;
            border-bottom: 1px solid var(--color-neutral-200);
        }

        .inventory-stat-row:last-child {
            border-bottom: none;
            font-weight: var(--font-weight-medium);
            padding-top: var(--spacing-sm);
            margin-top: var(--spacing-sm);
            border-top: 1px solid var(--color-neutral-200);
        }

        .inventory-stat-label {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
        }

        .inventory-stat-value {
            font-size: var(--font-size-base);
            font-weight: var(--font-weight-medium);
            color: var(--color-text-primary);
        }

        .inventory-stat-value.amount {
            color: var(--color-primary);
        }

        /* è¡¨æ ¼å®¹å™¨ */
        .table-container {
            background-color: #ffffff;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-card);
            overflow: hidden;
        }

        .table-header {
            padding: var(--spacing-lg);
            border-bottom: 1px solid var(--color-neutral-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-title {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-bold);
            color: var(--color-text-primary);
            margin: 0;
        }

        .table-actions {
            display: flex;
            gap: var(--spacing-sm);
        }

        .table-wrapper {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background-color: var(--color-neutral-50);
        }

        th, td {
            padding: var(--spacing-sm) var(--spacing-md);
            font-size: var(--font-size-sm);
            border-bottom: 1px solid var(--color-neutral-200);
            white-space: nowrap;
        }

        th {
            text-align: left;
            font-weight: var(--font-weight-medium);
            color: var(--color-text-primary);
        }

        th.sortable {
            cursor: pointer;
            user-select: none;
            position: relative;
            padding-right: var(--spacing-xl);
        }

        th.sortable::after {
            content: 'â†•';
            position: absolute;
            right: var(--spacing-sm);
            color: var(--color-neutral-400);
            font-size: var(--font-size-xs);
        }

        th.sortable.asc::after {
            content: 'â†‘';
            color: var(--color-primary);
        }

        th.sortable.desc::after {
            content: 'â†“';
            color: var(--color-primary);
        }

        tbody tr:hover {
            background-color: var(--color-neutral-50);
        }

        tbody tr:last-child td {
            border-bottom: none;
        }

        .text-right {
            text-align: right;
        }

        .text-center {
            text-align: center;
        }

        .text-secondary {
            color: var(--color-text-secondary);
        }

        /* åˆè®¡è¡Œ */
        .table-footer-row {
            background-color: var(--color-neutral-50);
            font-weight: var(--font-weight-medium);
        }

        /* åº•éƒ¨å·¥å…·æ  */
        .bottom-toolbar {
            margin-top: var(--spacing-md);
            padding: var(--spacing-md) var(--spacing-lg);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: var(--spacing-md);
            background-color: #ffffff;
            border-radius: 0 0 var(--radius-lg) var(--radius-lg);
            border-top: 1px solid var(--color-neutral-200);
        }

        .bottom-left,
        .bottom-right {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            flex-wrap: wrap;
        }

        /* åˆ†é¡µæ§ä»¶ */
        .page-size-select {
            padding: 2px 8px;
            border-radius: var(--radius-md);
            border: 1px solid var(--color-neutral-300);
            font-size: var(--font-size-xs);
        }

        .pagination-info {
            font-size: var(--font-size-xs);
            color: var(--color-text-secondary);
        }

        .pagination-pages {
            display: inline-flex;
            align-items: center;
            gap: 2px;
        }

        .pagination-page-btn {
            min-width: 24px;
            padding: 2px 6px;
            border-radius: var(--radius-md);
            border: 1px solid var(--color-neutral-300);
            background-color: #ffffff;
            font-size: var(--font-size-xs);
            cursor: pointer;
            transition: all var(--transition-base) var(--ease-in-out);
        }

        .pagination-page-btn.active {
            background-color: var(--color-primary);
            color: #ffffff;
            border-color: var(--color-primary);
        }

        .pagination-page-btn:hover:not(.active) {
            border-color: var(--color-primary);
            color: var(--color-primary);
        }

        .pagination-page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination-jump-input {
            width: 40px;
            padding: 2px 4px;
            border-radius: var(--radius-md);
            border: 1px solid var(--color-neutral-300);
            font-size: var(--font-size-xs);
            text-align: center;
        }

        .btn-icon-text {
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .btn-icon-text-symbol {
            font-size: 14px;
        }

        @media (max-width: 1200px) {
            .filter-toolbar {
                flex-direction: column;
                align-items: stretch;
            }

            .filter-item {
                width: 100%;
            }

            .page-header {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--spacing-xs);
            }

            .bottom-toolbar {
                flex-direction: column;
                align-items: flex-start;
            }

            .history-item-stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="history-statement-page">
        <!-- é¡µé¢æ ‡é¢˜ -->
        <div class="page-header">
            <div>
                <h1 class="page-title">å†å²ç»“å­˜</h1>
                <div class="page-subtitle">æŸ¥çœ‹å†å²æ—¥æœŸçš„å•†å“è¿›å­˜é”€æƒ…å†µå’Œç»“å­˜ä¿¡æ¯</div>
            </div>
        </div>

        <!-- ç­›é€‰å·¥å…·æ  -->
        <div class="filter-toolbar">
            <div class="filter-item filter-item--date-range">
                <label>æ—¥æœŸèŒƒå›´ï¼š</label>
                <input type="date" id="startDate" value="">
                <span>è‡³</span>
                <input type="date" id="endDate" value="">
            </div>
            <div class="filter-item">
                <label>ä»“åº“ï¼š</label>
                <select id="warehouseSelect">
                    <option value="">å…¨éƒ¨ä»“åº“</option>
                    <!-- é€‰é¡¹ç”±JSåŠ¨æ€ç”Ÿæˆ -->
                </select>
            </div>
            <button class="btn btn-primary" id="queryBtn">æŸ¥è¯¢</button>
            <button class="btn btn-outline" id="exportBtn">
                <span class="btn-icon-text">
                    <span class="btn-icon-text-symbol">â†‘</span>
                    <span>å¯¼å‡º</span>
                </span>
            </button>
        </div>

        <!-- ç»Ÿè®¡æ‘˜è¦åŒºåŸŸ -->
        <div class="summary-section">
            <div class="summary-card">
                <div class="summary-card-header">
                    <span class="summary-label">æ€»è¿›è´§é‡‘é¢</span>
                    <span class="summary-icon">ğŸ“¦</span>
                </div>
                <div class="summary-value summary-value-blue" id="totalPurchaseAmount">Â¥0.00</div>
            </div>
            <div class="summary-card">
                <div class="summary-card-header">
                    <span class="summary-label">æ€»é”€å”®é‡‘é¢</span>
                    <span class="summary-icon">ğŸ’°</span>
                </div>
                <div class="summary-value summary-value-green" id="totalSalesAmount">Â¥0.00</div>
            </div>
            <div class="summary-card">
                <div class="summary-card-header">
                    <span class="summary-label">å¹³å‡åº“å­˜</span>
                    <span class="summary-icon">ğŸ“Š</span>
                </div>
                <div class="summary-value summary-value-orange" id="avgInventoryQty">0</div>
            </div>
            <div class="summary-card">
                <div class="summary-card-header">
                    <span class="summary-label">å¹³å‡åº“å­˜é‡‘é¢</span>
                    <span class="summary-icon">ğŸ’µ</span>
                </div>
                <div class="summary-value summary-value-red" id="avgInventoryAmount">Â¥0.00</div>
            </div>
        </div>

        <!-- å†å²è®°å½•åˆ—è¡¨ -->
        <div class="history-list-container">
            <div class="history-list-header">
                <h3 class="history-list-title">å†å²ç»“å­˜è®°å½•</h3>
                <div class="history-list-actions">
                    <button class="btn btn-outline" id="refreshBtn">åˆ·æ–°</button>
                </div>
            </div>
            <div class="history-list-body" id="historyListBody">
                <!-- JS æ¸²æŸ“ -->
            </div>

            <!-- åº•éƒ¨å·¥å…·æ  -->
            <div class="bottom-toolbar">
                <!-- å·¦ä¾§ä¿¡æ¯ -->
                <div class="bottom-left">
                    <span class="pagination-info">å…± <span id="totalRecords">0</span> æ¡è®°å½•</span>
                </div>

                <!-- å³ä¾§åˆ†é¡µ -->
                <div class="bottom-right">
                    <select class="page-size-select" id="pageSizeSelect">
                        <option value="10" selected>10 æ¡/é¡µ</option>
                        <option value="20">20 æ¡/é¡µ</option>
                        <option value="50">50 æ¡/é¡µ</option>
                    </select>
                    <div class="pagination-pages" id="paginationPages">
                        <!-- åˆ†é¡µæŒ‰é’®ç”±JSç”Ÿæˆ -->
                    </div>
                    <span class="pagination-info">è·³è½¬åˆ°</span>
                    <input type="number" class="pagination-jump-input" min="1" value="1" id="jumpToPage">
                    <span class="pagination-info">é¡µ</span>
                </div>
            </div>
        </div>
    </div>

    <!-- è¯¦æƒ…å¼¹çª— -->
    <div class="modal-overlay" id="detailModal">
        <div class="detail-modal">
            <div class="modal-header">
                <h3 class="modal-title" id="detailModalTitle">ç»“å­˜è¯¦æƒ…</h3>
                <button class="modal-close" id="closeDetailModal">&times;</button>
            </div>
            <div class="modal-body">
                <!-- è¿›å­˜é”€ç»Ÿè®¡å¡ç‰‡ -->
                <div class="inventory-stats-section" id="detailStatsSection">
                    <!-- ç»Ÿè®¡å¡ç‰‡ç”±JSåŠ¨æ€ç”Ÿæˆ -->
                </div>

                <!-- å•†å“ç»“å­˜æ˜ç»†è¡¨æ ¼ -->
                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">å•†å“ç»“å­˜æ˜ç»†</h3>
                        <div class="table-actions">
                            <button class="btn btn-outline" id="detailPrintBtn">æ‰“å°</button>
                            <button class="btn btn-outline" id="detailExportBtn">å¯¼å‡º</button>
                        </div>
                    </div>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th class="text-center">åºå·</th>
                                    <th>äº§å“ID</th>
                                    <th class="sortable" data-sort="name">äº§å“åç§°</th>
                                    <th>è§„æ ¼å‹å·</th>
                                    <th>åˆ†ç±»</th>
                                    <th class="text-right">æœŸåˆåº“å­˜</th>
                                    <th class="text-right">æœ¬æœŸå…¥åº“</th>
                                    <th class="text-right">æœ¬æœŸå‡ºåº“</th>
                                    <th class="text-right">è°ƒæ‹¨å…¥åº“</th>
                                    <th class="text-right">è°ƒæ‹¨å‡ºåº“</th>
                                    <th class="text-right sortable" data-sort="inventory">æœŸæœ«åº“å­˜</th>
                                    <th class="text-right">å•ä½</th>
                                    <th class="text-right">å¹³å‡æˆæœ¬</th>
                                    <th class="text-right">åº“å­˜é‡‘é¢</th>
                                </tr>
                            </thead>
                            <tbody id="detailTableBody">
                                <!-- JS æ¸²æŸ“ -->
                            </tbody>
                            <tfoot>
                                <tr class="table-footer-row">
                                    <td colspan="5" class="text-right">åˆè®¡ï¼š</td>
                                    <td class="text-right" id="detailTotalBeginningQty">0</td>
                                    <td class="text-right" id="detailTotalInQty">0</td>
                                    <td class="text-right" id="detailTotalOutQty">0</td>
                                    <td class="text-right" id="detailTotalTransferInQty">0</td>
                                    <td class="text-right" id="detailTotalTransferOutQty">0</td>
                                    <td class="text-right" id="detailTotalEndingQty">0</td>
                                    <td colspan="2"></td>
                                    <td class="text-right" id="detailTotalInventoryAmount">Â¥0.00</td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ¨¡æ‹Ÿä»“åº“æ•°æ®
        const warehouses = [
            { id: 'WH001', name: 'ä¸»ä»“åº“' },
            { id: 'WH002', name: 'åˆ†ä»“åº“A' },
            { id: 'WH003', name: 'åˆ†ä»“åº“B' },
            { id: 'WH004', name: 'ä¸´æ—¶ä»“åº“' }
        ];

        // æ¨¡æ‹Ÿå†å²ç»“å­˜è®°å½•æ•°æ®ï¼ˆæœ€è¿‘10å¤©ï¼‰ï¼ŒæŒ‰æ¯å¤©ä¸€æ¡ç»“å­˜è®°å½•å±•ç¤º
        const historyStatementData = (function () {
            const result = [];
            const today = new Date();

            for (let i = 0; i < 10; i++) {
                const d = new Date(today);
                d.setDate(today.getDate() - i);
                const dateStr = d.toISOString().split('T')[0];

                // ç®€å•æ¨¡æ‹Ÿä¸€äº›æ³¢åŠ¨æ•°æ®
                const base = 2000 + i * 30;
                const purchaseQty = 600 + i * 20;
                const salesQty = 550 + i * 18;
                const beginningInventoryQty = base;
                const currentInQty = purchaseQty;
                const currentOutQty = salesQty;
                const transferInQty = 10 + i;
                const transferOutQty = 5 + i;
                const endingInventoryQty = beginningInventoryQty + currentInQty + transferInQty - currentOutQty - transferOutQty;

                const purchaseAmount = purchaseQty * 12; // ç¤ºä¾‹è¿›è´§å‡ä»· 12 å…ƒ
                const returnQty = Math.floor(purchaseQty * 0.02);
                const returnAmount = returnQty * 12;
                const salesAmount = salesQty * 20; // ç¤ºä¾‹é”€å”®å‡ä»· 20 å…ƒ
                const salesReturnQty = Math.floor(salesQty * 0.01);
                const salesReturnAmount = salesReturnQty * 20;

                const record = {
                    date: dateStr,
                    purchaseOrderCount: 5 + (i % 3),
                    purchaseQty: purchaseQty,
                    purchaseAmount: purchaseAmount,
                    returnOrderCount: returnQty > 0 ? 1 : 0,
                    returnQty: returnQty,
                    returnAmount: returnAmount,
                    netPurchaseAmount: purchaseAmount - returnAmount,
                    salesOrderCount: 18 + (i % 5),
                    salesQty: salesQty,
                    salesAmount: salesAmount,
                    salesReturnOrderCount: salesReturnQty > 0 ? 1 : 0,
                    salesReturnQty: salesReturnQty,
                    salesReturnAmount: salesReturnAmount,
                    netSalesAmount: salesAmount - salesReturnAmount,
                    beginningInventoryQty: beginningInventoryQty,
                    beginningInventoryAmount: beginningInventoryQty * 15,
                    currentInQty: currentInQty,
                    currentOutQty: currentOutQty,
                    transferInQty: transferInQty,
                    transferOutQty: transferOutQty,
                    endingInventoryQty: endingInventoryQty,
                    endingInventoryAmount: endingInventoryQty * 15,
                    // ä»…æœ€è¿‘ä¸€å¤©æä¾›ç¤ºä¾‹å•†å“æ˜ç»†ï¼Œå…¶ä½™å¤©ç•™ç©ºåˆ—è¡¨
                    products: i === 0 ? [
                        {
                            id: 'PRD001',
                            name: 'é›…å®‰ç‰¹äº§ç»¿è¥å…»è›‹',
                            spec: '30æš/ç®±',
                            category: 'é›…å®‰å¥½ç‰©',
                            unit: 'ç®±',
                            beginningQty: 120,
                            beginningAmount: 3600.00,
                            inQty: 40,
                            outQty: 30,
                            transferInQty: 5,
                            transferOutQty: 2,
                            endingQty: 133,
                            avgCost: 30.00,
                            inventoryAmount: 3990.00
                        },
                        {
                            id: 'PRD002',
                            name: 'è’™é¡¶å±±èŒ¶',
                            spec: '500g/ç›’',
                            category: 'é›…å®‰å¥½æ™¯',
                            unit: 'ç›’',
                            beginningQty: 80,
                            beginningAmount: 5200.00,
                            inQty: 30,
                            outQty: 25,
                            transferInQty: 3,
                            transferOutQty: 1,
                            endingQty: 87,
                            avgCost: 65.00,
                            inventoryAmount: 5655.00
                        }
                    ] : []
                };

                result.push(record);
            }

            return result;
        })();

        // å½“å‰çŠ¶æ€
        let filteredHistoryData = [...historyStatementData];
        let currentPage = 1;
        let pageSize = 10;
        let currentDetailDate = null;

        // åˆå§‹åŒ–
        function init() {
            // è®¾ç½®é»˜è®¤æ—¥æœŸèŒƒå›´ï¼ˆæœ€è¿‘7å¤©ï¼‰
            const today = new Date();
            const sevenDaysAgo = new Date(today);
            sevenDaysAgo.setDate(today.getDate() - 7);
            
            document.getElementById('endDate').value = today.toISOString().split('T')[0];
            document.getElementById('startDate').value = sevenDaysAgo.toISOString().split('T')[0];

            // åˆå§‹åŒ–ä»“åº“é€‰æ‹©å™¨
            const warehouseSelect = document.getElementById('warehouseSelect');
            warehouses.forEach(warehouse => {
                const option = document.createElement('option');
                option.value = warehouse.id;
                option.textContent = warehouse.name;
                warehouseSelect.appendChild(option);
            });

            // åŠ è½½æ•°æ®
            loadHistoryData();
        }

        // åŠ è½½å†å²æ•°æ®
        function loadHistoryData() {
            // ç­›é€‰æ•°æ®
            filterHistoryData();
            
            // è®¡ç®—ç»Ÿè®¡
            calculateSummary();
            
            // æ¸²æŸ“åˆ—è¡¨
            renderHistoryList();
        }

        // ç­›é€‰å†å²æ•°æ®
        function filterHistoryData() {
            filteredHistoryData = [...historyStatementData];

            // æ—¥æœŸèŒƒå›´ç­›é€‰
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            if (startDate) {
                filteredHistoryData = filteredHistoryData.filter(item => item.date >= startDate);
            }
            if (endDate) {
                filteredHistoryData = filteredHistoryData.filter(item => item.date <= endDate);
            }

            // ä»“åº“ç­›é€‰ï¼ˆå½“å‰ç¤ºä¾‹æ•°æ®æ²¡æœ‰ä»“åº“å­—æ®µï¼Œæš‚æ—¶è·³è¿‡ï¼‰
            const warehouseId = document.getElementById('warehouseSelect').value;

            // æŒ‰æ—¥æœŸå€’åºæ’åˆ—ï¼ˆæœ€æ–°çš„åœ¨å‰ï¼‰
            filteredHistoryData.sort((a, b) => b.date.localeCompare(a.date));
        }

        // è®¡ç®—ç»Ÿè®¡æ‘˜è¦
        function calculateSummary() {
            const totalPurchaseAmount = filteredHistoryData.reduce((sum, item) => sum + item.purchaseAmount, 0);
            const totalSalesAmount = filteredHistoryData.reduce((sum, item) => sum + item.salesAmount, 0);
            const avgInventoryQty = filteredHistoryData.length > 0 
                ? Math.round(filteredHistoryData.reduce((sum, item) => sum + item.endingInventoryQty, 0) / filteredHistoryData.length)
                : 0;
            const avgInventoryAmount = filteredHistoryData.length > 0
                ? filteredHistoryData.reduce((sum, item) => sum + item.endingInventoryAmount, 0) / filteredHistoryData.length
                : 0;

            document.getElementById('totalPurchaseAmount').textContent = 'Â¥' + totalPurchaseAmount.toFixed(2);
            document.getElementById('totalSalesAmount').textContent = 'Â¥' + totalSalesAmount.toFixed(2);
            document.getElementById('avgInventoryQty').textContent = avgInventoryQty;
            document.getElementById('avgInventoryAmount').textContent = 'Â¥' + avgInventoryAmount.toFixed(2);
        }

        // æ¸²æŸ“å†å²è®°å½•åˆ—è¡¨
        function renderHistoryList() {
            const listBody = document.getElementById('historyListBody');
            listBody.innerHTML = '';

            if (filteredHistoryData.length === 0) {
                listBody.innerHTML = '<div style="padding: var(--spacing-lg); text-align: center; color: var(--color-text-secondary);">æš‚æ— å†å²è®°å½•</div>';
                updatePagination(0, 1);
                return;
            }

            // åˆ†é¡µ
            const totalPages = Math.ceil(filteredHistoryData.length / pageSize);
            const startIndex = (currentPage - 1) * pageSize;
            const endIndex = startIndex + pageSize;
            const pageData = filteredHistoryData.slice(startIndex, endIndex);

            pageData.forEach(item => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                historyItem.dataset.date = item.date;
                
                historyItem.innerHTML = `
                    <div class="history-item-header">
                        <div class="history-item-date">${item.date}</div>
                        <div class="history-item-actions">
                            <button class="btn-link view-detail-btn" data-date="${item.date}">æŸ¥çœ‹è¯¦æƒ…</button>
                            <button class="btn-link print-detail-btn" data-date="${item.date}">æ‰“å°</button>
                        </div>
                    </div>
                    <div class="history-item-stats">
                        <div class="history-stat-item">
                            <span class="history-stat-label">è¿›è´§é‡‘é¢</span>
                            <span class="history-stat-value amount">Â¥${item.purchaseAmount.toFixed(2)}</span>
                        </div>
                        <div class="history-stat-item">
                            <span class="history-stat-label">é”€å”®é‡‘é¢</span>
                            <span class="history-stat-value amount">Â¥${item.salesAmount.toFixed(2)}</span>
                        </div>
                        <div class="history-stat-item">
                            <span class="history-stat-label">æœŸåˆåº“å­˜</span>
                            <span class="history-stat-value">${item.beginningInventoryQty}</span>
                        </div>
                        <div class="history-stat-item">
                            <span class="history-stat-label">æœŸæœ«åº“å­˜</span>
                            <span class="history-stat-value">${item.endingInventoryQty}</span>
                        </div>
                        <div class="history-stat-item">
                            <span class="history-stat-label">æœŸåˆé‡‘é¢</span>
                            <span class="history-stat-value amount">Â¥${item.beginningInventoryAmount.toFixed(2)}</span>
                        </div>
                        <div class="history-stat-item">
                            <span class="history-stat-label">æœŸæœ«é‡‘é¢</span>
                            <span class="history-stat-value amount">Â¥${item.endingInventoryAmount.toFixed(2)}</span>
                        </div>
                    </div>
                `;
                listBody.appendChild(historyItem);
            });

            // ç»‘å®šäº‹ä»¶
            bindHistoryListEvents();
            updatePagination(filteredHistoryData.length, totalPages);
        }

        // ç»‘å®šå†å²åˆ—è¡¨äº‹ä»¶
        function bindHistoryListEvents() {
            // æŸ¥çœ‹è¯¦æƒ…
            document.querySelectorAll('.view-detail-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const date = this.dataset.date;
                    showDetail(date);
                });
            });

            // æ‰“å°
            document.querySelectorAll('.print-detail-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const date = this.dataset.date;
                    alert(`æ‰“å° ${date} çš„ç»“å­˜å•ï¼ˆç¤ºä¾‹ï¼‰\næ­£åœ¨å‡†å¤‡æ‰“å°...`);
                });
            });

            // ç‚¹å‡»æ•´è¡ŒæŸ¥çœ‹è¯¦æƒ…
            document.querySelectorAll('.history-item').forEach(item => {
                item.addEventListener('click', function() {
                    const date = this.dataset.date;
                    showDetail(date);
                });
            });
        }

        // æ˜¾ç¤ºè¯¦æƒ…
        function showDetail(date) {
            currentDetailDate = date;
            const record = historyStatementData.find(item => item.date === date);
            
            if (!record) {
                alert('æœªæ‰¾åˆ°è¯¥æ—¥æœŸçš„ç»“å­˜è®°å½•');
                return;
            }

            // æ›´æ–°å¼¹çª—æ ‡é¢˜
            document.getElementById('detailModalTitle').textContent = `${date} ç»“å­˜è¯¦æƒ…`;

            // æ¸²æŸ“è¿›å­˜é”€ç»Ÿè®¡
            renderDetailStats(record);

            // æ¸²æŸ“å•†å“æ˜ç»†è¡¨æ ¼
            renderDetailTable(record.products.length > 0 ? record.products : generateDetailProducts(record));

            // æ˜¾ç¤ºå¼¹çª—
            document.getElementById('detailModal').classList.add('show');
        }

        // ç”Ÿæˆè¯¦æƒ…å•†å“æ•°æ®ï¼ˆå¦‚æœè®°å½•ä¸­æ²¡æœ‰å•†å“æ•°æ®ï¼‰
        function generateDetailProducts(record) {
            // åŸºäºç»Ÿè®¡æ•°æ®ç”Ÿæˆç¤ºä¾‹å•†å“æ•°æ®
            return [
                {
                    id: 'PRD001',
                    name: 'éš”çƒ­å«',
                    spec: '30cmÃ—30cm',
                    category: 'å¨æˆ¿ç”¨å“',
                    unit: 'ä¸ª',
                    beginningQty: Math.floor(record.beginningInventoryQty * 0.05),
                    beginningAmount: record.beginningInventoryAmount * 0.02,
                    inQty: Math.floor(record.currentInQty * 0.05),
                    outQty: Math.floor(record.currentOutQty * 0.05),
                    transferInQty: record.transferInQty,
                    transferOutQty: record.transferOutQty,
                    endingQty: Math.floor(record.endingInventoryQty * 0.05),
                    avgCost: 12.50,
                    inventoryAmount: record.endingInventoryAmount * 0.02
                },
                {
                    id: 'PRD002',
                    name: 'p-6ç‚’é”…',
                    spec: '32cm',
                    category: 'å¨æˆ¿ç”¨å“',
                    unit: 'ä¸ª',
                    beginningQty: Math.floor(record.beginningInventoryQty * 0.04),
                    beginningAmount: record.beginningInventoryAmount * 0.20,
                    inQty: Math.floor(record.currentInQty * 0.02),
                    outQty: Math.floor(record.currentOutQty * 0.02),
                    transferInQty: 0,
                    transferOutQty: 0,
                    endingQty: Math.floor(record.endingInventoryQty * 0.04),
                    avgCost: 158.00,
                    inventoryAmount: record.endingInventoryAmount * 0.20
                },
                {
                    id: 'PRD003',
                    name: 'é›…å®‰èŒ¶å¶',
                    spec: '500g/ç›’',
                    category: 'é£Ÿå“',
                    unit: 'ç›’',
                    beginningQty: Math.floor(record.beginningInventoryQty * 0.07),
                    beginningAmount: record.beginningInventoryAmount * 0.10,
                    inQty: Math.floor(record.currentInQty * 0.10),
                    outQty: Math.floor(record.currentOutQty * 0.13),
                    transferInQty: 0,
                    transferOutQty: 0,
                    endingQty: Math.floor(record.endingInventoryQty * 0.06),
                    avgCost: 45.00,
                    inventoryAmount: record.endingInventoryAmount * 0.09
                }
            ];
        }

        // æ¸²æŸ“è¯¦æƒ…ç»Ÿè®¡
        function renderDetailStats(record) {
            const statsSection = document.getElementById('detailStatsSection');
            statsSection.innerHTML = `
                <!-- è¿›è´§ç»Ÿè®¡ -->
                <div class="inventory-stat-card">
                    <div class="inventory-stat-title">è¿›è´§ç»Ÿè®¡</div>
                    <div class="inventory-stat-row">
                        <span class="inventory-stat-label">è¿›è´§å•æ•°</span>
                        <span class="inventory-stat-value">${record.purchaseOrderCount}</span>
                    </div>
                    <div class="inventory-stat-row">
                        <span class="inventory-stat-label">è¿›è´§æ•°é‡</span>
                        <span class="inventory-stat-value">${record.purchaseQty}</span>
                    </div>
                    <div class="inventory-stat-row">
                        <span class="inventory-stat-label">è¿›è´§é‡‘é¢</span>
                        <span class="inventory-stat-value amount">Â¥${record.purchaseAmount.toFixed(2)}</span>
                    </div>
                    <div class="inventory-stat-row">
                        <span class="inventory-stat-label">é€€è´§å•æ•°</span>
                        <span class="inventory-stat-value">${record.returnOrderCount}</span>
                    </div>
                    <div class="inventory-stat-row">
                        <span class="inventory-stat-label">é€€è´§æ•°é‡</span>
                        <span class="inventory-stat-value">${record.returnQty}</span>
                    </div>
                    <div class="inventory-stat-row">
                        <span class="inventory-stat-label">é€€è´§é‡‘é¢</span>
                        <span class="inventory-stat-value amount">Â¥${record.returnAmount.toFixed(2)}</span>
                    </div>
                    <div class="inventory-stat-row">
                        <span class="inventory-stat-label">å‡€è¿›è´§</span>
                        <span class="inventory-stat-value amount">Â¥${record.netPurchaseAmount.toFixed(2)}</span>
                    </div>
                </div>

                <!-- é”€å”®ç»Ÿè®¡ -->
                <div class="inventory-stat-card">
                    <div class="inventory-stat-title">é”€å”®ç»Ÿè®¡</div>
                    <div class="inventory-stat-row">
                        <span class="inventory-stat-label">é”€å”®å•æ•°</span>
                        <span class="inventory-stat-value">${record.salesOrderCount}</span>
                    </div>
                    <div class="inventory-stat-row">
                        <span class="inventory-stat-label">é”€å”®æ•°é‡</span>
                        <span class="inventory-stat-value">${record.salesQty}</span>
                    </div>
                    <div class="inventory-stat-row">
                        <span class="inventory-stat-label">é”€å”®é‡‘é¢</span>
                        <span class="inventory-stat-value amount">Â¥${record.salesAmount.toFixed(2)}</span>
                    </div>
                    <div class="inventory-stat-row">
                        <span class="inventory-stat-label">é€€è´§å•æ•°</span>
                        <span class="inventory-stat-value">${record.salesReturnOrderCount}</span>
                    </div>
                    <div class="inventory-stat-row">
                        <span class="inventory-stat-label">é€€è´§æ•°é‡</span>
                        <span class="inventory-stat-value">${record.salesReturnQty}</span>
                    </div>
                    <div class="inventory-stat-row">
                        <span class="inventory-stat-label">é€€è´§é‡‘é¢</span>
                        <span class="inventory-stat-value amount">Â¥${record.salesReturnAmount.toFixed(2)}</span>
                    </div>
                    <div class="inventory-stat-row">
                        <span class="inventory-stat-label">å‡€é”€å”®</span>
                        <span class="inventory-stat-value amount">Â¥${record.netSalesAmount.toFixed(2)}</span>
                    </div>
                </div>

                <!-- åº“å­˜ç»Ÿè®¡ -->
                <div class="inventory-stat-card">
                    <div class="inventory-stat-title">åº“å­˜ç»Ÿè®¡</div>
                    <div class="inventory-stat-row">
                        <span class="inventory-stat-label">æœŸåˆåº“å­˜</span>
                        <span class="inventory-stat-value">${record.beginningInventoryQty}</span>
                    </div>
                    <div class="inventory-stat-row">
                        <span class="inventory-stat-label">æœŸåˆé‡‘é¢</span>
                        <span class="inventory-stat-value amount">Â¥${record.beginningInventoryAmount.toFixed(2)}</span>
                    </div>
                    <div class="inventory-stat-row">
                        <span class="inventory-stat-label">æœ¬æœŸå…¥åº“</span>
                        <span class="inventory-stat-value">${record.currentInQty}</span>
                    </div>
                    <div class="inventory-stat-row">
                        <span class="inventory-stat-label">æœ¬æœŸå‡ºåº“</span>
                        <span class="inventory-stat-value">${record.currentOutQty}</span>
                    </div>
                    <div class="inventory-stat-row">
                        <span class="inventory-stat-label">è°ƒæ‹¨å…¥åº“</span>
                        <span class="inventory-stat-value">${record.transferInQty}</span>
                    </div>
                    <div class="inventory-stat-row">
                        <span class="inventory-stat-label">è°ƒæ‹¨å‡ºåº“</span>
                        <span class="inventory-stat-value">${record.transferOutQty}</span>
                    </div>
                    <div class="inventory-stat-row">
                        <span class="inventory-stat-label">æœŸæœ«åº“å­˜</span>
                        <span class="inventory-stat-value">${record.endingInventoryQty}</span>
                    </div>
                    <div class="inventory-stat-row">
                        <span class="inventory-stat-label">æœŸæœ«é‡‘é¢</span>
                        <span class="inventory-stat-value amount">Â¥${record.endingInventoryAmount.toFixed(2)}</span>
                    </div>
                </div>
            `;
        }

        // æ¸²æŸ“è¯¦æƒ…è¡¨æ ¼
        function renderDetailTable(products) {
            const tbody = document.getElementById('detailTableBody');
            tbody.innerHTML = '';

            if (products.length === 0) {
                tbody.innerHTML = '<tr><td colspan="14" style="text-align: center; padding: var(--spacing-lg); color: var(--color-text-secondary);">æš‚æ— å•†å“æ•°æ®</td></tr>';
                updateDetailTotals([]);
                return;
            }

            products.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="text-center">${index + 1}</td>
                    <td>${item.id}</td>
                    <td>${item.name}</td>
                    <td>${item.spec}</td>
                    <td>${item.category}</td>
                    <td class="text-right">${item.beginningQty}</td>
                    <td class="text-right">${item.inQty}</td>
                    <td class="text-right">${item.outQty}</td>
                    <td class="text-right">${item.transferInQty}</td>
                    <td class="text-right">${item.transferOutQty}</td>
                    <td class="text-right">${item.endingQty}</td>
                    <td class="text-right">${item.unit}</td>
                    <td class="text-right">Â¥${item.avgCost.toFixed(2)}</td>
                    <td class="text-right">Â¥${item.inventoryAmount.toFixed(2)}</td>
                `;
                tbody.appendChild(row);
            });

            updateDetailTotals(products);
        }

        // æ›´æ–°è¯¦æƒ…åˆè®¡
        function updateDetailTotals(products) {
            const totalBeginningQty = products.reduce((sum, item) => sum + item.beginningQty, 0);
            const totalInQty = products.reduce((sum, item) => sum + item.inQty, 0);
            const totalOutQty = products.reduce((sum, item) => sum + item.outQty, 0);
            const totalTransferInQty = products.reduce((sum, item) => sum + item.transferInQty, 0);
            const totalTransferOutQty = products.reduce((sum, item) => sum + item.transferOutQty, 0);
            const totalEndingQty = products.reduce((sum, item) => sum + item.endingQty, 0);
            const totalInventoryAmount = products.reduce((sum, item) => sum + item.inventoryAmount, 0);

            document.getElementById('detailTotalBeginningQty').textContent = totalBeginningQty;
            document.getElementById('detailTotalInQty').textContent = totalInQty;
            document.getElementById('detailTotalOutQty').textContent = totalOutQty;
            document.getElementById('detailTotalTransferInQty').textContent = totalTransferInQty;
            document.getElementById('detailTotalTransferOutQty').textContent = totalTransferOutQty;
            document.getElementById('detailTotalEndingQty').textContent = totalEndingQty;
            document.getElementById('detailTotalInventoryAmount').textContent = 'Â¥' + totalInventoryAmount.toFixed(2);
        }

        // å…³é—­è¯¦æƒ…å¼¹çª—
        function closeDetailModal() {
            document.getElementById('detailModal').classList.remove('show');
            currentDetailDate = null;
        }

        // æ›´æ–°åˆ†é¡µ
        function updatePagination(totalRecords, totalPages) {
            document.getElementById('totalRecords').textContent = totalRecords;

            const paginationPages = document.getElementById('paginationPages');
            paginationPages.innerHTML = '';

            if (totalPages === 0) {
                return;
            }

            // ä¸Šä¸€é¡µ
            const prevBtn = document.createElement('button');
            prevBtn.className = 'pagination-page-btn';
            prevBtn.textContent = 'ä¸Šä¸€é¡µ';
            prevBtn.disabled = currentPage === 1;
            prevBtn.addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    renderHistoryList();
                }
            });
            paginationPages.appendChild(prevBtn);

            // é¡µç æŒ‰é’®
            const maxVisiblePages = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
            if (endPage - startPage < maxVisiblePages - 1) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }

            if (startPage > 1) {
                const firstBtn = document.createElement('button');
                firstBtn.className = 'pagination-page-btn';
                firstBtn.textContent = '1';
                firstBtn.addEventListener('click', () => {
                    currentPage = 1;
                    renderHistoryList();
                });
                paginationPages.appendChild(firstBtn);

                if (startPage > 2) {
                    const ellipsis = document.createElement('span');
                    ellipsis.className = 'pagination-info';
                    ellipsis.textContent = '...';
                    paginationPages.appendChild(ellipsis);
                }
            }

            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = 'pagination-page-btn';
                if (i === currentPage) {
                    pageBtn.classList.add('active');
                }
                pageBtn.textContent = i;
                pageBtn.addEventListener('click', () => {
                    currentPage = i;
                    renderHistoryList();
                });
                paginationPages.appendChild(pageBtn);
            }

            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    const ellipsis = document.createElement('span');
                    ellipsis.className = 'pagination-info';
                    ellipsis.textContent = '...';
                    paginationPages.appendChild(ellipsis);
                }

                const lastBtn = document.createElement('button');
                lastBtn.className = 'pagination-page-btn';
                lastBtn.textContent = totalPages;
                lastBtn.addEventListener('click', () => {
                    currentPage = totalPages;
                    renderHistoryList();
                });
                paginationPages.appendChild(lastBtn);
            }

            // ä¸‹ä¸€é¡µ
            const nextBtn = document.createElement('button');
            nextBtn.className = 'pagination-page-btn';
            nextBtn.textContent = 'ä¸‹ä¸€é¡µ';
            nextBtn.disabled = currentPage === totalPages;
            nextBtn.addEventListener('click', () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    renderHistoryList();
                }
            });
            paginationPages.appendChild(nextBtn);
        }

        // äº‹ä»¶ç»‘å®š
        document.getElementById('queryBtn').addEventListener('click', function() {
            currentPage = 1;
            loadHistoryData();
        });
        document.getElementById('exportBtn').addEventListener('click', function() {
            alert('å¯¼å‡ºå†å²ç»“å­˜ï¼ˆç¤ºä¾‹ï¼‰\næ­£åœ¨å¯¼å‡ºExcelæ–‡ä»¶...');
        });
        document.getElementById('refreshBtn').addEventListener('click', function() {
            loadHistoryData();
        });
        document.getElementById('closeDetailModal').addEventListener('click', closeDetailModal);
        document.getElementById('detailPrintBtn').addEventListener('click', function() {
            if (currentDetailDate) {
                alert(`æ‰“å° ${currentDetailDate} çš„ç»“å­˜å•ï¼ˆç¤ºä¾‹ï¼‰\næ­£åœ¨å‡†å¤‡æ‰“å°...`);
            }
        });
        document.getElementById('detailExportBtn').addEventListener('click', function() {
            if (currentDetailDate) {
                alert(`å¯¼å‡º ${currentDetailDate} çš„ç»“å­˜å•ï¼ˆç¤ºä¾‹ï¼‰\næ­£åœ¨å¯¼å‡ºExcelæ–‡ä»¶...`);
            }
        });

        // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
        document.getElementById('detailModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeDetailModal();
            }
        });

        // åˆ†é¡µå¤§å°å˜åŒ–
        document.getElementById('pageSizeSelect').addEventListener('change', function() {
            pageSize = parseInt(this.value);
            currentPage = 1;
            renderHistoryList();
        });

        // è·³è½¬é¡µé¢
        document.getElementById('jumpToPage').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const page = parseInt(this.value);
                const totalPages = Math.ceil(filteredHistoryData.length / pageSize);
                if (page >= 1 && page <= totalPages) {
                    currentPage = page;
                    renderHistoryList();
                } else {
                    alert(`è¯·è¾“å…¥1-${totalPages}ä¹‹é—´çš„é¡µç `);
                }
            }
        });

        // åˆå§‹åŒ–
        init();
    </script>
</body>
</html>